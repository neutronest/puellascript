<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[RnSource]{Main pass of renamer}
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE CPP, ScopedTypeVariables #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">RnSource</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-10"></a><span>        </span><a href="RnSource.html#rnSrcDecls"><span class="hs-identifier hs-var">rnSrcDecls</span></a><span class="hs-special">,</span><span> </span><a href="RnSource.html#addTcgDUs"><span class="hs-identifier hs-var">addTcgDUs</span></a><span class="hs-special">,</span><span> </span><a href="RnSource.html#findSplice"><span class="hs-identifier hs-var">findSplice</span></a><span>
</span><a name="line-11"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="RnExpr.html"><span class="hs-identifier">RnExpr</span></a><span class="hs-special">(</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="RnSplice.html"><span class="hs-identifier">RnSplice</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="RnSplice.html#rnSpliceDecl"><span class="hs-identifier hs-var">rnSpliceDecl</span></a><span class="hs-special">,</span><span> </span><a href="RnSplice.html#rnTopSpliceDecls"><span class="hs-identifier hs-var">rnTopSpliceDecls</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="FieldLabel.html"><span class="hs-identifier">FieldLabel</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="RnTypes.html"><span class="hs-identifier">RnTypes</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="RnBinds.html"><span class="hs-identifier">RnBinds</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="RnEnv.html"><span class="hs-identifier">RnEnv</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="RnUtils.html"><span class="hs-identifier">RnUtils</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#bindLocalNames"><span class="hs-identifier hs-var">bindLocalNames</span></a><span>
</span><a name="line-25"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#inHsDocContext"><span class="hs-identifier hs-var">inHsDocContext</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span>
</span><a name="line-26"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#checkShadowedRdrNames"><span class="hs-identifier hs-var">checkShadowedRdrNames</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#warnUnusedTypePatterns"><span class="hs-identifier hs-var">warnUnusedTypePatterns</span></a><span>
</span><a name="line-27"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#extendTyVarEnvFVRn"><span class="hs-identifier hs-var">extendTyVarEnvFVRn</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#newLocalBndrsRn"><span class="hs-identifier hs-var">newLocalBndrsRn</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="RnUnbound.html"><span class="hs-identifier">RnUnbound</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="PrelNames.html#mkUnboundName"><span class="hs-identifier hs-var">mkUnboundName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="RnNames.html"><span class="hs-identifier">RnNames</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="RnHsDoc.html"><span class="hs-identifier">RnHsDoc</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="RnHsDoc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a><span class="hs-special">,</span><span> </span><a href="RnHsDoc.html#rnMbLHsDoc"><span class="hs-identifier hs-var">rnMbLHsDoc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="TcAnnotations.html"><span class="hs-identifier">TcAnnotations</span></a><span>    </span><span class="hs-special">(</span><span> </span><a href="TcAnnotations.html#annCtxt"><span class="hs-identifier hs-var">annCtxt</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="ForeignCall.html"><span class="hs-identifier">ForeignCall</span></a><span>      </span><span class="hs-special">(</span><span> </span><a href="ForeignCall.html#CCallTarget"><span class="hs-identifier hs-type">CCallTarget</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>         </span><span class="hs-special">(</span><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#plusWarns"><span class="hs-identifier hs-var">plusWarns</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>            </span><span class="hs-special">(</span><span> </span><a href="Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="PrelNames.html#applicativeClassName"><span class="hs-identifier hs-var">applicativeClassName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#pureAName"><span class="hs-identifier hs-var">pureAName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#thenAName"><span class="hs-identifier hs-var">thenAName</span></a><span>
</span><a name="line-39"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#monadClassName"><span class="hs-identifier hs-var">monadClassName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#returnMName"><span class="hs-identifier hs-var">returnMName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#thenMName"><span class="hs-identifier hs-var">thenMName</span></a><span>
</span><a name="line-40"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#monadFailClassName"><span class="hs-identifier hs-var">monadFailClassName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#failMName"><span class="hs-identifier hs-var">failMName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#failMName_preMFP"><span class="hs-identifier hs-var">failMName_preMFP</span></a><span>
</span><a name="line-41"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#semigroupClassName"><span class="hs-identifier hs-var">semigroupClassName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#sappendName"><span class="hs-identifier hs-var">sappendName</span></a><span>
</span><a name="line-42"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="PrelNames.html#monoidClassName"><span class="hs-identifier hs-var">monoidClassName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#mappendName"><span class="hs-identifier hs-var">mappendName</span></a><span>
</span><a name="line-43"></a><span>                        </span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="Avail.html"><span class="hs-identifier">Avail</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="BasicTypes.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#RuleName"><span class="hs-identifier hs-type">RuleName</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#pprRuleName"><span class="hs-identifier hs-var">pprRuleName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>             </span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">lengthExceeds</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>         </span><span class="hs-special">(</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="ListSetOps.html#findDupsEq"><span class="hs-identifier hs-var">findDupsEq</span></a><span class="hs-special">,</span><span> </span><a href="ListSetOps.html#removeDups"><span class="hs-identifier hs-var">removeDups</span></a><span class="hs-special">,</span><span> </span><a href="ListSetOps.html#equivClasses"><span class="hs-identifier hs-var">equivClasses</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Digraph.html"><span class="hs-identifier">Digraph</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#flattenSCC"><span class="hs-identifier hs-var">flattenSCC</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#flattenSCCs"><span class="hs-identifier hs-var">flattenSCCs</span></a><span class="hs-special">,</span><span> </span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="Digraph.html#stronglyConnCompFromEdgedVerticesUniq"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesUniq</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSet.html"><span class="hs-identifier">UniqSet</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html#first"><span class="hs-identifier hs-var">first</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Set</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span> </span><span class="hs-special">(</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#difference"><span class="hs-identifier hs-var">difference</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">toList</span></a><span class="hs-special">,</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">{- | @rnSourceDecl@ &quot;renames&quot; declarations.
It simultaneously performs dependency analysis and precedence parsing.
It also does the following error checks:

* Checks that tyvars are used properly. This includes checking
  for undefined tyvars, and tyvars in contexts that are ambiguous.
  (Some of this checking has now been moved to module @TcMonoType@,
  since we don't have functional dependency information at this point.)

* Checks that all variable occurrences are defined.

* Checks the @(..)@ etc constraints in the export list.

Brings the binders of the group into scope in the appropriate places;
does NOT assume that anything is in scope already
-}</span><span>
</span><a name="line-84"></a><span class="hs-identifier">rnSrcDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span class="hs-comment">-- Rename a top-level HsGroup; used for normal source files *and* hs-boot files</span><span>
</span><a name="line-86"></a><a name="rnSrcDecls"><a href="RnSource.html#rnSrcDecls"><span class="hs-identifier">rnSrcDecls</span></a></a><span> </span><a name="local-6989586621679820872"><a href="#local-6989586621679820872"><span class="hs-identifier">group</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_valds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820873"><a href="#local-6989586621679820873"><span class="hs-identifier">val_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>                            </span><span class="hs-identifier">hs_splcds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820874"><a href="#local-6989586621679820874"><span class="hs-identifier">splice_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-88"></a><span>                            </span><span class="hs-identifier">hs_tyclds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820875"><a href="#local-6989586621679820875"><span class="hs-identifier">tycl_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>                            </span><span class="hs-identifier">hs_derivds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820876"><a href="#local-6989586621679820876"><span class="hs-identifier">deriv_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>                            </span><span class="hs-identifier">hs_fixds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820877"><a href="#local-6989586621679820877"><span class="hs-identifier">fix_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-91"></a><span>                            </span><span class="hs-identifier">hs_warnds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820878"><a href="#local-6989586621679820878"><span class="hs-identifier">warn_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>                            </span><span class="hs-identifier">hs_annds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820879"><a href="#local-6989586621679820879"><span class="hs-identifier">ann_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>                            </span><span class="hs-identifier">hs_fords</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820880"><a href="#local-6989586621679820880"><span class="hs-identifier">foreign_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>                            </span><span class="hs-identifier">hs_defds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820881"><a href="#local-6989586621679820881"><span class="hs-identifier">default_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>                            </span><span class="hs-identifier">hs_ruleds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820882"><a href="#local-6989586621679820882"><span class="hs-identifier">rule_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-96"></a><span>                            </span><span class="hs-identifier">hs_vects</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820883"><a href="#local-6989586621679820883"><span class="hs-identifier">vect_decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-97"></a><span>                            </span><span class="hs-identifier">hs_docs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820884"><a href="#local-6989586621679820884"><span class="hs-identifier">docs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-99"></a><span>   </span><span class="hs-comment">-- (A) Process the fixity declarations, creating a mapping from</span><span>
</span><a name="line-100"></a><span>   </span><span class="hs-comment">--     FastStrings to FixItems.</span><span>
</span><a name="line-101"></a><span>   </span><span class="hs-comment">--     Also checks for duplicates.</span><span>
</span><a name="line-102"></a><span>   </span><a name="local-6989586621679820885"><a href="#local-6989586621679820885"><span class="hs-identifier">local_fix_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#makeMiniFixityEnv"><span class="hs-identifier hs-var">makeMiniFixityEnv</span></a><span> </span><a href="#local-6989586621679820877"><span class="hs-identifier hs-var">fix_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span>   </span><span class="hs-comment">-- (B) Bring top level binders (and their fixities) into scope,</span><span>
</span><a name="line-105"></a><span>   </span><span class="hs-comment">--     *except* for the value bindings, which get done in step (D)</span><span>
</span><a name="line-106"></a><span>   </span><span class="hs-comment">--     with collectHsIdBinders. However *do* include</span><span>
</span><a name="line-107"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-108"></a><span>   </span><span class="hs-comment">--        * Class ops, data constructors, and record fields,</span><span>
</span><a name="line-109"></a><span>   </span><span class="hs-comment">--          because they do not have value declarations.</span><span>
</span><a name="line-110"></a><span>   </span><span class="hs-comment">--          Aso step (C) depends on datacons and record fields</span><span>
</span><a name="line-111"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-112"></a><span>   </span><span class="hs-comment">--        * For hs-boot files, include the value signatures</span><span>
</span><a name="line-113"></a><span>   </span><span class="hs-comment">--          Again, they have no value declarations</span><span>
</span><a name="line-114"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-115"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679820886"><a href="#local-6989586621679820886"><span class="hs-identifier">tc_envs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679820887"><a href="#local-6989586621679820887"><span class="hs-identifier">tc_bndrs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnNames.html#getLocalNonValBinders"><span class="hs-identifier hs-var">getLocalNonValBinders</span></a><span> </span><a href="#local-6989586621679820885"><span class="hs-identifier hs-var">local_fix_env</span></a><span> </span><a href="#local-6989586621679820872"><span class="hs-identifier hs-var">group</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span>   </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><a href="#local-6989586621679820886"><span class="hs-identifier hs-var">tc_envs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span>   </span><a href="TcRnMonad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a><span> </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- No point in continuing if (say) we have duplicate declarations</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>   </span><span class="hs-comment">-- (D1) Bring pattern synonyms into scope.</span><span>
</span><a name="line-123"></a><span>   </span><span class="hs-comment">--      Need to do this before (D2) because rnTopBindsLHS</span><span>
</span><a name="line-124"></a><span>   </span><span class="hs-comment">--      looks up those pattern synonyms (Trac #9889)</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span>   </span><a href="RnSource.html#extendPatSynEnv"><span class="hs-identifier hs-var">extendPatSynEnv</span></a><span> </span><a href="#local-6989586621679820873"><span class="hs-identifier hs-var">val_decls</span></a><span> </span><a href="#local-6989586621679820885"><span class="hs-identifier hs-var">local_fix_env</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679820888"><a href="#local-6989586621679820888"><span class="hs-identifier">pat_syn_bndrs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>   </span><span class="hs-comment">-- (D2) Rename the left-hand sides of the value bindings.</span><span>
</span><a name="line-129"></a><span>   </span><span class="hs-comment">--     This depends on everything from (B) being in scope,</span><span>
</span><a name="line-130"></a><span>   </span><span class="hs-comment">--     and on (C) for resolving record wild cards.</span><span>
</span><a name="line-131"></a><span>   </span><span class="hs-comment">--     It uses the fixity env from (A) to bind fixities for view patterns.</span><span>
</span><a name="line-132"></a><span>   </span><a name="local-6989586621679820889"><a href="#local-6989586621679820889"><span class="hs-identifier">new_lhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnTopBindsLHS"><span class="hs-identifier hs-var">rnTopBindsLHS</span></a><span> </span><a href="#local-6989586621679820885"><span class="hs-identifier hs-var">local_fix_env</span></a><span> </span><a href="#local-6989586621679820873"><span class="hs-identifier hs-var">val_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span>   </span><span class="hs-comment">-- Bind the LHSes (and their fixities) in the global rdr environment</span><span>
</span><a name="line-135"></a><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679820890"><a href="#local-6989586621679820890"><span class="hs-identifier">id_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#collectHsIdBinders"><span class="hs-identifier hs-var">collectHsIdBinders</span></a><span> </span><a href="#local-6989586621679820889"><span class="hs-identifier hs-var">new_lhs</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>  </span><span class="hs-comment">-- Excludes pattern-synonym binders</span><span>
</span><a name="line-136"></a><span>                                                    </span><span class="hs-comment">-- They are already in scope</span><span>
</span><a name="line-137"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;rnSrcDecls&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679820890"><span class="hs-identifier hs-var">id_bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-138"></a><span>   </span><a name="local-6989586621679820891"><a href="#local-6989586621679820891"><span class="hs-identifier">tc_envs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnNames.html#extendGlobalRdrEnvRn"><span class="hs-identifier hs-var">extendGlobalRdrEnvRn</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Avail.html#avail"><span class="hs-identifier hs-var">avail</span></a><span> </span><a href="#local-6989586621679820890"><span class="hs-identifier hs-var">id_bndrs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679820885"><span class="hs-identifier hs-var">local_fix_env</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-139"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;D2&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_rdr_env</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-6989586621679820891"><span class="hs-identifier hs-var">tc_envs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><a name="line-140"></a><span>   </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><a href="#local-6989586621679820891"><span class="hs-identifier hs-var">tc_envs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>   </span><span class="hs-comment">--  Now everything is in scope, as the remaining renaming assumes.</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span>   </span><span class="hs-comment">-- (E) Rename type and class decls</span><span>
</span><a name="line-145"></a><span>   </span><span class="hs-comment">--     (note that value LHSes need to be in scope for default methods)</span><span>
</span><a name="line-146"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-147"></a><span>   </span><span class="hs-comment">-- You might think that we could build proper def/use information</span><span>
</span><a name="line-148"></a><span>   </span><span class="hs-comment">-- for type and class declarations, but they can be involved</span><span>
</span><a name="line-149"></a><span>   </span><span class="hs-comment">-- in mutual recursion across modules, and we only do the SCC</span><span>
</span><a name="line-150"></a><span>   </span><span class="hs-comment">-- analysis for them in the type checker.</span><span>
</span><a name="line-151"></a><span>   </span><span class="hs-comment">-- So we content ourselves with gathering uses only; that</span><span>
</span><a name="line-152"></a><span>   </span><span class="hs-comment">-- means we'll only report a declaration as unused if it isn't</span><span>
</span><a name="line-153"></a><span>   </span><span class="hs-comment">-- mentioned at all.  Ah well.</span><span>
</span><a name="line-154"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;Start rnTyClDecls&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679820875"><span class="hs-identifier hs-var">tycl_decls</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-155"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679820892"><a href="#local-6989586621679820892"><span class="hs-identifier">rn_tycl_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679820893"><a href="#local-6989586621679820893"><span class="hs-identifier">src_fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnTyClDecls"><span class="hs-identifier hs-var">rnTyClDecls</span></a><span> </span><a href="#local-6989586621679820875"><span class="hs-identifier hs-var">tycl_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>   </span><span class="hs-comment">-- (F) Rename Value declarations right-hand sides</span><span>
</span><a name="line-158"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;Start rnmono&quot;</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-159"></a><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679820894"><a href="#local-6989586621679820894"><span class="hs-identifier">val_bndr_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-6989586621679820890"><span class="hs-identifier hs-var">id_bndrs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-6989586621679820888"><span class="hs-identifier hs-var">pat_syn_bndrs</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-160"></a><span>   </span><a name="local-6989586621679820895"><a href="#local-6989586621679820895"><span class="hs-identifier">is_boot</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#tcIsHsBootOrSig"><span class="hs-identifier hs-var">tcIsHsBootOrSig</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-161"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679820896"><a href="#local-6989586621679820896"><span class="hs-identifier">rn_val_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679820897"><a href="#local-6989586621679820897"><span class="hs-identifier">bind_dus</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679820895"><span class="hs-identifier hs-var">is_boot</span></a><span>
</span><a name="line-162"></a><span>    </span><span class="hs-comment">-- For an hs-boot, use tc_bndrs (which collects how we're renamed</span><span>
</span><a name="line-163"></a><span>    </span><span class="hs-comment">-- signatures), since val_bndr_set is empty (there are no x = ...</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-comment">-- bindings in an hs-boot.)</span><span>
</span><a name="line-165"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="RnBinds.html#rnTopBindsBoot"><span class="hs-identifier hs-var">rnTopBindsBoot</span></a><span> </span><a href="#local-6989586621679820887"><span class="hs-identifier hs-var">tc_bndrs</span></a><span> </span><a href="#local-6989586621679820889"><span class="hs-identifier hs-var">new_lhs</span></a><span>
</span><a name="line-166"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="RnBinds.html#rnValBindsRHS"><span class="hs-identifier hs-var">rnValBindsRHS</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span> </span><a href="#local-6989586621679820894"><span class="hs-identifier hs-var">val_bndr_set</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679820889"><span class="hs-identifier hs-var">new_lhs</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-167"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;finish rnmono&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679820896"><span class="hs-identifier hs-var">rn_val_decls</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>   </span><span class="hs-comment">-- (G) Rename Fixity and deprecations</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span>   </span><span class="hs-comment">-- Rename fixity declarations and error if we try to</span><span>
</span><a name="line-172"></a><span>   </span><span class="hs-comment">-- fix something from another module (duplicates were checked in (A))</span><span>
</span><a name="line-173"></a><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679820898"><a href="#local-6989586621679820898"><span class="hs-identifier">all_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820887"><span class="hs-identifier hs-var">tc_bndrs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679820894"><span class="hs-identifier hs-var">val_bndr_set</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-174"></a><span>   </span><a name="local-6989586621679820899"><a href="#local-6989586621679820899"><span class="hs-identifier">rn_fix_decls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnSrcFixityDecls"><span class="hs-identifier hs-var">rnSrcFixityDecls</span></a><span> </span><a href="#local-6989586621679820898"><span class="hs-identifier hs-var">all_bndrs</span></a><span> </span><a href="#local-6989586621679820877"><span class="hs-identifier hs-var">fix_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span>   </span><span class="hs-comment">-- Rename deprec decls;</span><span>
</span><a name="line-177"></a><span>   </span><span class="hs-comment">-- check for duplicates and ensure that deprecated things are defined locally</span><span>
</span><a name="line-178"></a><span>   </span><span class="hs-comment">-- at the moment, we don't keep these around past renaming</span><span>
</span><a name="line-179"></a><span>   </span><a name="local-6989586621679820900"><a href="#local-6989586621679820900"><span class="hs-identifier">rn_warns</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnSrcWarnDecls"><span class="hs-identifier hs-var">rnSrcWarnDecls</span></a><span> </span><a href="#local-6989586621679820898"><span class="hs-identifier hs-var">all_bndrs</span></a><span> </span><a href="#local-6989586621679820878"><span class="hs-identifier hs-var">warn_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span>   </span><span class="hs-comment">-- (H) Rename Everything else</span><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679820901"><a href="#local-6989586621679820901"><span class="hs-identifier">rn_rule_decls</span></a></a><span class="hs-special">,</span><span>    </span><a name="local-6989586621679820902"><a href="#local-6989586621679820902"><span class="hs-identifier">src_fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setXOptM"><span class="hs-identifier hs-var">setXOptM</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#ScopedTypeVariables"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">ScopedTypeVariables</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-184"></a><span>                                   </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnHsRuleDecls"><span class="hs-identifier hs-var">rnHsRuleDecls</span></a><span> </span><a href="#local-6989586621679820882"><span class="hs-identifier hs-var">rule_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-185"></a><span>                           </span><span class="hs-comment">-- Inside RULES, scoped type variables are on</span><span>
</span><a name="line-186"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679820903"><a href="#local-6989586621679820903"><span class="hs-identifier">rn_vect_decls</span></a></a><span class="hs-special">,</span><span>    </span><a name="local-6989586621679820904"><a href="#local-6989586621679820904"><span class="hs-identifier">src_fvs3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnHsVectDecl"><span class="hs-identifier hs-var">rnHsVectDecl</span></a><span>    </span><a href="#local-6989586621679820883"><span class="hs-identifier hs-var">vect_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-187"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679820905"><a href="#local-6989586621679820905"><span class="hs-identifier">rn_foreign_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679820906"><a href="#local-6989586621679820906"><span class="hs-identifier">src_fvs4</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnHsForeignDecl"><span class="hs-identifier hs-var">rnHsForeignDecl</span></a><span> </span><a href="#local-6989586621679820880"><span class="hs-identifier hs-var">foreign_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-188"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679820907"><a href="#local-6989586621679820907"><span class="hs-identifier">rn_ann_decls</span></a></a><span class="hs-special">,</span><span>     </span><a name="local-6989586621679820908"><a href="#local-6989586621679820908"><span class="hs-identifier">src_fvs5</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnAnnDecl"><span class="hs-identifier hs-var">rnAnnDecl</span></a><span>       </span><a href="#local-6989586621679820879"><span class="hs-identifier hs-var">ann_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-189"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679820909"><a href="#local-6989586621679820909"><span class="hs-identifier">rn_default_decls</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679820910"><a href="#local-6989586621679820910"><span class="hs-identifier">src_fvs6</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnDefaultDecl"><span class="hs-identifier hs-var">rnDefaultDecl</span></a><span>   </span><a href="#local-6989586621679820881"><span class="hs-identifier hs-var">default_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-190"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679820911"><a href="#local-6989586621679820911"><span class="hs-identifier">rn_deriv_decls</span></a></a><span class="hs-special">,</span><span>   </span><a name="local-6989586621679820912"><a href="#local-6989586621679820912"><span class="hs-identifier">src_fvs7</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnSrcDerivDecl"><span class="hs-identifier hs-var">rnSrcDerivDecl</span></a><span>  </span><a href="#local-6989586621679820876"><span class="hs-identifier hs-var">deriv_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-191"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679820913"><a href="#local-6989586621679820913"><span class="hs-identifier">rn_splice_decls</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621679820914"><a href="#local-6989586621679820914"><span class="hs-identifier">src_fvs8</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSplice.html#rnSpliceDecl"><span class="hs-identifier hs-var">rnSpliceDecl</span></a><span>    </span><a href="#local-6989586621679820874"><span class="hs-identifier hs-var">splice_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-192"></a><span>      </span><span class="hs-comment">-- Haddock docs; no free vars</span><span>
</span><a name="line-193"></a><span>   </span><a name="local-6989586621679820915"><a href="#local-6989586621679820915"><span class="hs-identifier">rn_docs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="RnSource.html#rnDocDecl"><span class="hs-identifier hs-var">rnDocDecl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679820884"><span class="hs-identifier hs-var">docs</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>   </span><a name="local-6989586621679820916"><a href="#local-6989586621679820916"><span class="hs-identifier">last_tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-196"></a><span>   </span><span class="hs-comment">-- (I) Compute the results and return</span><span>
</span><a name="line-197"></a><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><a name="local-6989586621679820917"><a href="#local-6989586621679820917"><span class="hs-identifier">rn_group</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_valds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820896"><span class="hs-identifier hs-var">rn_val_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-198"></a><span>                             </span><span class="hs-identifier">hs_splcds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820913"><span class="hs-identifier hs-var">rn_splice_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-199"></a><span>                             </span><span class="hs-identifier">hs_tyclds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820892"><span class="hs-identifier hs-var">rn_tycl_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-200"></a><span>                             </span><span class="hs-identifier">hs_derivds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820911"><span class="hs-identifier hs-var">rn_deriv_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-201"></a><span>                             </span><span class="hs-identifier">hs_fixds</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820899"><span class="hs-identifier hs-var">rn_fix_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-202"></a><span>                             </span><span class="hs-identifier">hs_warnds</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- warns are returned in the tcg_env</span><span>
</span><a name="line-203"></a><span>                                             </span><span class="hs-comment">-- (see below) not in the HsGroup</span><span>
</span><a name="line-204"></a><span>                             </span><span class="hs-identifier">hs_fords</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820905"><span class="hs-identifier hs-var">rn_foreign_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-205"></a><span>                             </span><span class="hs-identifier">hs_annds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820907"><span class="hs-identifier hs-var">rn_ann_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-206"></a><span>                             </span><span class="hs-identifier">hs_defds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820909"><span class="hs-identifier hs-var">rn_default_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-207"></a><span>                             </span><span class="hs-identifier">hs_ruleds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820901"><span class="hs-identifier hs-var">rn_rule_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-208"></a><span>                             </span><span class="hs-identifier">hs_vects</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820903"><span class="hs-identifier hs-var">rn_vect_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-209"></a><span>                             </span><span class="hs-identifier">hs_docs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820915"><span class="hs-identifier hs-var">rn_docs</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>        </span><a name="local-6989586621679820918"><a href="#local-6989586621679820918"><span class="hs-identifier">tcf_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#hsTyClForeignBinders"><span class="hs-identifier hs-var">hsTyClForeignBinders</span></a><span> </span><a href="#local-6989586621679820892"><span class="hs-identifier hs-var">rn_tycl_decls</span></a><span> </span><a href="#local-6989586621679820905"><span class="hs-identifier hs-var">rn_foreign_decls</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-212"></a><span>        </span><a name="local-6989586621679820919"><a href="#local-6989586621679820919"><span class="hs-identifier">other_def</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-6989586621679820918"><span class="hs-identifier hs-var">tcf_bndrs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-213"></a><span>        </span><a name="local-6989586621679820920"><a href="#local-6989586621679820920"><span class="hs-identifier">other_fvs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679820893"><span class="hs-identifier hs-var">src_fvs1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820902"><span class="hs-identifier hs-var">src_fvs2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820904"><span class="hs-identifier hs-var">src_fvs3</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820906"><span class="hs-identifier hs-var">src_fvs4</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820908"><span class="hs-identifier hs-var">src_fvs5</span></a><span class="hs-special">,</span><span>
</span><a name="line-214"></a><span>                              </span><a href="#local-6989586621679820910"><span class="hs-identifier hs-var">src_fvs6</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820912"><span class="hs-identifier hs-var">src_fvs7</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820914"><span class="hs-identifier hs-var">src_fvs8</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-215"></a><span>                </span><span class="hs-comment">-- It is tiresome to gather the binders from type and class decls</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span>        </span><a name="local-6989586621679820921"><a href="#local-6989586621679820921"><span class="hs-identifier">src_dus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679820919"><span class="hs-identifier hs-var">other_def</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusDU"><span class="hs-identifier hs-var">plusDU</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679820897"><span class="hs-identifier hs-var">bind_dus</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusDU"><span class="hs-identifier hs-var">plusDU</span></a><span class="hs-special">`</span><span> </span><a href="NameSet.html#usesOnly"><span class="hs-identifier hs-var">usesOnly</span></a><span> </span><a href="#local-6989586621679820920"><span class="hs-identifier hs-var">other_fvs</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-218"></a><span>                </span><span class="hs-comment">-- Instance decls may have occurrences of things bound in bind_dus</span><span>
</span><a name="line-219"></a><span>                </span><span class="hs-comment">-- so we must put other_fvs last</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span>        </span><a name="local-6989586621679820922"><a href="#local-6989586621679820922"><span class="hs-identifier">final_tcg_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679820923"><a href="#local-6989586621679820923"><span class="hs-identifier">tcg_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820916"><span class="hs-identifier hs-var">last_tcg_env</span></a><span> </span><span class="hs-special">`</span><a href="RnSource.html#addTcgDUs"><span class="hs-identifier hs-var">addTcgDUs</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679820921"><span class="hs-identifier hs-var">src_dus</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>                        </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- we return the deprecs in the env, not in the HsGroup above</span><span>
</span><a name="line-223"></a><span>                        </span><a href="#local-6989586621679820923"><span class="hs-identifier hs-var">tcg_env'</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_warns</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_warns</span><span> </span><a href="#local-6989586621679820923"><span class="hs-identifier hs-var">tcg_env'</span></a><span> </span><span class="hs-special">`</span><a href="HscTypes.html#plusWarns"><span class="hs-identifier hs-var">plusWarns</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679820900"><span class="hs-identifier hs-var">rn_warns</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">;</span><span>
</span><a name="line-224"></a><span>       </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-225"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;last&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_rdr_env</span><span> </span><a href="#local-6989586621679820922"><span class="hs-identifier hs-var">final_tcg_env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-226"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;finish rnSrc&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679820917"><span class="hs-identifier hs-var">rn_group</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-227"></a><span>   </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;finish Dus&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679820921"><span class="hs-identifier hs-var">src_dus</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-228"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820922"><span class="hs-identifier hs-var">final_tcg_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820917"><span class="hs-identifier hs-var">rn_group</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>                    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-identifier">addTcgDUs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-232"></a><span class="hs-comment">-- This function could be defined lower down in the module hierarchy,</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- but there doesn't seem anywhere very logical to put it.</span><span>
</span><a name="line-234"></a><a name="addTcgDUs"><a href="RnSource.html#addTcgDUs"><span class="hs-identifier">addTcgDUs</span></a></a><span> </span><a name="local-6989586621679820924"><a href="#local-6989586621679820924"><span class="hs-identifier">tcg_env</span></a></a><span> </span><a name="local-6989586621679820925"><a href="#local-6989586621679820925"><span class="hs-identifier">dus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820924"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_dus</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_dus</span><span> </span><a href="#local-6989586621679820924"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusDU"><span class="hs-identifier hs-var">plusDU</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679820925"><span class="hs-identifier hs-var">dus</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-identifier">rnList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820870"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820871"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="#local-6989586621679820870"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="#local-6989586621679820871"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-237"></a><a name="rnList"><a href="RnSource.html#rnList"><span class="hs-identifier">rnList</span></a></a><span> </span><a name="local-6989586621679820926"><a href="#local-6989586621679820926"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679820927"><a href="#local-6989586621679820927"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><a href="#local-6989586621679820926"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679820927"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-comment">{-
*********************************************************
*                                                       *
        HsDoc stuff
*                                                       *
*********************************************************
-}</span><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-identifier">rnDocDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#DocDecl"><span class="hs-identifier hs-type">DocDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><a href="HsDecls.html#DocDecl"><span class="hs-identifier hs-type">DocDecl</span></a><span>
</span><a name="line-248"></a><a name="rnDocDecl"><a href="RnSource.html#rnDocDecl"><span class="hs-identifier">rnDocDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentNext"><span class="hs-identifier hs-var">DocCommentNext</span></a><span> </span><a name="local-6989586621679820928"><a href="#local-6989586621679820928"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-249"></a><span>  </span><a name="local-6989586621679820929"><a href="#local-6989586621679820929"><span class="hs-identifier">rn_doc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a><span> </span><a href="#local-6989586621679820928"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-250"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentNext"><span class="hs-identifier hs-var">DocCommentNext</span></a><span> </span><a href="#local-6989586621679820929"><span class="hs-identifier hs-var">rn_doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-251"></a><span class="hs-identifier">rnDocDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentPrev"><span class="hs-identifier hs-var">DocCommentPrev</span></a><span> </span><a name="local-6989586621679820930"><a href="#local-6989586621679820930"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-252"></a><span>  </span><a name="local-6989586621679820931"><a href="#local-6989586621679820931"><span class="hs-identifier">rn_doc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a><span> </span><a href="#local-6989586621679820930"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-253"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentPrev"><span class="hs-identifier hs-var">DocCommentPrev</span></a><span> </span><a href="#local-6989586621679820931"><span class="hs-identifier hs-var">rn_doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span class="hs-identifier">rnDocDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentNamed"><span class="hs-identifier hs-var">DocCommentNamed</span></a><span> </span><a name="local-6989586621679820932"><a href="#local-6989586621679820932"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621679820933"><a href="#local-6989586621679820933"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-255"></a><span>  </span><a name="local-6989586621679820934"><a href="#local-6989586621679820934"><span class="hs-identifier">rn_doc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a><span> </span><a href="#local-6989586621679820933"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-256"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocCommentNamed"><span class="hs-identifier hs-var">DocCommentNamed</span></a><span> </span><a href="#local-6989586621679820932"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="#local-6989586621679820934"><span class="hs-identifier hs-var">rn_doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span class="hs-identifier">rnDocDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocGroup"><span class="hs-identifier hs-var">DocGroup</span></a><span> </span><a name="local-6989586621679820935"><a href="#local-6989586621679820935"><span class="hs-identifier">lev</span></a></a><span> </span><a name="local-6989586621679820936"><a href="#local-6989586621679820936"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-258"></a><span>  </span><a name="local-6989586621679820937"><a href="#local-6989586621679820937"><span class="hs-identifier">rn_doc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnHsDoc"><span class="hs-identifier hs-var">rnHsDoc</span></a><span> </span><a href="#local-6989586621679820936"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-259"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocGroup"><span class="hs-identifier hs-var">DocGroup</span></a><span> </span><a href="#local-6989586621679820935"><span class="hs-identifier hs-var">lev</span></a><span> </span><a href="#local-6989586621679820937"><span class="hs-identifier hs-var">rn_doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">{-
*********************************************************
*                                                       *
        Source-code fixity declarations
*                                                       *
*********************************************************
-}</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-identifier">rnSrcFixityDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LFixitySig"><span class="hs-identifier hs-type">LFixitySig</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LFixitySig"><span class="hs-identifier hs-type">LFixitySig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- Rename the fixity decls, so we can put</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- the renamed decls in the renamed syntax tree</span><span>
</span><a name="line-272"></a><span class="hs-comment">-- Errors if the thing being fixed is not defined locally.</span><span>
</span><a name="line-273"></a><span class="hs-comment">--</span><span>
</span><a name="line-274"></a><span class="hs-comment">-- The returned FixitySigs are not actually used for anything,</span><span>
</span><a name="line-275"></a><span class="hs-comment">-- except perhaps the GHCi API</span><span>
</span><a name="line-276"></a><a name="rnSrcFixityDecls"><a href="RnSource.html#rnSrcFixityDecls"><span class="hs-identifier">rnSrcFixityDecls</span></a></a><span> </span><a name="local-6989586621679820938"><a href="#local-6989586621679820938"><span class="hs-identifier">bndr_set</span></a></a><span> </span><a name="local-6989586621679820939"><a href="#local-6989586621679820939"><span class="hs-identifier">fix_decls</span></a></a><span>
</span><a name="line-277"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679820953"><a href="#local-6989586621679820953"><span class="hs-identifier">fix_decls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-6989586621679820941"><span class="hs-identifier hs-var">rn_decl</span></a><span> </span><a href="#local-6989586621679820939"><span class="hs-identifier hs-var">fix_decls</span></a><span>
</span><a name="line-278"></a><span>       </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="#local-6989586621679820953"><span class="hs-identifier hs-var">fix_decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-280"></a><span>    </span><a name="local-6989586621679820940"><a href="#local-6989586621679820940"><span class="hs-identifier">sig_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span> </span><a href="#local-6989586621679820938"><span class="hs-identifier hs-var">bndr_set</span></a><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span>    </span><span class="hs-identifier">rn_decl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LFixitySig"><span class="hs-identifier hs-type">LFixitySig</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LFixitySig"><span class="hs-identifier hs-type">LFixitySig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-283"></a><span>        </span><span class="hs-comment">-- GHC extension: look up both the tycon and data con</span><span>
</span><a name="line-284"></a><span>        </span><span class="hs-comment">-- for con-like things; hence returning a list</span><span>
</span><a name="line-285"></a><span>        </span><span class="hs-comment">-- If neither are in scope, report an error; otherwise</span><span>
</span><a name="line-286"></a><span>        </span><span class="hs-comment">-- return a fixity sig for each (slightly odd)</span><span>
</span><a name="line-287"></a><span>    </span><a name="local-6989586621679820941"><a href="#local-6989586621679820941"><span class="hs-identifier">rn_decl</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679820944"><a href="#local-6989586621679820944"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FixitySig"><span class="hs-identifier hs-var">FixitySig</span></a><span> </span><a name="local-6989586621679820945"><a href="#local-6989586621679820945"><span class="hs-identifier">fnames</span></a></a><span> </span><a name="local-6989586621679820946"><a href="#local-6989586621679820946"><span class="hs-identifier">fixity</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679820947"><a href="#local-6989586621679820947"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="#local-6989586621679820942"><span class="hs-identifier hs-var">lookup_one</span></a><span> </span><a href="#local-6989586621679820945"><span class="hs-identifier hs-var">fnames</span></a><span>
</span><a name="line-289"></a><span>           </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679820944"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FixitySig"><span class="hs-identifier hs-var">FixitySig</span></a><span> </span><a href="#local-6989586621679820948"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679820946"><span class="hs-identifier hs-var">fixity</span></a><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679820948"><a href="#local-6989586621679820948"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679820947"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span>    </span><span class="hs-identifier">lookup_one</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-293"></a><span>    </span><a name="local-6989586621679820942"><a href="#local-6989586621679820942"><span class="hs-identifier">lookup_one</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679820949"><a href="#local-6989586621679820949"><span class="hs-identifier">name_loc</span></a></a><span> </span><a name="local-6989586621679820950"><a href="#local-6989586621679820950"><span class="hs-identifier">rdr_name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621679820949"><span class="hs-identifier hs-var">name_loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-295"></a><span>                    </span><span class="hs-comment">-- this lookup will fail if the definition isn't local</span><span>
</span><a name="line-296"></a><span>        </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679820951"><a href="#local-6989586621679820951"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocalTcNames"><span class="hs-identifier hs-var">lookupLocalTcNames</span></a><span> </span><a href="#local-6989586621679820940"><span class="hs-identifier hs-var">sig_ctxt</span></a><span> </span><a href="#local-6989586621679820943"><span class="hs-identifier hs-var">what</span></a><span> </span><a href="#local-6989586621679820950"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-297"></a><span>           </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679820949"><span class="hs-identifier hs-var">name_loc</span></a><span> </span><a href="#local-6989586621679820952"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679820952"><a href="#local-6989586621679820952"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679820951"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-298"></a><span>    </span><a name="local-6989586621679820943"><a href="#local-6989586621679820943"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;fixity signature&quot;</span><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span class="hs-comment">{-
*********************************************************
*                                                       *
        Source-code deprecations declarations
*                                                       *
*********************************************************

Check that the deprecated names are defined, are defined locally, and
that there are no duplicate deprecations.

It's only imported deprecations, dealt with in RnIfaces, that we
gather them together.
-}</span><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-comment">-- checks that the deprecations are defined locally, and that there are no duplicates</span><span>
</span><a name="line-315"></a><span class="hs-identifier">rnSrcWarnDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LWarnDecls"><span class="hs-identifier hs-type">LWarnDecls</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span>
</span><a name="line-316"></a><a name="rnSrcWarnDecls"><a href="RnSource.html#rnSrcWarnDecls"><span class="hs-identifier">rnSrcWarnDecls</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-317"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="HscTypes.html#NoWarnings"><span class="hs-identifier hs-var">NoWarnings</span></a><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-identifier">rnSrcWarnDecls</span><span> </span><a name="local-6989586621679820954"><a href="#local-6989586621679820954"><span class="hs-identifier">bndr_set</span></a></a><span> </span><a name="local-6989586621679820955"><a href="#local-6989586621679820955"><span class="hs-identifier">decls'</span></a></a><span>
</span><a name="line-320"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- check for duplicates</span><span>
</span><a name="line-321"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679820967"><a href="#local-6989586621679820967"><span class="hs-identifier">dups</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679820968"><a href="#local-6989586621679820968"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679820969"><a href="#local-6989586621679820969"><span class="hs-identifier">rdr</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679820970"><a href="#local-6989586621679820970"><span class="hs-identifier">lrdr'</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820967"><span class="hs-identifier hs-var">dups</span></a><span>
</span><a name="line-322"></a><span>                          </span><span class="hs-keyword">in</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-6989586621679820968"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#dupWarnDecl"><span class="hs-identifier hs-var">dupWarnDecl</span></a><span> </span><a href="#local-6989586621679820970"><span class="hs-identifier hs-var">lrdr'</span></a><span> </span><a href="#local-6989586621679820969"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-323"></a><span>               </span><a href="#local-6989586621679820960"><span class="hs-identifier hs-var">warn_rdr_dups</span></a><span>
</span><a name="line-324"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679820971"><a href="#local-6989586621679820971"><span class="hs-identifier">pairs_s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a><span> </span><a href="#local-6989586621679820958"><span class="hs-identifier hs-var">rn_deprec</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679820956"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-325"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnSome"><span class="hs-identifier hs-var">WarnSome</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><a href="#local-6989586621679820971"><span class="hs-identifier hs-var">pairs_s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-326"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-327"></a><span>   </span><a name="local-6989586621679820956"><a href="#local-6989586621679820956"><span class="hs-identifier">decls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679820961"><a href="#local-6989586621679820961"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">wd_warnings</span><span> </span><a href="#local-6989586621679820961"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679820955"><span class="hs-identifier hs-var">decls'</span></a><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span>   </span><a name="local-6989586621679820957"><a href="#local-6989586621679820957"><span class="hs-identifier">sig_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span> </span><a href="#local-6989586621679820954"><span class="hs-identifier hs-var">bndr_set</span></a><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span>   </span><a name="local-6989586621679820958"><a href="#local-6989586621679820958"><span class="hs-identifier">rn_deprec</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#Warning"><span class="hs-identifier hs-var">Warning</span></a><span> </span><a name="local-6989586621679820962"><a href="#local-6989586621679820962"><span class="hs-identifier">rdr_names</span></a></a><span> </span><a name="local-6989586621679820963"><a href="#local-6989586621679820963"><span class="hs-identifier">txt</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-332"></a><span>       </span><span class="hs-comment">-- ensures that the names are defined locally</span><span>
</span><a name="line-333"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679820964"><a href="#local-6989586621679820964"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MonadUtils.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupLocalTcNames"><span class="hs-identifier hs-var">lookupLocalTcNames</span></a><span> </span><a href="#local-6989586621679820957"><span class="hs-identifier hs-var">sig_ctxt</span></a><span> </span><a href="#local-6989586621679820959"><span class="hs-identifier hs-var">what</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>                                </span><a href="#local-6989586621679820962"><span class="hs-identifier hs-var">rdr_names</span></a><span>
</span><a name="line-335"></a><span>          </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><a href="#local-6989586621679820965"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820963"><span class="hs-identifier hs-var">txt</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679820965"><a href="#local-6989586621679820965"><span class="hs-identifier">rdr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679820964"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span>   </span><a name="local-6989586621679820959"><a href="#local-6989586621679820959"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;deprecation&quot;</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span>   </span><a name="local-6989586621679820960"><a href="#local-6989586621679820960"><span class="hs-identifier">warn_rdr_dups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#findDupRdrNames"><span class="hs-identifier hs-var">findDupRdrNames</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#Warning"><span class="hs-identifier hs-var">Warning</span></a><span> </span><a name="local-6989586621679820966"><a href="#local-6989586621679820966"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679820966"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-340"></a><span>                                               </span><a href="#local-6989586621679820956"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-identifier">findDupRdrNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-343"></a><a name="findDupRdrNames"><a href="RnSource.html#findDupRdrNames"><span class="hs-identifier">findDupRdrNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ListSetOps.html#findDupsEq"><span class="hs-identifier hs-var">findDupsEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679820972"><a href="#local-6989586621679820972"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679820973"><a href="#local-6989586621679820973"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679820972"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679820973"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-comment">-- look for duplicates among the OccNames;</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- we check that the names are defined above</span><span>
</span><a name="line-347"></a><span class="hs-comment">-- invt: the lists returned by findDupsEq always have at least two elements</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-identifier">dupWarnDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-350"></a><span class="hs-comment">-- Located RdrName -&gt; DeprecDecl RdrName -&gt; SDoc</span><span>
</span><a name="line-351"></a><a name="dupWarnDecl"><a href="RnSource.html#dupWarnDecl"><span class="hs-identifier">dupWarnDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679820974"><a href="#local-6989586621679820974"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679820975"><a href="#local-6989586621679820975"><span class="hs-identifier">rdr_name</span></a></a><span>
</span><a name="line-352"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Multiple warning declarations for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679820975"><span class="hs-identifier hs-var">rdr_name</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-353"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;also at &quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679820974"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">]</span><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Annotation declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-identifier">rnAnnDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#AnnDecl"><span class="hs-identifier hs-type">AnnDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#AnnDecl"><span class="hs-identifier hs-type">AnnDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><a name="rnAnnDecl"><a href="RnSource.html#rnAnnDecl"><span class="hs-identifier">rnAnnDecl</span></a></a><span> </span><a name="local-6989586621679820976"><a href="#local-6989586621679820976"><span class="hs-identifier">ann</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsAnnotation"><span class="hs-identifier hs-var">HsAnnotation</span></a><span> </span><a name="local-6989586621679820977"><a href="#local-6989586621679820977"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679820978"><a href="#local-6989586621679820978"><span class="hs-identifier">provenance</span></a></a><span> </span><a name="local-6989586621679820979"><a href="#local-6989586621679820979"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-365"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><a href="TcAnnotations.html#annCtxt"><span class="hs-identifier hs-var">annCtxt</span></a><span> </span><a href="#local-6989586621679820976"><span class="hs-identifier hs-var">ann</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-366"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679820980"><a href="#local-6989586621679820980"><span class="hs-identifier">provenance'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679820981"><a href="#local-6989586621679820981"><span class="hs-identifier">provenance_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnAnnProvenance"><span class="hs-identifier hs-var">rnAnnProvenance</span></a><span> </span><a href="#local-6989586621679820978"><span class="hs-identifier hs-var">provenance</span></a><span>
</span><a name="line-367"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679820982"><a href="#local-6989586621679820982"><span class="hs-identifier">expr'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679820983"><a href="#local-6989586621679820983"><span class="hs-identifier">expr_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Splice"><span class="hs-identifier hs-var">Splice</span></a><span> </span><a href="TcRnTypes.html#Untyped"><span class="hs-identifier hs-var">Untyped</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-368"></a><span>                              </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621679820979"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-369"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsAnnotation"><span class="hs-identifier hs-var">HsAnnotation</span></a><span> </span><a href="#local-6989586621679820977"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679820980"><span class="hs-identifier hs-var">provenance'</span></a><span> </span><a href="#local-6989586621679820982"><span class="hs-identifier hs-var">expr'</span></a><span class="hs-special">,</span><span>
</span><a name="line-370"></a><span>                 </span><a href="#local-6989586621679820981"><span class="hs-identifier hs-var">provenance_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679820983"><span class="hs-identifier hs-var">expr_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-371"></a><span>
</span><a name="line-372"></a><span class="hs-identifier">rnAnnProvenance</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#AnnProvenance"><span class="hs-identifier hs-type">AnnProvenance</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#AnnProvenance"><span class="hs-identifier hs-type">AnnProvenance</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-373"></a><a name="rnAnnProvenance"><a href="RnSource.html#rnAnnProvenance"><span class="hs-identifier">rnAnnProvenance</span></a></a><span> </span><a name="local-6989586621679820984"><a href="#local-6989586621679820984"><span class="hs-identifier">provenance</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-374"></a><span>    </span><a name="local-6989586621679820985"><a href="#local-6989586621679820985"><span class="hs-identifier">provenance'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a><span> </span><a href="RnEnv.html#lookupTopBndrRn"><span class="hs-identifier hs-var">lookupTopBndrRn</span></a><span> </span><a href="#local-6989586621679820984"><span class="hs-identifier hs-var">provenance</span></a><span>
</span><a name="line-375"></a><span>    </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820985"><span class="hs-identifier hs-var">provenance'</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#annProvenanceName_maybe"><span class="hs-identifier hs-var">annProvenanceName_maybe</span></a><span> </span><a href="#local-6989586621679820985"><span class="hs-identifier hs-var">provenance'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>
</span><a name="line-377"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Default declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span class="hs-identifier">rnDefaultDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#DefaultDecl"><span class="hs-identifier hs-type">DefaultDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DefaultDecl"><span class="hs-identifier hs-type">DefaultDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><a name="rnDefaultDecl"><a href="RnSource.html#rnDefaultDecl"><span class="hs-identifier">rnDefaultDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DefaultDecl"><span class="hs-identifier hs-var">DefaultDecl</span></a><span> </span><a name="local-6989586621679820986"><a href="#local-6989586621679820986"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679820988"><a href="#local-6989586621679820988"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679820989"><a href="#local-6989586621679820989"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTypes"><span class="hs-identifier hs-var">rnLHsTypes</span></a><span> </span><a href="#local-6989586621679820987"><span class="hs-identifier hs-var">doc_str</span></a><span> </span><a href="#local-6989586621679820986"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-388"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DefaultDecl"><span class="hs-identifier hs-var">DefaultDecl</span></a><span> </span><a href="#local-6989586621679820988"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820989"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-389"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-390"></a><span>    </span><a name="local-6989586621679820987"><a href="#local-6989586621679820987"><span class="hs-identifier">doc_str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#DefaultDeclCtx"><span class="hs-identifier hs-var">DefaultDeclCtx</span></a><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Foreign declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-identifier">rnHsForeignDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#ForeignDecl"><span class="hs-identifier hs-type">ForeignDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForeignDecl"><span class="hs-identifier hs-type">ForeignDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-401"></a><a name="rnHsForeignDecl"><a href="RnSource.html#rnHsForeignDecl"><span class="hs-identifier">rnHsForeignDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForeignImport"><span class="hs-identifier hs-var">ForeignImport</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fd_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820990"><a href="#local-6989586621679820990"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_sig_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820991"><a href="#local-6989586621679820991"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_fi</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820992"><a href="#local-6989586621679820992"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679820993"><a href="#local-6989586621679820993"><span class="hs-identifier">topEnv</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a><span>
</span><a name="line-403"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679820994"><a href="#local-6989586621679820994"><span class="hs-identifier">name'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-6989586621679820990"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-404"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679820995"><a href="#local-6989586621679820995"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679820996"><a href="#local-6989586621679820996"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><span class="hs-special">(</span><a href="RnUtils.html#ForeignDeclCtx"><span class="hs-identifier hs-var">ForeignDeclCtx</span></a><span> </span><a href="#local-6989586621679820990"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679820991"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span>        </span><span class="hs-comment">-- Mark any PackageTarget style imports as coming from the current package</span><span>
</span><a name="line-407"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679820997"><a href="#local-6989586621679820997"><span class="hs-identifier">unitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#thisPackage"><span class="hs-identifier hs-var">thisPackage</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621679820993"><span class="hs-identifier hs-var">topEnv</span></a><span>
</span><a name="line-408"></a><span>             </span><a name="local-6989586621679820998"><a href="#local-6989586621679820998"><span class="hs-identifier">spec'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#patchForeignImport"><span class="hs-identifier hs-var">patchForeignImport</span></a><span> </span><a href="#local-6989586621679820997"><span class="hs-identifier hs-var">unitId</span></a><span> </span><a href="#local-6989586621679820992"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-409"></a><span>
</span><a name="line-410"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForeignImport"><span class="hs-identifier hs-var">ForeignImport</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fd_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820994"><span class="hs-identifier hs-var">name'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_sig_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820995"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-411"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_co</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#noForeignImportCoercionYet"><span class="hs-identifier hs-var">noForeignImportCoercionYet</span></a><span>
</span><a name="line-412"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_fi</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679820998"><span class="hs-identifier hs-var">spec'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820996"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span class="hs-identifier">rnHsForeignDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForeignExport"><span class="hs-identifier hs-var">ForeignExport</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fd_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679820999"><a href="#local-6989586621679820999"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_sig_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821000"><a href="#local-6989586621679821000"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_fe</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821001"><a href="#local-6989586621679821001"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-415"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821002"><a href="#local-6989586621679821002"><span class="hs-identifier">name'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-6989586621679820999"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-416"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821003"><a href="#local-6989586621679821003"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821004"><a href="#local-6989586621679821004"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><span class="hs-special">(</span><a href="RnUtils.html#ForeignDeclCtx"><span class="hs-identifier hs-var">ForeignDeclCtx</span></a><span> </span><a href="#local-6989586621679820999"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821000"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-417"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForeignExport"><span class="hs-identifier hs-var">ForeignExport</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fd_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821002"><span class="hs-identifier hs-var">name'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_sig_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821003"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-418"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_co</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#noForeignExportCoercionYet"><span class="hs-identifier hs-var">noForeignExportCoercionYet</span></a><span>
</span><a name="line-419"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_fe</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821001"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-420"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821004"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#addOneFV"><span class="hs-identifier hs-var">addOneFV</span></a><span class="hs-special">`</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821002"><span class="hs-identifier hs-var">name'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-421"></a><span>        </span><span class="hs-comment">-- NB: a foreign export is an *occurrence site* for name, so</span><span>
</span><a name="line-422"></a><span>        </span><span class="hs-comment">--     we add it to the free-variable list.  It might, for example,</span><span>
</span><a name="line-423"></a><span>        </span><span class="hs-comment">--     be imported from another module</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span class="hs-comment">-- | For Windows DLLs we need to know what packages imported symbols are from</span><span>
</span><a name="line-426"></a><span class="hs-comment">--      to generate correct calls. Imported symbols are tagged with the current</span><span>
</span><a name="line-427"></a><span class="hs-comment">--      package, so if they get inlined across a package boundry we'll still</span><span>
</span><a name="line-428"></a><span class="hs-comment">--      know where they're from.</span><span>
</span><a name="line-429"></a><span class="hs-comment">--</span><span>
</span><a name="line-430"></a><span class="hs-identifier">patchForeignImport</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#ForeignImport"><span class="hs-identifier hs-type">ForeignImport</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#ForeignImport"><span class="hs-identifier hs-type">ForeignImport</span></a><span>
</span><a name="line-431"></a><a name="patchForeignImport"><a href="RnSource.html#patchForeignImport"><span class="hs-identifier">patchForeignImport</span></a></a><span> </span><a name="local-6989586621679821005"><a href="#local-6989586621679821005"><span class="hs-identifier">unitId</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#CImport"><span class="hs-identifier hs-var">CImport</span></a><span> </span><a name="local-6989586621679821006"><a href="#local-6989586621679821006"><span class="hs-identifier">cconv</span></a></a><span> </span><a name="local-6989586621679821007"><a href="#local-6989586621679821007"><span class="hs-identifier">safety</span></a></a><span> </span><a name="local-6989586621679821008"><a href="#local-6989586621679821008"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621679821009"><a href="#local-6989586621679821009"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679821010"><a href="#local-6989586621679821010"><span class="hs-identifier">src</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-432"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#CImport"><span class="hs-identifier hs-var">CImport</span></a><span> </span><a href="#local-6989586621679821006"><span class="hs-identifier hs-var">cconv</span></a><span> </span><a href="#local-6989586621679821007"><span class="hs-identifier hs-var">safety</span></a><span> </span><a href="#local-6989586621679821008"><span class="hs-identifier hs-var">fs</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#patchCImportSpec"><span class="hs-identifier hs-var">patchCImportSpec</span></a><span> </span><a href="#local-6989586621679821005"><span class="hs-identifier hs-var">unitId</span></a><span> </span><a href="#local-6989586621679821009"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821010"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span class="hs-identifier">patchCImportSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#CImportSpec"><span class="hs-identifier hs-type">CImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#CImportSpec"><span class="hs-identifier hs-type">CImportSpec</span></a><span>
</span><a name="line-435"></a><a name="patchCImportSpec"><a href="RnSource.html#patchCImportSpec"><span class="hs-identifier">patchCImportSpec</span></a></a><span> </span><a name="local-6989586621679821011"><a href="#local-6989586621679821011"><span class="hs-identifier">unitId</span></a></a><span> </span><a name="local-6989586621679821012"><a href="#local-6989586621679821012"><span class="hs-identifier">spec</span></a></a><span>
</span><a name="line-436"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821012"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-437"></a><span>        </span><a href="HsDecls.html#CFunction"><span class="hs-identifier hs-var">CFunction</span></a><span> </span><a name="local-6989586621679821013"><a href="#local-6989586621679821013"><span class="hs-identifier">callTarget</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#CFunction"><span class="hs-identifier hs-var">CFunction</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="RnSource.html#patchCCallTarget"><span class="hs-identifier hs-var">patchCCallTarget</span></a><span> </span><a href="#local-6989586621679821011"><span class="hs-identifier hs-var">unitId</span></a><span> </span><a href="#local-6989586621679821013"><span class="hs-identifier hs-var">callTarget</span></a><span>
</span><a name="line-438"></a><span>        </span><span class="hs-identifier">_</span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821012"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-identifier">patchCCallTarget</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ForeignCall.html#CCallTarget"><span class="hs-identifier hs-type">CCallTarget</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ForeignCall.html#CCallTarget"><span class="hs-identifier hs-type">CCallTarget</span></a><span>
</span><a name="line-441"></a><a name="patchCCallTarget"><a href="RnSource.html#patchCCallTarget"><span class="hs-identifier">patchCCallTarget</span></a></a><span> </span><a name="local-6989586621679821014"><a href="#local-6989586621679821014"><span class="hs-identifier">unitId</span></a></a><span> </span><a name="local-6989586621679821015"><a href="#local-6989586621679821015"><span class="hs-identifier">callTarget</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-442"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821015"><span class="hs-identifier hs-var">callTarget</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-443"></a><span>  </span><a href="ForeignCall.html#StaticTarget"><span class="hs-identifier hs-var">StaticTarget</span></a><span> </span><a name="local-6989586621679821016"><a href="#local-6989586621679821016"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621679821017"><a href="#local-6989586621679821017"><span class="hs-identifier">label</span></a></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a name="local-6989586621679821018"><a href="#local-6989586621679821018"><span class="hs-identifier">isFun</span></a></a><span>
</span><a name="line-444"></a><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ForeignCall.html#StaticTarget"><span class="hs-identifier hs-var">StaticTarget</span></a><span> </span><a href="#local-6989586621679821016"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621679821017"><span class="hs-identifier hs-var">label</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679821014"><span class="hs-identifier hs-var">unitId</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821018"><span class="hs-identifier hs-var">isFun</span></a><span>
</span><a name="line-445"></a><span>  </span><span class="hs-identifier">_</span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821015"><span class="hs-identifier hs-var">callTarget</span></a><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Instance declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-454"></a><span>
</span><a name="line-455"></a><span class="hs-identifier">rnSrcInstDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#InstDecl"><span class="hs-identifier hs-type">InstDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InstDecl"><span class="hs-identifier hs-type">InstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-456"></a><a name="rnSrcInstDecl"><a href="RnSource.html#rnSrcInstDecl"><span class="hs-identifier">rnSrcInstDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstD"><span class="hs-identifier hs-var">TyFamInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821019"><a href="#local-6989586621679821019"><span class="hs-identifier">tfi</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821020"><a href="#local-6989586621679821020"><span class="hs-identifier">tfi'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821021"><a href="#local-6989586621679821021"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnTyFamInstDecl"><span class="hs-identifier hs-var">rnTyFamInstDecl</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679821019"><span class="hs-identifier hs-var">tfi</span></a><span>
</span><a name="line-458"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstD"><span class="hs-identifier hs-var">TyFamInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821020"><span class="hs-identifier hs-var">tfi'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821021"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span class="hs-identifier">rnSrcInstDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamInstD"><span class="hs-identifier hs-var">DataFamInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dfid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821022"><a href="#local-6989586621679821022"><span class="hs-identifier">dfi</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-461"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821023"><a href="#local-6989586621679821023"><span class="hs-identifier">dfi'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821024"><a href="#local-6989586621679821024"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnDataFamInstDecl"><span class="hs-identifier hs-var">rnDataFamInstDecl</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679821022"><span class="hs-identifier hs-var">dfi</span></a><span>
</span><a name="line-462"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamInstD"><span class="hs-identifier hs-var">DataFamInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dfid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821023"><span class="hs-identifier hs-var">dfi'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821024"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-463"></a><span>
</span><a name="line-464"></a><span class="hs-identifier">rnSrcInstDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClsInstD"><span class="hs-identifier hs-var">ClsInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821025"><a href="#local-6989586621679821025"><span class="hs-identifier">cid</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-465"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821026"><a href="#local-6989586621679821026"><span class="hs-identifier">cid'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821027"><a href="#local-6989586621679821027"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnClsInstDecl"><span class="hs-identifier hs-var">rnClsInstDecl</span></a><span> </span><a href="#local-6989586621679821025"><span class="hs-identifier hs-var">cid</span></a><span>
</span><a name="line-466"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClsInstD"><span class="hs-identifier hs-var">ClsInstD</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cid_inst</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821026"><span class="hs-identifier hs-var">cid'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821027"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-467"></a><span>
</span><a name="line-468"></a><span class="hs-comment">-- | Warn about non-canonical typeclass instance declarations</span><span>
</span><a name="line-469"></a><span class="hs-comment">--</span><span>
</span><a name="line-470"></a><span class="hs-comment">-- A &quot;non-canonical&quot; instance definition can occur for instances of a</span><span>
</span><a name="line-471"></a><span class="hs-comment">-- class which redundantly defines an operation its superclass</span><span>
</span><a name="line-472"></a><span class="hs-comment">-- provides as well (c.f. `return`/`pure`). In such cases, a canonical</span><span>
</span><a name="line-473"></a><span class="hs-comment">-- instance is one where the subclass inherits its method</span><span>
</span><a name="line-474"></a><span class="hs-comment">-- implementation from its superclass instance (usually the subclass</span><span>
</span><a name="line-475"></a><span class="hs-comment">-- has a default method implementation to that effect). Consequently,</span><span>
</span><a name="line-476"></a><span class="hs-comment">-- a non-canonical instance occurs when this is not the case.</span><span>
</span><a name="line-477"></a><span class="hs-comment">--</span><span>
</span><a name="line-478"></a><span class="hs-comment">-- See also descriptions of 'checkCanonicalMonadInstances' and</span><span>
</span><a name="line-479"></a><span class="hs-comment">-- 'checkCanonicalMonoidInstances'</span><span>
</span><a name="line-480"></a><span class="hs-identifier">checkCanonicalInstances</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-481"></a><a name="checkCanonicalInstances"><a href="RnSource.html#checkCanonicalInstances"><span class="hs-identifier">checkCanonicalInstances</span></a></a><span> </span><a name="local-6989586621679821028"><a href="#local-6989586621679821028"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679821029"><a href="#local-6989586621679821029"><span class="hs-identifier">poly_ty</span></a></a><span> </span><a name="local-6989586621679821030"><a href="#local-6989586621679821030"><span class="hs-identifier">mbinds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-482"></a><span>    </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadInstances</span></a><span>
</span><a name="line-483"></a><span>        </span><a href="#local-6989586621679821031"><span class="hs-identifier hs-var">checkCanonicalMonadInstances</span></a><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span>    </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadFailInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadFailInstances</span></a><span>
</span><a name="line-486"></a><span>        </span><a href="#local-6989586621679821032"><span class="hs-identifier hs-var">checkCanonicalMonadFailInstances</span></a><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span>    </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonoidInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonoidInstances</span></a><span>
</span><a name="line-489"></a><span>        </span><a href="#local-6989586621679821033"><span class="hs-identifier hs-var">checkCanonicalMonoidInstances</span></a><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-492"></a><span>    </span><span class="hs-comment">-- | Warn about unsound/non-canonical 'Applicative'/'Monad' instance</span><span>
</span><a name="line-493"></a><span>    </span><span class="hs-comment">-- declarations. Specifically, the following conditions are verified:</span><span>
</span><a name="line-494"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-495"></a><span>    </span><span class="hs-comment">-- In 'Monad' instances declarations:</span><span>
</span><a name="line-496"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-497"></a><span>    </span><span class="hs-comment">--  * If 'return' is overridden it must be canonical (i.e. @return = pure@)</span><span>
</span><a name="line-498"></a><span>    </span><span class="hs-comment">--  * If '(&gt;&gt;)' is overridden it must be canonical (i.e. @(&gt;&gt;) = (*&gt;)@)</span><span>
</span><a name="line-499"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-500"></a><span>    </span><span class="hs-comment">-- In 'Applicative' instance declarations:</span><span>
</span><a name="line-501"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-502"></a><span>    </span><span class="hs-comment">--  * Warn if 'pure' is defined backwards (i.e. @pure = return@).</span><span>
</span><a name="line-503"></a><span>    </span><span class="hs-comment">--  * Warn if '(*&gt;)' is defined backwards (i.e. @(*&gt;) = (&gt;&gt;)@).</span><span>
</span><a name="line-504"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-505"></a><span>    </span><a name="local-6989586621679821031"><a href="#local-6989586621679821031"><span class="hs-identifier">checkCanonicalMonadInstances</span></a></a><span>
</span><a name="line-506"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821028"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#applicativeClassName"><span class="hs-identifier hs-var">applicativeClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-507"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-6989586621679821030"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821040"><a href="#local-6989586621679821040"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821041"><a href="#local-6989586621679821041"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621679821040"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-508"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821041"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-509"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821042"><a href="#local-6989586621679821042"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821043"><a href="#local-6989586621679821043"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-510"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821042"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#pureAName"><span class="hs-identifier hs-var">pureAName</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821034"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-6989586621679821043"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#returnMName"><span class="hs-identifier hs-var">returnMName</span></a><span>
</span><a name="line-511"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821035"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod1</span></a><span>
</span><a name="line-512"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadInstances</span></a><span> </span><span class="hs-string">&quot;pure&quot;</span><span> </span><span class="hs-string">&quot;return&quot;</span><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821042"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#thenAName"><span class="hs-identifier hs-var">thenAName</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821034"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-6989586621679821043"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#thenMName"><span class="hs-identifier hs-var">thenMName</span></a><span>
</span><a name="line-515"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821035"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod1</span></a><span>
</span><a name="line-516"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadInstances</span></a><span> </span><span class="hs-string">&quot;(*&gt;)&quot;</span><span> </span><span class="hs-string">&quot;(&gt;&gt;)&quot;</span><span>
</span><a name="line-517"></a><span>
</span><a name="line-518"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821028"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#monadClassName"><span class="hs-identifier hs-var">monadClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-521"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-6989586621679821030"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821044"><a href="#local-6989586621679821044"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821045"><a href="#local-6989586621679821045"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621679821044"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-522"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821045"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-523"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821046"><a href="#local-6989586621679821046"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821047"><a href="#local-6989586621679821047"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-524"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821046"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#returnMName"><span class="hs-identifier hs-var">returnMName</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821034"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-6989586621679821047"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#pureAName"><span class="hs-identifier hs-var">pureAName</span></a><span>
</span><a name="line-525"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821036"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod2</span></a><span>
</span><a name="line-526"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadInstances</span></a><span> </span><span class="hs-string">&quot;return&quot;</span><span> </span><span class="hs-string">&quot;pure&quot;</span><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821046"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#thenMName"><span class="hs-identifier hs-var">thenMName</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821034"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-6989586621679821047"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#thenAName"><span class="hs-identifier hs-var">thenAName</span></a><span>
</span><a name="line-529"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821036"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod2</span></a><span>
</span><a name="line-530"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadInstances</span></a><span> </span><span class="hs-string">&quot;(&gt;&gt;)&quot;</span><span> </span><span class="hs-string">&quot;(*&gt;)&quot;</span><span>
</span><a name="line-531"></a><span>
</span><a name="line-532"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-533"></a><span>
</span><a name="line-534"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span>    </span><span class="hs-comment">-- | Warn about unsound/non-canonical 'Monad'/'MonadFail' instance</span><span>
</span><a name="line-537"></a><span>    </span><span class="hs-comment">-- declarations. Specifically, the following conditions are verified:</span><span>
</span><a name="line-538"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-539"></a><span>    </span><span class="hs-comment">-- In 'Monad' instances declarations:</span><span>
</span><a name="line-540"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-541"></a><span>    </span><span class="hs-comment">--  * If 'fail' is overridden it must be canonical</span><span>
</span><a name="line-542"></a><span>    </span><span class="hs-comment">--    (i.e. @fail = Control.Monad.Fail.fail@)</span><span>
</span><a name="line-543"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-544"></a><span>    </span><span class="hs-comment">-- In 'MonadFail' instance declarations:</span><span>
</span><a name="line-545"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-546"></a><span>    </span><span class="hs-comment">--  * Warn if 'fail' is defined backwards</span><span>
</span><a name="line-547"></a><span>    </span><span class="hs-comment">--    (i.e. @fail = Control.Monad.fail@).</span><span>
</span><a name="line-548"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-549"></a><span>    </span><a name="local-6989586621679821032"><a href="#local-6989586621679821032"><span class="hs-identifier">checkCanonicalMonadFailInstances</span></a></a><span>
</span><a name="line-550"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821028"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#monadFailClassName"><span class="hs-identifier hs-var">monadFailClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-551"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-6989586621679821030"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821048"><a href="#local-6989586621679821048"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821049"><a href="#local-6989586621679821049"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621679821048"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-552"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821049"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-553"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821050"><a href="#local-6989586621679821050"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821051"><a href="#local-6989586621679821051"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-554"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821050"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#failMName"><span class="hs-identifier hs-var">failMName</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821034"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-6989586621679821051"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#failMName_preMFP"><span class="hs-identifier hs-var">failMName_preMFP</span></a><span>
</span><a name="line-555"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821035"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod1</span></a><span>
</span><a name="line-556"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadFailInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadFailInstances</span></a><span> </span><span class="hs-string">&quot;fail&quot;</span><span>
</span><a name="line-557"></a><span>                            </span><span class="hs-string">&quot;Control.Monad.fail&quot;</span><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span>
</span><a name="line-561"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821028"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#monadClassName"><span class="hs-identifier hs-var">monadClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-562"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-6989586621679821030"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821052"><a href="#local-6989586621679821052"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821053"><a href="#local-6989586621679821053"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621679821052"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-563"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821053"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-564"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821054"><a href="#local-6989586621679821054"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821055"><a href="#local-6989586621679821055"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-565"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821054"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#failMName_preMFP"><span class="hs-identifier hs-var">failMName_preMFP</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821034"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-6989586621679821055"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#failMName"><span class="hs-identifier hs-var">failMName</span></a><span>
</span><a name="line-566"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821036"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod2</span></a><span>
</span><a name="line-567"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonadFailInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonadFailInstances</span></a><span> </span><span class="hs-string">&quot;fail&quot;</span><span>
</span><a name="line-568"></a><span>                            </span><span class="hs-string">&quot;Control.Monad.Fail.fail&quot;</span><span>
</span><a name="line-569"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-572"></a><span>
</span><a name="line-573"></a><span>    </span><span class="hs-comment">-- | Check whether Monoid(mappend) is defined in terms of</span><span>
</span><a name="line-574"></a><span>    </span><span class="hs-comment">-- Semigroup((&lt;&gt;)) (and not the other way round). Specifically,</span><span>
</span><a name="line-575"></a><span>    </span><span class="hs-comment">-- the following conditions are verified:</span><span>
</span><a name="line-576"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-577"></a><span>    </span><span class="hs-comment">-- In 'Monoid' instances declarations:</span><span>
</span><a name="line-578"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-579"></a><span>    </span><span class="hs-comment">--  * If 'mappend' is overridden it must be canonical</span><span>
</span><a name="line-580"></a><span>    </span><span class="hs-comment">--    (i.e. @mappend = (&lt;&gt;)@)</span><span>
</span><a name="line-581"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-582"></a><span>    </span><span class="hs-comment">-- In 'Semigroup' instance declarations:</span><span>
</span><a name="line-583"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-584"></a><span>    </span><span class="hs-comment">--  * Warn if '(&lt;&gt;)' is defined backwards (i.e. @(&lt;&gt;) = mappend@).</span><span>
</span><a name="line-585"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-586"></a><span>    </span><a name="local-6989586621679821033"><a href="#local-6989586621679821033"><span class="hs-identifier">checkCanonicalMonoidInstances</span></a></a><span>
</span><a name="line-587"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821028"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#semigroupClassName"><span class="hs-identifier hs-var">semigroupClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-588"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-6989586621679821030"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821056"><a href="#local-6989586621679821056"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821057"><a href="#local-6989586621679821057"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621679821056"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-589"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821057"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-590"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821058"><a href="#local-6989586621679821058"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821059"><a href="#local-6989586621679821059"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-591"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821058"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#sappendName"><span class="hs-identifier hs-var">sappendName</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821034"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-6989586621679821059"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#mappendName"><span class="hs-identifier hs-var">mappendName</span></a><span>
</span><a name="line-592"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821035"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod1</span></a><span>
</span><a name="line-593"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonoidInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonoidInstances</span></a><span> </span><span class="hs-string">&quot;(&lt;&gt;)&quot;</span><span> </span><span class="hs-string">&quot;mappend&quot;</span><span>
</span><a name="line-594"></a><span>
</span><a name="line-595"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-596"></a><span>
</span><a name="line-597"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821028"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#monoidClassName"><span class="hs-identifier hs-var">monoidClassName</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-598"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-6989586621679821030"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821060"><a href="#local-6989586621679821060"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821061"><a href="#local-6989586621679821061"><span class="hs-identifier">mbind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621679821060"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-599"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821061"><span class="hs-identifier hs-var">mbind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-600"></a><span>                  </span><a href="HsBinds.html#FunBind"><span class="hs-identifier hs-var">FunBind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821062"><a href="#local-6989586621679821062"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821063"><a href="#local-6989586621679821063"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-601"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821062"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#mappendName"><span class="hs-identifier hs-var">mappendName</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821034"><span class="hs-identifier hs-var">isAliasMG</span></a><span> </span><a href="#local-6989586621679821063"><span class="hs-identifier hs-var">mg</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="PrelNames.html#sappendName"><span class="hs-identifier hs-var">sappendName</span></a><span>
</span><a name="line-602"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821037"><span class="hs-identifier hs-var">addWarnNonCanonicalMethod2NoDefault</span></a><span>
</span><a name="line-603"></a><span>                            </span><a href="DynFlags.html#Opt_WarnNonCanonicalMonoidInstances"><span class="hs-identifier hs-var">Opt_WarnNonCanonicalMonoidInstances</span></a><span> </span><span class="hs-string">&quot;mappend&quot;</span><span> </span><span class="hs-string">&quot;(&lt;&gt;)&quot;</span><span>
</span><a name="line-604"></a><span>
</span><a name="line-605"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-606"></a><span>
</span><a name="line-607"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span>
</span><a name="line-609"></a><span>    </span><span class="hs-comment">-- | test whether MatchGroup represents a trivial \&quot;lhsName = rhsName\&quot;</span><span>
</span><a name="line-610"></a><span>    </span><span class="hs-comment">-- binding, and return @Just rhsName@ if this is the case</span><span>
</span><a name="line-611"></a><span>    </span><span class="hs-identifier">isAliasMG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsExpr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-612"></a><span>    </span><a name="local-6989586621679821034"><a href="#local-6989586621679821034"><span class="hs-identifier">isAliasMG</span></a></a><span> </span><a href="HsExpr.html#MG"><span class="hs-identifier hs-var">MG</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">mg_alts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#Match"><span class="hs-identifier hs-var">Match</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_grhss</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821064"><a href="#local-6989586621679821064"><span class="hs-identifier">grhss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><a name="line-613"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HsExpr.html#GRHSs"><span class="hs-identifier hs-var">GRHSs</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#GRHS"><span class="hs-identifier hs-var">GRHS</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679821065"><a href="#local-6989586621679821065"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679821066"><a href="#local-6989586621679821066"><span class="hs-identifier">lbinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821064"><span class="hs-identifier hs-var">grhss</span></a><span>
</span><a name="line-614"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="HsBinds.html#EmptyLocalBinds"><span class="hs-identifier hs-var">EmptyLocalBinds</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821066"><span class="hs-identifier hs-var">lbinds</span></a><span>
</span><a name="line-615"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821067"><a href="#local-6989586621679821067"><span class="hs-identifier">rhsName</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821065"><span class="hs-identifier hs-var">body</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679821067"><span class="hs-identifier hs-var">rhsName</span></a><span>
</span><a name="line-616"></a><span>    </span><span class="hs-identifier">isAliasMG</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-617"></a><span>
</span><a name="line-618"></a><span>    </span><span class="hs-comment">-- got &quot;lhs = rhs&quot; but expected something different</span><span>
</span><a name="line-619"></a><span>    </span><a name="local-6989586621679821035"><a href="#local-6989586621679821035"><span class="hs-identifier">addWarnNonCanonicalMethod1</span></a></a><span> </span><a name="local-6989586621679821068"><a href="#local-6989586621679821068"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-6989586621679821069"><a href="#local-6989586621679821069"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-6989586621679821070"><a href="#local-6989586621679821070"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-620"></a><span>        </span><a href="TcRnMonad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-6989586621679821068"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-621"></a><span>                       </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Noncanonical&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-622"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821069"><span class="hs-identifier hs-var">lhs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; = &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679821070"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-623"></a><span>                         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;definition detected&quot;</span><span>
</span><a name="line-624"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821038"><span class="hs-identifier hs-var">instDeclCtxt1</span></a><span> </span><a href="#local-6989586621679821029"><span class="hs-identifier hs-var">poly_ty</span></a><span>
</span><a name="line-625"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Move definition from&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-626"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679821070"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-627"></a><span>                         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;to&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679821069"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-628"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-629"></a><span>
</span><a name="line-630"></a><span>    </span><span class="hs-comment">-- expected &quot;lhs = rhs&quot; but got something else</span><span>
</span><a name="line-631"></a><span>    </span><a name="local-6989586621679821036"><a href="#local-6989586621679821036"><span class="hs-identifier">addWarnNonCanonicalMethod2</span></a></a><span> </span><a name="local-6989586621679821071"><a href="#local-6989586621679821071"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-6989586621679821072"><a href="#local-6989586621679821072"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-6989586621679821073"><a href="#local-6989586621679821073"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-632"></a><span>        </span><a href="TcRnMonad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-6989586621679821071"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-633"></a><span>                       </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Noncanonical&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-634"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679821072"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-635"></a><span>                         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;definition detected&quot;</span><span>
</span><a name="line-636"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821038"><span class="hs-identifier hs-var">instDeclCtxt1</span></a><span> </span><a href="#local-6989586621679821029"><span class="hs-identifier hs-var">poly_ty</span></a><span>
</span><a name="line-637"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Either remove definition for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-638"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679821072"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;or define as&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-639"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821072"><span class="hs-identifier hs-var">lhs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; = &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679821073"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-640"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-641"></a><span>
</span><a name="line-642"></a><span>    </span><span class="hs-comment">-- like above, but method has no default impl</span><span>
</span><a name="line-643"></a><span>    </span><a name="local-6989586621679821037"><a href="#local-6989586621679821037"><span class="hs-identifier">addWarnNonCanonicalMethod2NoDefault</span></a></a><span> </span><a name="local-6989586621679821074"><a href="#local-6989586621679821074"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-6989586621679821075"><a href="#local-6989586621679821075"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-6989586621679821076"><a href="#local-6989586621679821076"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-644"></a><span>        </span><a href="TcRnMonad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a><span> </span><a href="#local-6989586621679821074"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-645"></a><span>                       </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Noncanonical&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-646"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621679821075"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-647"></a><span>                         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;definition detected&quot;</span><span>
</span><a name="line-648"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821038"><span class="hs-identifier hs-var">instDeclCtxt1</span></a><span> </span><a href="#local-6989586621679821029"><span class="hs-identifier hs-var">poly_ty</span></a><span>
</span><a name="line-649"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Define as&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-650"></a><span>                         </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821075"><span class="hs-identifier hs-var">lhs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; = &quot;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679821076"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-652"></a><span>
</span><a name="line-653"></a><span>    </span><span class="hs-comment">-- stolen from TcInstDcls</span><span>
</span><a name="line-654"></a><span>    </span><span class="hs-identifier">instDeclCtxt1</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigType"><span class="hs-identifier hs-type">LHsSigType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-655"></a><span>    </span><a name="local-6989586621679821038"><a href="#local-6989586621679821038"><span class="hs-identifier">instDeclCtxt1</span></a></a><span> </span><a name="local-6989586621679821077"><a href="#local-6989586621679821077"><span class="hs-identifier">hs_inst_ty</span></a></a><span>
</span><a name="line-656"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821039"><span class="hs-identifier hs-var">inst_decl_ctxt</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#getLHsInstDeclHead"><span class="hs-identifier hs-var">getLHsInstDeclHead</span></a><span> </span><a href="#local-6989586621679821077"><span class="hs-identifier hs-var">hs_inst_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-657"></a><span>
</span><a name="line-658"></a><span>    </span><span class="hs-identifier">inst_decl_ctxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-659"></a><span>    </span><a name="local-6989586621679821039"><a href="#local-6989586621679821039"><span class="hs-identifier">inst_decl_ctxt</span></a></a><span> </span><a name="local-6989586621679821078"><a href="#local-6989586621679821078"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in the instance declaration for&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-660"></a><span>                         </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><a href="#local-6989586621679821078"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;.&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-661"></a><span>
</span><a name="line-662"></a><span>
</span><a name="line-663"></a><span class="hs-identifier">rnClsInstDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#ClsInstDecl"><span class="hs-identifier hs-type">ClsInstDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClsInstDecl"><span class="hs-identifier hs-type">ClsInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-664"></a><a name="rnClsInstDecl"><a href="RnSource.html#rnClsInstDecl"><span class="hs-identifier">rnClsInstDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClsInstDecl"><span class="hs-identifier hs-var">ClsInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cid_poly_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821079"><a href="#local-6989586621679821079"><span class="hs-identifier">inst_ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821080"><a href="#local-6989586621679821080"><span class="hs-identifier">mbinds</span></a></a><span>
</span><a name="line-665"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821081"><a href="#local-6989586621679821081"><span class="hs-identifier">uprags</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_tyfam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821082"><a href="#local-6989586621679821082"><span class="hs-identifier">ats</span></a></a><span>
</span><a name="line-666"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_overlap_mode</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821083"><a href="#local-6989586621679821083"><span class="hs-identifier">oflag</span></a></a><span>
</span><a name="line-667"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_datafam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821084"><a href="#local-6989586621679821084"><span class="hs-identifier">adts</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-668"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821085"><a href="#local-6989586621679821085"><span class="hs-identifier">inst_ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821086"><a href="#local-6989586621679821086"><span class="hs-identifier">inst_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsInstType"><span class="hs-identifier hs-var">rnLHsInstType</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an instance declaration&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821079"><span class="hs-identifier hs-var">inst_ty</span></a><span>
</span><a name="line-669"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821087"><a href="#local-6989586621679821087"><span class="hs-identifier">ktv_names</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821088"><a href="#local-6989586621679821088"><span class="hs-identifier">head_ty'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#splitLHsInstDeclTy"><span class="hs-identifier hs-var">splitLHsInstDeclTy</span></a><span> </span><a href="#local-6989586621679821085"><span class="hs-identifier hs-var">inst_ty'</span></a><span>
</span><a name="line-670"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821089"><a href="#local-6989586621679821089"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="HsTypes.html#hsTyGetAppHead_maybe"><span class="hs-identifier hs-var">hsTyGetAppHead_maybe</span></a><span> </span><a href="#local-6989586621679821088"><span class="hs-identifier hs-var">head_ty'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-671"></a><span>                     </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelNames.html#mkUnboundName"><span class="hs-identifier hs-var">mkUnboundName</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkTcOccFS"><span class="hs-identifier hs-var">mkTcOccFS</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;&lt;class&gt;&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-672"></a><span>                     </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821090"><a href="#local-6989586621679821090"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821090"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-673"></a><span>                     </span><span class="hs-comment">-- rnLHsInstType has added an error message</span><span>
</span><a name="line-674"></a><span>                     </span><span class="hs-comment">-- if hsTyGetAppHead_maybe fails</span><span>
</span><a name="line-675"></a><span>
</span><a name="line-676"></a><span>          </span><span class="hs-comment">-- Rename the bindings</span><span>
</span><a name="line-677"></a><span>          </span><span class="hs-comment">-- The typechecker (not the renamer) checks that all</span><span>
</span><a name="line-678"></a><span>          </span><span class="hs-comment">-- the bindings are for the right class</span><span>
</span><a name="line-679"></a><span>          </span><span class="hs-comment">-- (Slightly strangely) when scoped type variables are on, the</span><span>
</span><a name="line-680"></a><span>          </span><span class="hs-comment">-- forall-d tyvars scope over the method bindings too</span><span>
</span><a name="line-681"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821091"><a href="#local-6989586621679821091"><span class="hs-identifier">mbinds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821092"><a href="#local-6989586621679821092"><span class="hs-identifier">uprags'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821093"><a href="#local-6989586621679821093"><span class="hs-identifier">meth_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnMethodBinds"><span class="hs-identifier hs-var">rnMethodBinds</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679821089"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679821087"><span class="hs-identifier hs-var">ktv_names</span></a><span> </span><a href="#local-6989586621679821080"><span class="hs-identifier hs-var">mbinds</span></a><span> </span><a href="#local-6989586621679821081"><span class="hs-identifier hs-var">uprags</span></a><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnSource.html#checkCanonicalInstances"><span class="hs-identifier hs-var">checkCanonicalInstances</span></a><span> </span><a href="#local-6989586621679821089"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679821085"><span class="hs-identifier hs-var">inst_ty'</span></a><span> </span><a href="#local-6989586621679821091"><span class="hs-identifier hs-var">mbinds'</span></a><span>
</span><a name="line-684"></a><span>
</span><a name="line-685"></a><span>       </span><span class="hs-comment">-- Rename the associated types, and type signatures</span><span>
</span><a name="line-686"></a><span>       </span><span class="hs-comment">-- Both need to have the instance type variables in scope</span><span>
</span><a name="line-687"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;rnSrcInstDecl&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821085"><span class="hs-identifier hs-var">inst_ty'</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821087"><span class="hs-identifier hs-var">ktv_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-688"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679821098"><a href="#local-6989586621679821098"><span class="hs-identifier">ats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821099"><a href="#local-6989586621679821099"><span class="hs-identifier">adts'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821100"><a href="#local-6989586621679821100"><span class="hs-identifier">more_fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-689"></a><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#extendTyVarEnvFVRn"><span class="hs-identifier hs-var">extendTyVarEnvFVRn</span></a><span> </span><a href="#local-6989586621679821087"><span class="hs-identifier hs-var">ktv_names</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-690"></a><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821094"><a href="#local-6989586621679821094"><span class="hs-identifier">ats'</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621679821095"><a href="#local-6989586621679821095"><span class="hs-identifier">at_fvs</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnATInstDecls"><span class="hs-identifier hs-var">rnATInstDecls</span></a><span> </span><a href="RnSource.html#rnTyFamInstDecl"><span class="hs-identifier hs-var">rnTyFamInstDecl</span></a><span> </span><a href="#local-6989586621679821089"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679821087"><span class="hs-identifier hs-var">ktv_names</span></a><span> </span><a href="#local-6989586621679821082"><span class="hs-identifier hs-var">ats</span></a><span>
</span><a name="line-691"></a><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821096"><a href="#local-6989586621679821096"><span class="hs-identifier">adts'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821097"><a href="#local-6989586621679821097"><span class="hs-identifier">adt_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnATInstDecls"><span class="hs-identifier hs-var">rnATInstDecls</span></a><span> </span><a href="RnSource.html#rnDataFamInstDecl"><span class="hs-identifier hs-var">rnDataFamInstDecl</span></a><span> </span><a href="#local-6989586621679821089"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621679821087"><span class="hs-identifier hs-var">ktv_names</span></a><span> </span><a href="#local-6989586621679821084"><span class="hs-identifier hs-var">adts</span></a><span>
</span><a name="line-692"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821094"><span class="hs-identifier hs-var">ats'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821096"><span class="hs-identifier hs-var">adts'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821095"><span class="hs-identifier hs-var">at_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821097"><span class="hs-identifier hs-var">adt_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821101"><a href="#local-6989586621679821101"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821093"><span class="hs-identifier hs-var">meth_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821100"><span class="hs-identifier hs-var">more_fvs</span></a><span>
</span><a name="line-695"></a><span>                                </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821086"><span class="hs-identifier hs-var">inst_fvs</span></a><span>
</span><a name="line-696"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClsInstDecl"><span class="hs-identifier hs-var">ClsInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cid_poly_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821085"><span class="hs-identifier hs-var">inst_ty'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821091"><span class="hs-identifier hs-var">mbinds'</span></a><span>
</span><a name="line-697"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821092"><span class="hs-identifier hs-var">uprags'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_tyfam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821098"><span class="hs-identifier hs-var">ats'</span></a><span>
</span><a name="line-698"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_overlap_mode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821083"><span class="hs-identifier hs-var">oflag</span></a><span>
</span><a name="line-699"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cid_datafam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821099"><span class="hs-identifier hs-var">adts'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-700"></a><span>                 </span><a href="#local-6989586621679821101"><span class="hs-identifier hs-var">all_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-701"></a><span>             </span><span class="hs-comment">-- We return the renamed associated data type declarations so</span><span>
</span><a name="line-702"></a><span>             </span><span class="hs-comment">-- that they can be entered into the list of type declarations</span><span>
</span><a name="line-703"></a><span>             </span><span class="hs-comment">-- for the binding group, but we also keep a copy in the instance.</span><span>
</span><a name="line-704"></a><span>             </span><span class="hs-comment">-- The latter is needed for well-formedness checks in the type</span><span>
</span><a name="line-705"></a><span>             </span><span class="hs-comment">-- checker (eg, to ensure that all ATs of the instance actually</span><span>
</span><a name="line-706"></a><span>             </span><span class="hs-comment">-- receive a declaration).</span><span>
</span><a name="line-707"></a><span>             </span><span class="hs-comment">-- NB: Even the copies in the instance declaration carry copies of</span><span>
</span><a name="line-708"></a><span>             </span><span class="hs-comment">--     the instance context after renaming.  This is a bit</span><span>
</span><a name="line-709"></a><span>             </span><span class="hs-comment">--     strange, but should not matter (and it would be more work</span><span>
</span><a name="line-710"></a><span>             </span><span class="hs-comment">--     to remove the context).</span><span>
</span><a name="line-711"></a><span>
</span><a name="line-712"></a><span class="hs-identifier">rnFamInstDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span>
</span><a name="line-713"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Nothing =&gt; not associated</span><span>
</span><a name="line-714"></a><span>                                        </span><span class="hs-comment">-- Just (cls,tvs) =&gt; associated,</span><span>
</span><a name="line-715"></a><span>                                        </span><span class="hs-comment">--   and gives class and tyvars of the</span><span>
</span><a name="line-716"></a><span>                                        </span><span class="hs-comment">--   parent instance delc</span><span>
</span><a name="line-717"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-718"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#HsTyPats"><span class="hs-identifier hs-type">HsTyPats</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-719"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679820868"><span class="hs-identifier hs-type">rhs</span></a><span>
</span><a name="line-720"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679820868"><span class="hs-identifier hs-type">rhs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820869"><span class="hs-identifier hs-type">rhs'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-721"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="HsDecls.html#HsTyPats"><span class="hs-identifier hs-type">HsTyPats</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679820869"><span class="hs-identifier hs-type">rhs'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-722"></a><a name="rnFamInstDecl"><a href="RnSource.html#rnFamInstDecl"><span class="hs-identifier">rnFamInstDecl</span></a></a><span> </span><a name="local-6989586621679821102"><a href="#local-6989586621679821102"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621679821103"><a href="#local-6989586621679821103"><span class="hs-identifier">mb_cls</span></a></a><span> </span><a name="local-6989586621679821104"><a href="#local-6989586621679821104"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821105"><a href="#local-6989586621679821105"><span class="hs-identifier">pats</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821106"><a href="#local-6989586621679821106"><span class="hs-identifier">payload</span></a></a><span> </span><a name="local-6989586621679821107"><a href="#local-6989586621679821107"><span class="hs-identifier">rnPayload</span></a></a><span>
</span><a name="line-723"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821108"><a href="#local-6989586621679821108"><span class="hs-identifier">tycon'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupFamInstName"><span class="hs-identifier hs-var">lookupFamInstName</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-6989586621679821103"><span class="hs-identifier hs-var">mb_cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821104"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-724"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821109"><a href="#local-6989586621679821109"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821105"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-725"></a><span>                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;rnFamInstDecl&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821104"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-726"></a><span>                     </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821110"><a href="#local-6989586621679821110"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821110"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-727"></a><span>                     </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821111"><a href="#local-6989586621679821111"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679821112"><a href="#local-6989586621679821112"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#combineSrcSpans"><span class="hs-identifier hs-var">combineSrcSpans</span></a><span> </span><a href="#local-6989586621679821111"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a><span> </span><a href="#local-6989586621679821112"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-728"></a><span>
</span><a name="line-729"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821113"><a href="#local-6989586621679821113"><span class="hs-identifier">pat_kity_vars_with_dups</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#extractHsTysRdrTyVarsDups"><span class="hs-identifier hs-var">extractHsTysRdrTyVarsDups</span></a><span> </span><a href="#local-6989586621679821105"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-730"></a><span>             </span><span class="hs-comment">-- Use the &quot;...Dups&quot; form because it's needed</span><span>
</span><a name="line-731"></a><span>             </span><span class="hs-comment">-- below to report unsed binder on the LHS</span><span>
</span><a name="line-732"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821114"><a href="#local-6989586621679821114"><span class="hs-identifier">var_names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#newTyVarNameRn"><span class="hs-identifier hs-var">newTyVarNameRn</span></a><span> </span><a href="#local-6989586621679821103"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821109"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-733"></a><span>                      </span><a href="RnTypes.html#freeKiTyVarsAllVars"><span class="hs-identifier hs-var">freeKiTyVarsAllVars</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-734"></a><span>                      </span><a href="RnTypes.html#rmDupsInRdrTyVars"><span class="hs-identifier hs-var">rmDupsInRdrTyVars</span></a><span> </span><a href="#local-6989586621679821113"><span class="hs-identifier hs-var">pat_kity_vars_with_dups</span></a><span>
</span><a name="line-735"></a><span>
</span><a name="line-736"></a><span>             </span><span class="hs-comment">-- All the free vars of the family patterns</span><span>
</span><a name="line-737"></a><span>             </span><span class="hs-comment">-- with a sensible binding location</span><span>
</span><a name="line-738"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679821130"><a href="#local-6989586621679821130"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821131"><a href="#local-6989586621679821131"><span class="hs-identifier">payload'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821132"><a href="#local-6989586621679821132"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-739"></a><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><a href="#local-6989586621679821114"><span class="hs-identifier hs-var">var_names</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-740"></a><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821115"><a href="#local-6989586621679821115"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821116"><a href="#local-6989586621679821116"><span class="hs-identifier">pat_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTypes"><span class="hs-identifier hs-var">rnLHsTypes</span></a><span> </span><span class="hs-special">(</span><a href="RnUtils.html#FamPatCtx"><span class="hs-identifier hs-var">FamPatCtx</span></a><span> </span><a href="#local-6989586621679821104"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821105"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-741"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821117"><a href="#local-6989586621679821117"><span class="hs-identifier">payload'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821118"><a href="#local-6989586621679821118"><span class="hs-identifier">rhs_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821107"><span class="hs-identifier hs-var">rnPayload</span></a><span> </span><a href="#local-6989586621679821102"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821106"><span class="hs-identifier hs-var">payload</span></a><span>
</span><a name="line-742"></a><span>
</span><a name="line-743"></a><span>                       </span><span class="hs-comment">-- Report unused binders on the LHS</span><span>
</span><a name="line-744"></a><span>                       </span><span class="hs-comment">-- See Note [Unused type variables in family instances]</span><span>
</span><a name="line-745"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">groups</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-746"></a><span>                          </span><a name="local-6989586621679821119"><a href="#local-6989586621679821119"><span class="hs-identifier">groups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ListSetOps.html#equivClasses"><span class="hs-identifier hs-var">equivClasses</span></a><span> </span><a href="SrcLoc.html#cmpLocated"><span class="hs-identifier hs-var">cmpLocated</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-747"></a><span>                                   </span><a href="RnTypes.html#freeKiTyVarsAllVars"><span class="hs-identifier hs-var">freeKiTyVarsAllVars</span></a><span> </span><a href="#local-6989586621679821113"><span class="hs-identifier hs-var">pat_kity_vars_with_dups</span></a><span>
</span><a name="line-748"></a><span>                    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821121"><a href="#local-6989586621679821121"><span class="hs-identifier">tv_nms_dups</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupOccRn"><span class="hs-identifier hs-var">lookupOccRn</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-749"></a><span>                                     </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679821120"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821120"><a href="#local-6989586621679821120"><span class="hs-identifier">tv</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821119"><span class="hs-identifier hs-var">groups</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-750"></a><span>                          </span><span class="hs-comment">-- Add to the used variables</span><span>
</span><a name="line-751"></a><span>                          </span><span class="hs-comment">--  a) any variables that appear *more than once* on the LHS</span><span>
</span><a name="line-752"></a><span>                          </span><span class="hs-comment">--     e.g.   F a Int a = Bool</span><span>
</span><a name="line-753"></a><span>                          </span><span class="hs-comment">--  b) for associated instances, the variables</span><span>
</span><a name="line-754"></a><span>                          </span><span class="hs-comment">--     of the instance decl.  See</span><span>
</span><a name="line-755"></a><span>                          </span><span class="hs-comment">--     Note [Unused type variables in family instances]</span><span>
</span><a name="line-756"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821122"><a href="#local-6989586621679821122"><span class="hs-identifier">tv_nms_used</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#extendNameSetList"><span class="hs-identifier hs-var">extendNameSetList</span></a><span> </span><a href="#local-6989586621679821118"><span class="hs-identifier hs-var">rhs_fvs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-757"></a><span>                                        </span><a href="#local-6989586621679821123"><span class="hs-identifier hs-var">inst_tvs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679821121"><span class="hs-identifier hs-var">tv_nms_dups</span></a><span>
</span><a name="line-758"></a><span>                          </span><a name="local-6989586621679821123"><a href="#local-6989586621679821123"><span class="hs-identifier">inst_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821103"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-759"></a><span>                                       </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-760"></a><span>                                       </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821124"><a href="#local-6989586621679821124"><span class="hs-identifier">inst_tvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821124"><span class="hs-identifier hs-var">inst_tvs</span></a><span>
</span><a name="line-761"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#warnUnusedTypePatterns"><span class="hs-identifier hs-var">warnUnusedTypePatterns</span></a><span> </span><a href="#local-6989586621679821114"><span class="hs-identifier hs-var">var_names</span></a><span> </span><a href="#local-6989586621679821122"><span class="hs-identifier hs-var">tv_nms_used</span></a><span>
</span><a name="line-762"></a><span>
</span><a name="line-763"></a><span>                         </span><span class="hs-comment">-- See Note [Renaming associated types]</span><span>
</span><a name="line-764"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821125"><a href="#local-6989586621679821125"><span class="hs-identifier">bad_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821103"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-765"></a><span>                                      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-766"></a><span>                                      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679821128"><a href="#local-6989586621679821128"><span class="hs-identifier">cls_tkvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><a href="#local-6989586621679821127"><span class="hs-identifier hs-var">is_bad</span></a><span> </span><a href="#local-6989586621679821128"><span class="hs-identifier hs-var">cls_tkvs</span></a><span>
</span><a name="line-767"></a><span>                          </span><a name="local-6989586621679821126"><a href="#local-6989586621679821126"><span class="hs-identifier">var_name_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-6989586621679821114"><span class="hs-identifier hs-var">var_names</span></a><span>
</span><a name="line-768"></a><span>
</span><a name="line-769"></a><span>                          </span><a name="local-6989586621679821127"><a href="#local-6989586621679821127"><span class="hs-identifier">is_bad</span></a></a><span> </span><a name="local-6989586621679821129"><a href="#local-6989586621679821129"><span class="hs-identifier">cls_tkv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821129"><span class="hs-identifier hs-var">cls_tkv</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821118"><span class="hs-identifier hs-var">rhs_fvs</span></a><span>
</span><a name="line-770"></a><span>                                        </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821129"><span class="hs-identifier hs-var">cls_tkv</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821126"><span class="hs-identifier hs-var">var_name_set</span></a><span class="hs-special">)</span><span>
</span><a name="line-771"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679821125"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnSource.html#badAssocRhs"><span class="hs-identifier hs-var">badAssocRhs</span></a><span> </span><a href="#local-6989586621679821125"><span class="hs-identifier hs-var">bad_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-772"></a><span>
</span><a name="line-773"></a><span>                    </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679821115"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821117"><span class="hs-identifier hs-var">payload'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821118"><span class="hs-identifier hs-var">rhs_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821116"><span class="hs-identifier hs-var">pat_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-774"></a><span>
</span><a name="line-775"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821133"><a href="#local-6989586621679821133"><span class="hs-identifier">anon_wcs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><a href="RnTypes.html#collectAnonWildCards"><span class="hs-identifier hs-var">collectAnonWildCards</span></a><span> </span><a href="#local-6989586621679821130"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-776"></a><span>             </span><a name="local-6989586621679821134"><a href="#local-6989586621679821134"><span class="hs-identifier">all_ibs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821133"><span class="hs-identifier hs-var">anon_wcs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679821114"><span class="hs-identifier hs-var">var_names</span></a><span>
</span><a name="line-777"></a><span>                        </span><span class="hs-comment">-- all_ibs: include anonymous wildcards in the implicit</span><span>
</span><a name="line-778"></a><span>                        </span><span class="hs-comment">-- binders In a type pattern they behave just like any</span><span>
</span><a name="line-779"></a><span>                        </span><span class="hs-comment">-- other type variable except for being anoymous.  See</span><span>
</span><a name="line-780"></a><span>                        </span><span class="hs-comment">-- Note [Wildcards in family instances]</span><span>
</span><a name="line-781"></a><span>             </span><a name="local-6989586621679821135"><a href="#local-6989586621679821135"><span class="hs-identifier">all_fvs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821132"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#addOneFV"><span class="hs-identifier hs-var">addOneFV</span></a><span class="hs-special">`</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821108"><span class="hs-identifier hs-var">tycon'</span></a><span>
</span><a name="line-782"></a><span>
</span><a name="line-783"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821108"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">,</span><span>
</span><a name="line-784"></a><span>                 </span><a href="HsTypes.html#HsIB"><span class="hs-identifier hs-var">HsIB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821130"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-785"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821134"><span class="hs-identifier hs-var">all_ibs</span></a><span>
</span><a name="line-786"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_closed</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-787"></a><span>                 </span><a href="#local-6989586621679821131"><span class="hs-identifier hs-var">payload'</span></a><span class="hs-special">,</span><span>
</span><a name="line-788"></a><span>                 </span><a href="#local-6989586621679821135"><span class="hs-identifier hs-var">all_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-789"></a><span>             </span><span class="hs-comment">-- type instance =&gt; use, hence addOneFV</span><span>
</span><a name="line-790"></a><span>
</span><a name="line-791"></a><span class="hs-identifier">rnTyFamInstDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-792"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#TyFamInstDecl"><span class="hs-identifier hs-type">TyFamInstDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-793"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstDecl"><span class="hs-identifier hs-type">TyFamInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-794"></a><a name="rnTyFamInstDecl"><a href="RnSource.html#rnTyFamInstDecl"><span class="hs-identifier">rnTyFamInstDecl</span></a></a><span> </span><a name="local-6989586621679821136"><a href="#local-6989586621679821136"><span class="hs-identifier">mb_cls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstDecl"><span class="hs-identifier hs-var">TyFamInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfid_eqn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821137"><a href="#local-6989586621679821137"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821138"><a href="#local-6989586621679821138"><span class="hs-identifier">eqn</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-795"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821139"><a href="#local-6989586621679821139"><span class="hs-identifier">eqn'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821140"><a href="#local-6989586621679821140"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnTyFamInstEqn"><span class="hs-identifier hs-var">rnTyFamInstEqn</span></a><span> </span><a href="#local-6989586621679821136"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><a href="#local-6989586621679821138"><span class="hs-identifier hs-var">eqn</span></a><span>
</span><a name="line-796"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstDecl"><span class="hs-identifier hs-var">TyFamInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfid_eqn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821137"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679821139"><span class="hs-identifier hs-var">eqn'</span></a><span>
</span><a name="line-797"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfid_fvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821140"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821140"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-798"></a><span>
</span><a name="line-799"></a><span class="hs-identifier">rnTyFamInstEqn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-800"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#TyFamInstEqn"><span class="hs-identifier hs-type">TyFamInstEqn</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-801"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamInstEqn"><span class="hs-identifier hs-type">TyFamInstEqn</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-802"></a><a name="rnTyFamInstEqn"><a href="RnSource.html#rnTyFamInstEqn"><span class="hs-identifier">rnTyFamInstEqn</span></a></a><span> </span><a name="local-6989586621679821141"><a href="#local-6989586621679821141"><span class="hs-identifier">mb_cls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamEqn"><span class="hs-identifier hs-var">TyFamEqn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfe_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821142"><a href="#local-6989586621679821142"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-803"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821143"><a href="#local-6989586621679821143"><span class="hs-identifier">pats</span></a></a><span>
</span><a name="line-804"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_fixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821144"><a href="#local-6989586621679821144"><span class="hs-identifier">fixity</span></a></a><span>
</span><a name="line-805"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_rhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821145"><a href="#local-6989586621679821145"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-806"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821146"><a href="#local-6989586621679821146"><span class="hs-identifier">tycon'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821147"><a href="#local-6989586621679821147"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821148"><a href="#local-6989586621679821148"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821149"><a href="#local-6989586621679821149"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-807"></a><span>           </span><a href="RnSource.html#rnFamInstDecl"><span class="hs-identifier hs-var">rnFamInstDecl</span></a><span> </span><span class="hs-special">(</span><a href="RnUtils.html#TySynCtx"><span class="hs-identifier hs-var">TySynCtx</span></a><span> </span><a href="#local-6989586621679821142"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821141"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><a href="#local-6989586621679821142"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621679821143"><span class="hs-identifier hs-var">pats</span></a><span> </span><a href="#local-6989586621679821145"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="RnSource.html#rnTySyn"><span class="hs-identifier hs-var">rnTySyn</span></a><span>
</span><a name="line-808"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamEqn"><span class="hs-identifier hs-var">TyFamEqn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfe_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821146"><span class="hs-identifier hs-var">tycon'</span></a><span>
</span><a name="line-809"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821147"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-810"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_fixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821144"><span class="hs-identifier hs-var">fixity</span></a><span>
</span><a name="line-811"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_rhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821148"><span class="hs-identifier hs-var">rhs'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821149"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-812"></a><span>
</span><a name="line-813"></a><span class="hs-identifier">rnTyFamDefltEqn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-814"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#TyFamDefltEqn"><span class="hs-identifier hs-type">TyFamDefltEqn</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-815"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamDefltEqn"><span class="hs-identifier hs-type">TyFamDefltEqn</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-816"></a><a name="rnTyFamDefltEqn"><a href="RnSource.html#rnTyFamDefltEqn"><span class="hs-identifier">rnTyFamDefltEqn</span></a></a><span> </span><a name="local-6989586621679821150"><a href="#local-6989586621679821150"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamEqn"><span class="hs-identifier hs-var">TyFamEqn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfe_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821151"><a href="#local-6989586621679821151"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-817"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821152"><a href="#local-6989586621679821152"><span class="hs-identifier">tyvars</span></a></a><span>
</span><a name="line-818"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_fixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821153"><a href="#local-6989586621679821153"><span class="hs-identifier">fixity</span></a></a><span>
</span><a name="line-819"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_rhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821154"><a href="#local-6989586621679821154"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-820"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-6989586621679821155"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679821150"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679821152"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821156"><a href="#local-6989586621679821156"><span class="hs-identifier">tyvars'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-821"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821157"><a href="#local-6989586621679821157"><span class="hs-identifier">tycon'</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupFamInstName"><span class="hs-identifier hs-var">lookupFamInstName</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679821150"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821151"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-822"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821158"><a href="#local-6989586621679821158"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821159"><a href="#local-6989586621679821159"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-6989586621679821155"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679821154"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-823"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyFamEqn"><span class="hs-identifier hs-var">TyFamEqn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tfe_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821157"><span class="hs-identifier hs-var">tycon'</span></a><span>
</span><a name="line-824"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821156"><span class="hs-identifier hs-var">tyvars'</span></a><span>
</span><a name="line-825"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_fixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821153"><span class="hs-identifier hs-var">fixity</span></a><span>
</span><a name="line-826"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tfe_rhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821158"><span class="hs-identifier hs-var">rhs'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821159"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-827"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-828"></a><span>    </span><a name="local-6989586621679821155"><a href="#local-6989586621679821155"><span class="hs-identifier">ctx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#TyFamilyCtx"><span class="hs-identifier hs-var">TyFamilyCtx</span></a><span> </span><a href="#local-6989586621679821151"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-829"></a><span>
</span><a name="line-830"></a><span class="hs-identifier">rnDataFamInstDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-831"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#DataFamInstDecl"><span class="hs-identifier hs-type">DataFamInstDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-832"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamInstDecl"><span class="hs-identifier hs-type">DataFamInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-833"></a><a name="rnDataFamInstDecl"><a href="RnSource.html#rnDataFamInstDecl"><span class="hs-identifier">rnDataFamInstDecl</span></a></a><span> </span><a name="local-6989586621679821160"><a href="#local-6989586621679821160"><span class="hs-identifier">mb_cls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamInstDecl"><span class="hs-identifier hs-var">DataFamInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dfid_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821161"><a href="#local-6989586621679821161"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-834"></a><span>                                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821162"><a href="#local-6989586621679821162"><span class="hs-identifier">pats</span></a></a><span>
</span><a name="line-835"></a><span>                                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_fixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821163"><a href="#local-6989586621679821163"><span class="hs-identifier">fixity</span></a></a><span>
</span><a name="line-836"></a><span>                                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_defn</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821164"><a href="#local-6989586621679821164"><span class="hs-identifier">defn</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-837"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821165"><a href="#local-6989586621679821165"><span class="hs-identifier">tycon'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821166"><a href="#local-6989586621679821166"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821167"><a href="#local-6989586621679821167"><span class="hs-identifier">defn'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821168"><a href="#local-6989586621679821168"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-838"></a><span>           </span><a href="RnSource.html#rnFamInstDecl"><span class="hs-identifier hs-var">rnFamInstDecl</span></a><span> </span><span class="hs-special">(</span><a href="RnUtils.html#TyDataCtx"><span class="hs-identifier hs-var">TyDataCtx</span></a><span> </span><a href="#local-6989586621679821161"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821160"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><a href="#local-6989586621679821161"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621679821162"><span class="hs-identifier hs-var">pats</span></a><span> </span><a href="#local-6989586621679821164"><span class="hs-identifier hs-var">defn</span></a><span> </span><a href="RnSource.html#rnDataDefn"><span class="hs-identifier hs-var">rnDataDefn</span></a><span>
</span><a name="line-839"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamInstDecl"><span class="hs-identifier hs-var">DataFamInstDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dfid_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821165"><span class="hs-identifier hs-var">tycon'</span></a><span>
</span><a name="line-840"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_pats</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821166"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-841"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_fixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821163"><span class="hs-identifier hs-var">fixity</span></a><span>
</span><a name="line-842"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_defn</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821167"><span class="hs-identifier hs-var">defn'</span></a><span>
</span><a name="line-843"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dfid_fvs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821168"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821168"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-844"></a><span>
</span><a name="line-845"></a><span class="hs-comment">-- Renaming of the associated types in instances.</span><span>
</span><a name="line-846"></a><span>
</span><a name="line-847"></a><span class="hs-comment">-- Rename associated type family decl in class</span><span>
</span><a name="line-848"></a><span class="hs-identifier">rnATDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>      </span><span class="hs-comment">-- Class</span><span>
</span><a name="line-849"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LFamilyDecl"><span class="hs-identifier hs-type">LFamilyDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-850"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#LFamilyDecl"><span class="hs-identifier hs-type">LFamilyDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-851"></a><a name="rnATDecls"><a href="RnSource.html#rnATDecls"><span class="hs-identifier">rnATDecls</span></a></a><span> </span><a name="local-6989586621679821169"><a href="#local-6989586621679821169"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679821170"><a href="#local-6989586621679821170"><span class="hs-identifier">at_decls</span></a></a><span>
</span><a name="line-852"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#rnFamDecl"><span class="hs-identifier hs-var">rnFamDecl</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679821169"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821170"><span class="hs-identifier hs-var">at_decls</span></a><span>
</span><a name="line-853"></a><span>
</span><a name="line-854"></a><span class="hs-identifier">rnATInstDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>    </span><span class="hs-comment">-- The function that renames</span><span>
</span><a name="line-855"></a><span>                  </span><a href="#local-6989586621679820867"><span class="hs-identifier hs-type">decl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>            </span><span class="hs-comment">-- an instance. rnTyFamInstDecl</span><span>
</span><a name="line-856"></a><span>                  </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820867"><span class="hs-identifier hs-type">decl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- or rnDataFamInstDecl</span><span>
</span><a name="line-857"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>      </span><span class="hs-comment">-- Class</span><span>
</span><a name="line-858"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-859"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820867"><span class="hs-identifier hs-type">decl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-860"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820867"><span class="hs-identifier hs-type">decl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-861"></a><span class="hs-comment">-- Used for data and type family defaults in a class decl</span><span>
</span><a name="line-862"></a><span class="hs-comment">-- and the family instance declarations in an instance</span><span>
</span><a name="line-863"></a><span class="hs-comment">--</span><span>
</span><a name="line-864"></a><span class="hs-comment">-- NB: We allow duplicate associated-type decls;</span><span>
</span><a name="line-865"></a><span class="hs-comment">--     See Note [Associated type instances] in TcInstDcls</span><span>
</span><a name="line-866"></a><a name="rnATInstDecls"><a href="RnSource.html#rnATInstDecls"><span class="hs-identifier">rnATInstDecls</span></a></a><span> </span><a name="local-6989586621679821171"><a href="#local-6989586621679821171"><span class="hs-identifier">rnFun</span></a></a><span> </span><a name="local-6989586621679821172"><a href="#local-6989586621679821172"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621679821173"><a href="#local-6989586621679821173"><span class="hs-identifier">tv_ns</span></a></a><span> </span><a name="local-6989586621679821174"><a href="#local-6989586621679821174"><span class="hs-identifier">at_insts</span></a></a><span>
</span><a name="line-867"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821171"><span class="hs-identifier hs-var">rnFun</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821172"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821173"><span class="hs-identifier hs-var">tv_ns</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821174"><span class="hs-identifier hs-var">at_insts</span></a><span>
</span><a name="line-868"></a><span>    </span><span class="hs-comment">-- See Note [Renaming associated types]</span><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span class="hs-comment">{- Note [Wildcards in family instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Wild cards can be used in type/data family instance declarations to indicate
that the name of a type variable doesn't matter. Each wild card will be
replaced with a new unique type variable. For instance:

    type family F a b :: *
    type instance F Int _ = Int

is the same as

    type family F a b :: *
    type instance F Int b = Int

This is implemented as follows: during renaming anonymous wild cards
'_' are given freshly generated names. These names are collected after
renaming (rnFamInstDecl) and used to make new type variables during
type checking (tc_fam_ty_pats). One should not confuse these wild
cards with the ones from partial type signatures. The latter generate
fresh meta-variables whereas the former generate fresh skolems.

Note [Unused type variables in family instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When the flag -fwarn-unused-type-patterns is on, the compiler reports
warnings about unused type variables in type-family instances. A
tpye variable is considered used (i.e. cannot be turned into a wildcard)
when

 * it occurs on the RHS of the family instance
   e.g.   type instance F a b = a    -- a is used on the RHS

 * it occurs multiple times in the patterns on the LHS
   e.g.   type instance F a a = Int  -- a appears more than once on LHS

 * it is one of the instance-decl variables, for associated types
   e.g.   instance C (a,b) where
            type T (a,b) = a
   Here the type pattern in the type instance must be the same as that
   for the class instance, so
            type T (a,_) = a
   would be rejected.  So we should not complain about an unused variable b

As usual, the warnings are not reported for for type variables with names
beginning with an underscore.

Extra-constraints wild cards are not supported in type/data family
instance declarations.

Relevant tickets: #3699, #10586, #10982 and #11451.

Note [Renaming associated types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Check that the RHS of the decl mentions only type variables
bound on the LHS.  For example, this is not ok
   class C a b where
      type F a x :: *
   instance C (p,q) r where
      type F (p,q) x = (x, r)   -- BAD: mentions 'r'
c.f. Trac #5515

The same thing applies to kind variables, of course (Trac #7938, #9574):
   class Funct f where
      type Codomain f :: *
   instance Funct ('KProxy :: KProxy o) where
      type Codomain 'KProxy = NatTr (Proxy :: o -&gt; *)
Here 'o' is mentioned on the RHS of the Codomain function, but
not on the LHS.

All this applies only for *instance* declarations.  In *class*
declarations there is no RHS to worry about, and the class variables
can all be in scope (Trac #5862):
    class Category (x :: k -&gt; k -&gt; *) where
      type Ob x :: k -&gt; Constraint
      id :: Ob x a =&gt; x a a
      (.) :: (Ob x a, Ob x b, Ob x c) =&gt; x b c -&gt; x a b -&gt; x a c
Here 'k' is in scope in the kind signature, just like 'x'.
-}</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span>
</span><a name="line-949"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Stand-alone deriving declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-956"></a><span>
</span><a name="line-957"></a><span class="hs-identifier">rnSrcDerivDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#DerivDecl"><span class="hs-identifier hs-type">DerivDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivDecl"><span class="hs-identifier hs-type">DerivDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-958"></a><a name="rnSrcDerivDecl"><a href="RnSource.html#rnSrcDerivDecl"><span class="hs-identifier">rnSrcDerivDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivDecl"><span class="hs-identifier hs-var">DerivDecl</span></a><span> </span><a name="local-6989586621679821175"><a href="#local-6989586621679821175"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679821176"><a href="#local-6989586621679821176"><span class="hs-identifier">deriv_strat</span></a></a><span> </span><a name="local-6989586621679821177"><a href="#local-6989586621679821177"><span class="hs-identifier">overlap</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-959"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821178"><a href="#local-6989586621679821178"><span class="hs-identifier">standalone_deriv_ok</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#StandaloneDeriving"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">StandaloneDeriving</span></a><span>
</span><a name="line-960"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821179"><a href="#local-6989586621679821179"><span class="hs-identifier">deriv_strats_ok</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DerivingStrategies"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DerivingStrategies</span></a><span>
</span><a name="line-961"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><a href="#local-6989586621679821178"><span class="hs-identifier hs-var">standalone_deriv_ok</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="RnSource.html#standaloneDerivErr"><span class="hs-identifier hs-var">standaloneDerivErr</span></a><span class="hs-special">)</span><span>
</span><a name="line-962"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#failIfTc"><span class="hs-identifier hs-var">failIfTc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><a href="#local-6989586621679821176"><span class="hs-identifier hs-var">deriv_strat</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679821179"><span class="hs-identifier hs-var">deriv_strats_ok</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-963"></a><span>           </span><a href="RnSource.html#illegalDerivStrategyErr"><span class="hs-identifier hs-var">illegalDerivStrategyErr</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821176"><span class="hs-identifier hs-var">deriv_strat</span></a><span>
</span><a name="line-964"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821180"><a href="#local-6989586621679821180"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821181"><a href="#local-6989586621679821181"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsInstType"><span class="hs-identifier hs-var">rnLHsInstType</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;In a deriving declaration&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821175"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-965"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivDecl"><span class="hs-identifier hs-var">DerivDecl</span></a><span> </span><a href="#local-6989586621679821180"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621679821176"><span class="hs-identifier hs-var">deriv_strat</span></a><span> </span><a href="#local-6989586621679821177"><span class="hs-identifier hs-var">overlap</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821181"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-966"></a><span>
</span><a name="line-967"></a><span class="hs-identifier">standaloneDerivErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-968"></a><a name="standaloneDerivErr"><a href="RnSource.html#standaloneDerivErr"><span class="hs-identifier">standaloneDerivErr</span></a></a><span>
</span><a name="line-969"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal standalone deriving declaration&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-970"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Use StandaloneDeriving to enable this extension&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-971"></a><span>
</span><a name="line-972"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Rules}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-979"></a><span>
</span><a name="line-980"></a><span class="hs-identifier">rnHsRuleDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#RuleDecls"><span class="hs-identifier hs-type">RuleDecls</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleDecls"><span class="hs-identifier hs-type">RuleDecls</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-981"></a><a name="rnHsRuleDecls"><a href="RnSource.html#rnHsRuleDecls"><span class="hs-identifier">rnHsRuleDecls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsRules"><span class="hs-identifier hs-var">HsRules</span></a><span> </span><a name="local-6989586621679821182"><a href="#local-6989586621679821182"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621679821183"><a href="#local-6989586621679821183"><span class="hs-identifier">rules</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-982"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821184"><a href="#local-6989586621679821184"><span class="hs-identifier">rn_rules</span></a></a><span class="hs-special">,</span><a name="local-6989586621679821185"><a href="#local-6989586621679821185"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><a href="RnSource.html#rnHsRuleDecl"><span class="hs-identifier hs-var">rnHsRuleDecl</span></a><span> </span><a href="#local-6989586621679821183"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-983"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsRules"><span class="hs-identifier hs-var">HsRules</span></a><span> </span><a href="#local-6989586621679821182"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621679821184"><span class="hs-identifier hs-var">rn_rules</span></a><span class="hs-special">,</span><a href="#local-6989586621679821185"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-984"></a><span>
</span><a name="line-985"></a><span class="hs-identifier">rnHsRuleDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#RuleDecl"><span class="hs-identifier hs-type">RuleDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleDecl"><span class="hs-identifier hs-type">RuleDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-986"></a><a name="rnHsRuleDecl"><a href="RnSource.html#rnHsRuleDecl"><span class="hs-identifier">rnHsRuleDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsRule"><span class="hs-identifier hs-var">HsRule</span></a><span> </span><a name="local-6989586621679821186"><a href="#local-6989586621679821186"><span class="hs-identifier">rule_name</span></a></a><span> </span><a name="local-6989586621679821187"><a href="#local-6989586621679821187"><span class="hs-identifier">act</span></a></a><span> </span><a name="local-6989586621679821188"><a href="#local-6989586621679821188"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679821189"><a href="#local-6989586621679821189"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-6989586621679821190"><a href="#local-6989586621679821190"><span class="hs-identifier">_fv_lhs</span></a></a><span> </span><a name="local-6989586621679821191"><a href="#local-6989586621679821191"><span class="hs-identifier">rhs</span></a></a><span> </span><a name="local-6989586621679821192"><a href="#local-6989586621679821192"><span class="hs-identifier">_fv_rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-987"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821196"><a href="#local-6989586621679821196"><span class="hs-identifier">rdr_names_w_loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679821193"><span class="hs-identifier hs-var">get_var</span></a><span> </span><a href="#local-6989586621679821188"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-988"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span> </span><a href="#local-6989586621679821196"><span class="hs-identifier hs-var">rdr_names_w_loc</span></a><span>
</span><a name="line-989"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#checkShadowedRdrNames"><span class="hs-identifier hs-var">checkShadowedRdrNames</span></a><span> </span><a href="#local-6989586621679821196"><span class="hs-identifier hs-var">rdr_names_w_loc</span></a><span>
</span><a name="line-990"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821197"><a href="#local-6989586621679821197"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#newLocalBndrsRn"><span class="hs-identifier hs-var">newLocalBndrsRn</span></a><span> </span><a href="#local-6989586621679821196"><span class="hs-identifier hs-var">rdr_names_w_loc</span></a><span>
</span><a name="line-991"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnSource.html#bindHsRuleVars"><span class="hs-identifier hs-var">bindHsRuleVars</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821186"><span class="hs-identifier hs-var">rule_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821188"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621679821197"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821198"><a href="#local-6989586621679821198"><span class="hs-identifier">vars'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-992"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821199"><a href="#local-6989586621679821199"><span class="hs-identifier">lhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821200"><a href="#local-6989586621679821200"><span class="hs-identifier">fv_lhs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621679821189"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-993"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821201"><a href="#local-6989586621679821201"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821202"><a href="#local-6989586621679821202"><span class="hs-identifier">fv_rhs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621679821191"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-994"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnSource.html#checkValidRule"><span class="hs-identifier hs-var">checkValidRule</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821186"><span class="hs-identifier hs-var">rule_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821197"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="#local-6989586621679821199"><span class="hs-identifier hs-var">lhs'</span></a><span> </span><a href="#local-6989586621679821200"><span class="hs-identifier hs-var">fv_lhs'</span></a><span>
</span><a name="line-995"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsRule"><span class="hs-identifier hs-var">HsRule</span></a><span> </span><a href="#local-6989586621679821186"><span class="hs-identifier hs-var">rule_name</span></a><span> </span><a href="#local-6989586621679821187"><span class="hs-identifier hs-var">act</span></a><span> </span><a href="#local-6989586621679821198"><span class="hs-identifier hs-var">vars'</span></a><span> </span><a href="#local-6989586621679821199"><span class="hs-identifier hs-var">lhs'</span></a><span> </span><a href="#local-6989586621679821200"><span class="hs-identifier hs-var">fv_lhs'</span></a><span> </span><a href="#local-6989586621679821201"><span class="hs-identifier hs-var">rhs'</span></a><span> </span><a href="#local-6989586621679821202"><span class="hs-identifier hs-var">fv_rhs'</span></a><span class="hs-special">,</span><span>
</span><a name="line-996"></a><span>                 </span><a href="#local-6989586621679821200"><span class="hs-identifier hs-var">fv_lhs'</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821202"><span class="hs-identifier hs-var">fv_rhs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-997"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-998"></a><span>    </span><a name="local-6989586621679821193"><a href="#local-6989586621679821193"><span class="hs-identifier">get_var</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndrSig"><span class="hs-identifier hs-var">RuleBndrSig</span></a><span> </span><a name="local-6989586621679821194"><a href="#local-6989586621679821194"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821194"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-999"></a><span>    </span><span class="hs-identifier">get_var</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndr"><span class="hs-identifier hs-var">RuleBndr</span></a><span> </span><a name="local-6989586621679821195"><a href="#local-6989586621679821195"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821195"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1000"></a><span>
</span><a name="line-1001"></a><span class="hs-identifier">bindHsRuleVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#RuleName"><span class="hs-identifier hs-type">RuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LRuleBndr"><span class="hs-identifier hs-type">LRuleBndr</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1002"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#LRuleBndr"><span class="hs-identifier hs-type">LRuleBndr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820866"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1003"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679820866"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1004"></a><a name="bindHsRuleVars"><a href="RnSource.html#bindHsRuleVars"><span class="hs-identifier">bindHsRuleVars</span></a></a><span> </span><a name="local-6989586621679821203"><a href="#local-6989586621679821203"><span class="hs-identifier">rule_name</span></a></a><span> </span><a name="local-6989586621679821204"><a href="#local-6989586621679821204"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679821205"><a href="#local-6989586621679821205"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-6989586621679821206"><a href="#local-6989586621679821206"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1005"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821208"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679821204"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621679821205"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821228"><a href="#local-6989586621679821228"><span class="hs-identifier">vars'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1006"></a><span>    </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><a href="#local-6989586621679821205"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821206"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621679821228"><span class="hs-identifier hs-var">vars'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1007"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1008"></a><span>    </span><a name="local-6989586621679821207"><a href="#local-6989586621679821207"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#RuleCtx"><span class="hs-identifier hs-var">RuleCtx</span></a><span> </span><a href="#local-6989586621679821203"><span class="hs-identifier hs-var">rule_name</span></a><span>
</span><a name="line-1009"></a><span>
</span><a name="line-1010"></a><span>    </span><a name="local-6989586621679821208"><a href="#local-6989586621679821208"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821209"><a href="#local-6989586621679821209"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndr"><span class="hs-identifier hs-var">RuleBndr</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821210"><a href="#local-6989586621679821210"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679821211"><a href="#local-6989586621679821211"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821212"><a href="#local-6989586621679821212"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679821213"><a href="#local-6989586621679821213"><span class="hs-identifier">ns</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821214"><a href="#local-6989586621679821214"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1011"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821208"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679821211"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621679821213"><span class="hs-identifier hs-var">ns</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821215"><a href="#local-6989586621679821215"><span class="hs-identifier">vars'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1012"></a><span>        </span><a href="#local-6989586621679821214"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821209"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndr"><span class="hs-identifier hs-var">RuleBndr</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821210"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679821212"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821215"><span class="hs-identifier hs-var">vars'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1013"></a><span>
</span><a name="line-1014"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821216"><a href="#local-6989586621679821216"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndrSig"><span class="hs-identifier hs-var">RuleBndrSig</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821217"><a href="#local-6989586621679821217"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821218"><a href="#local-6989586621679821218"><span class="hs-identifier">bsig</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679821219"><a href="#local-6989586621679821219"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821220"><a href="#local-6989586621679821220"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679821221"><a href="#local-6989586621679821221"><span class="hs-identifier">ns</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821222"><a href="#local-6989586621679821222"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1015"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnHsSigWcTypeScoped"><span class="hs-identifier hs-var">rnHsSigWcTypeScoped</span></a><span> </span><a href="#local-6989586621679821207"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821218"><span class="hs-identifier hs-var">bsig</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821223"><a href="#local-6989586621679821223"><span class="hs-identifier">bsig'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1016"></a><span>        </span><a href="#local-6989586621679821208"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679821219"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621679821221"><span class="hs-identifier hs-var">ns</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821224"><a href="#local-6989586621679821224"><span class="hs-identifier">vars'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1017"></a><span>        </span><a href="#local-6989586621679821222"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821216"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleBndrSig"><span class="hs-identifier hs-var">RuleBndrSig</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821217"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679821220"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821223"><span class="hs-identifier hs-var">bsig'</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821224"><span class="hs-identifier hs-var">vars'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1018"></a><span>
</span><a name="line-1019"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679821225"><a href="#local-6989586621679821225"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821225"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1020"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679821226"><a href="#local-6989586621679821226"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679821227"><a href="#local-6989586621679821227"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;bindRuleVars&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821226"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821227"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span>
</span><a name="line-1021"></a><span>
</span><a name="line-1022"></a><span class="hs-comment">{-
Note [Rule LHS validity checking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Check the shape of a transformation rule LHS.  Currently we only allow
LHSs of the form @(f e1 .. en)@, where @f@ is not one of the
@forall@'d variables.

We used restrict the form of the 'ei' to prevent you writing rules
with LHSs with a complicated desugaring (and hence unlikely to match);
(e.g. a case expression is not allowed: too elaborate.)

But there are legitimate non-trivial args ei, like sections and
lambdas.  So it seems simmpler not to check at all, and that is why
check_e is commented out.
-}</span><span>
</span><a name="line-1037"></a><span>
</span><a name="line-1038"></a><span class="hs-identifier">checkValidRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1039"></a><a name="checkValidRule"><a href="RnSource.html#checkValidRule"><span class="hs-identifier">checkValidRule</span></a></a><span> </span><a name="local-6989586621679821229"><a href="#local-6989586621679821229"><span class="hs-identifier">rule_name</span></a></a><span> </span><a name="local-6989586621679821230"><a href="#local-6989586621679821230"><span class="hs-identifier">ids</span></a></a><span> </span><a name="local-6989586621679821231"><a href="#local-6989586621679821231"><span class="hs-identifier">lhs'</span></a></a><span> </span><a name="local-6989586621679821232"><a href="#local-6989586621679821232"><span class="hs-identifier">fv_lhs'</span></a></a><span>
</span><a name="line-1040"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>       </span><span class="hs-comment">-- Check for the form of the LHS</span><span>
</span><a name="line-1041"></a><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="RnSource.html#validRuleLhs"><span class="hs-identifier hs-var">validRuleLhs</span></a><span> </span><a href="#local-6989586621679821230"><span class="hs-identifier hs-var">ids</span></a><span> </span><a href="#local-6989586621679821231"><span class="hs-identifier hs-var">lhs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1042"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1043"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679821233"><a href="#local-6989586621679821233"><span class="hs-identifier">bad</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#badRuleLhsErr"><span class="hs-identifier hs-var">badRuleLhsErr</span></a><span> </span><a href="#local-6989586621679821229"><span class="hs-identifier hs-var">rule_name</span></a><span> </span><a href="#local-6989586621679821231"><span class="hs-identifier hs-var">lhs'</span></a><span> </span><a href="#local-6989586621679821233"><span class="hs-identifier hs-var">bad</span></a><span class="hs-special">)</span><span>
</span><a name="line-1044"></a><span>
</span><a name="line-1045"></a><span>                </span><span class="hs-comment">-- Check that LHS vars are all bound</span><span>
</span><a name="line-1046"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821234"><a href="#local-6989586621679821234"><span class="hs-identifier">bad_vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679821235"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679821235"><a href="#local-6989586621679821235"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821230"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821235"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821232"><span class="hs-identifier hs-var">fv_lhs'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1047"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="RnSource.html#badRuleVar"><span class="hs-identifier hs-var">badRuleVar</span></a><span> </span><a href="#local-6989586621679821229"><span class="hs-identifier hs-var">rule_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821234"><span class="hs-identifier hs-var">bad_vars</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1048"></a><span>
</span><a name="line-1049"></a><span class="hs-identifier">validRuleLhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1050"></a><span class="hs-comment">-- Nothing =&gt; OK</span><span>
</span><a name="line-1051"></a><span class="hs-comment">-- Just e  =&gt; Not ok, and e is the offending sub-expression</span><span>
</span><a name="line-1052"></a><a name="validRuleLhs"><a href="RnSource.html#validRuleLhs"><span class="hs-identifier">validRuleLhs</span></a></a><span> </span><a name="local-6989586621679821236"><a href="#local-6989586621679821236"><span class="hs-identifier">foralls</span></a></a><span> </span><a name="local-6989586621679821237"><a href="#local-6989586621679821237"><span class="hs-identifier">lhs</span></a></a><span>
</span><a name="line-1053"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821238"><span class="hs-identifier hs-var">checkl</span></a><span> </span><a href="#local-6989586621679821237"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-1054"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1055"></a><span>    </span><a name="local-6989586621679821238"><a href="#local-6989586621679821238"><span class="hs-identifier">checkl</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821241"><a href="#local-6989586621679821241"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821239"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621679821241"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1056"></a><span>
</span><a name="line-1057"></a><span>    </span><a name="local-6989586621679821239"><a href="#local-6989586621679821239"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#OpApp"><span class="hs-identifier hs-var">OpApp</span></a><span> </span><a name="local-6989586621679821242"><a href="#local-6989586621679821242"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621679821243"><a href="#local-6989586621679821243"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821244"><a href="#local-6989586621679821244"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821238"><span class="hs-identifier hs-var">checkl</span></a><span> </span><a href="#local-6989586621679821243"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mplus"><span class="hs-identifier hs-var">mplus</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821240"><span class="hs-identifier hs-var">checkl_e</span></a><span> </span><a href="#local-6989586621679821242"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mplus"><span class="hs-identifier hs-var">mplus</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821240"><span class="hs-identifier hs-var">checkl_e</span></a><span> </span><a href="#local-6989586621679821244"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1058"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a><span> </span><a name="local-6989586621679821245"><a href="#local-6989586621679821245"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621679821246"><a href="#local-6989586621679821246"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821238"><span class="hs-identifier hs-var">checkl</span></a><span> </span><a href="#local-6989586621679821245"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#mplus"><span class="hs-identifier hs-var">mplus</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821240"><span class="hs-identifier hs-var">checkl_e</span></a><span> </span><a href="#local-6989586621679821246"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1059"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsAppType"><span class="hs-identifier hs-var">HsAppType</span></a><span> </span><a name="local-6989586621679821247"><a href="#local-6989586621679821247"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821238"><span class="hs-identifier hs-var">checkl</span></a><span> </span><a href="#local-6989586621679821247"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1060"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821248"><a href="#local-6989586621679821248"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821248"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">notElem</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821236"><span class="hs-identifier hs-var">foralls</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1061"></a><span>    </span><span class="hs-identifier">check</span><span> </span><a name="local-6989586621679821249"><a href="#local-6989586621679821249"><span class="hs-identifier">other</span></a></a><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679821249"><span class="hs-identifier hs-var">other</span></a><span>  </span><span class="hs-comment">-- Failure</span><span>
</span><a name="line-1062"></a><span>
</span><a name="line-1063"></a><span>        </span><span class="hs-comment">-- Check an argument</span><span>
</span><a name="line-1064"></a><span>    </span><a name="local-6989586621679821240"><a href="#local-6989586621679821240"><span class="hs-identifier">checkl_e</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821250"><a href="#local-6989586621679821250"><span class="hs-identifier">_e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>         </span><span class="hs-comment">-- Was (check_e e); see Note [Rule LHS validity checking]</span><span>
</span><a name="line-1065"></a><span>
</span><a name="line-1066"></a><span class="hs-comment">{-      Commented out; see Note [Rule LHS validity checking] above
    check_e (HsVar v)     = Nothing
    check_e (HsPar e)     = checkl_e e
    check_e (HsLit e)     = Nothing
    check_e (HsOverLit e) = Nothing

    check_e (OpApp e1 op _ e2)   = checkl_e e1 `mplus` checkl_e op `mplus` checkl_e e2
    check_e (HsApp e1 e2)        = checkl_e e1 `mplus` checkl_e e2
    check_e (NegApp e _)         = checkl_e e
    check_e (ExplicitList _ es)  = checkl_es es
    check_e other                = Just other   -- Fails

    checkl_es es = foldr (mplus . checkl_e) Nothing es
-}</span><span>
</span><a name="line-1080"></a><span>
</span><a name="line-1081"></a><span class="hs-identifier">badRuleVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1082"></a><a name="badRuleVar"><a href="RnSource.html#badRuleVar"><span class="hs-identifier">badRuleVar</span></a></a><span> </span><a name="local-6989586621679821251"><a href="#local-6989586621679821251"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679821252"><a href="#local-6989586621679821252"><span class="hs-identifier">var</span></a></a><span>
</span><a name="line-1083"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Rule&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#doubleQuotes"><span class="hs-identifier hs-var">doubleQuotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a><span> </span><a href="#local-6989586621679821251"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1084"></a><span>         </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Forall'd variable&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821252"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1085"></a><span>                </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;does not appear on left hand side&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1086"></a><span>
</span><a name="line-1087"></a><span class="hs-identifier">badRuleLhsErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1088"></a><a name="badRuleLhsErr"><a href="RnSource.html#badRuleLhsErr"><span class="hs-identifier">badRuleLhsErr</span></a></a><span> </span><a name="local-6989586621679821253"><a href="#local-6989586621679821253"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679821254"><a href="#local-6989586621679821254"><span class="hs-identifier">lhs</span></a></a><span> </span><a name="local-6989586621679821255"><a href="#local-6989586621679821255"><span class="hs-identifier">bad_e</span></a></a><span>
</span><a name="line-1089"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Rule&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="BasicTypes.html#pprRuleName"><span class="hs-identifier hs-var">pprRuleName</span></a><span> </span><a href="#local-6989586621679821253"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1090"></a><span>         </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679821256"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">,</span><span>
</span><a name="line-1091"></a><span>                       </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in left-hand side:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821254"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1092"></a><span>    </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1093"></a><span>    </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;LHS must be of form (f e1 .. en) where f is not forall'd&quot;</span><span>
</span><a name="line-1094"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1095"></a><span>    </span><a name="local-6989586621679821256"><a href="#local-6989586621679821256"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821255"><span class="hs-identifier hs-var">bad_e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1096"></a><span>            </span><a href="HsExpr.html#HsUnboundVar"><span class="hs-identifier hs-var">HsUnboundVar</span></a><span> </span><a name="local-6989586621679821257"><a href="#local-6989586621679821257"><span class="hs-identifier">uv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Not in scope:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821257"><span class="hs-identifier hs-var">uv</span></a><span>
</span><a name="line-1097"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal expression:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821255"><span class="hs-identifier hs-var">bad_e</span></a><span>
</span><a name="line-1098"></a><span>
</span><a name="line-1099"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Vectorisation declarations}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-1106"></a><span>
</span><a name="line-1107"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#VectDecl"><span class="hs-identifier hs-type">VectDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#VectDecl"><span class="hs-identifier hs-type">VectDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1108"></a><span class="hs-comment">-- FIXME: For the moment, the right-hand side is restricted to be a variable as we cannot properly</span><span>
</span><a name="line-1109"></a><span class="hs-comment">--        typecheck a complex right-hand side without invoking 'vectType' from the vectoriser.</span><span>
</span><a name="line-1110"></a><a name="rnHsVectDecl"><a href="RnSource.html#rnHsVectDecl"><span class="hs-identifier">rnHsVectDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVect"><span class="hs-identifier hs-var">HsVect</span></a><span> </span><a name="local-6989586621679821258"><a href="#local-6989586621679821258"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679821259"><a href="#local-6989586621679821259"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679821260"><a href="#local-6989586621679821260"><span class="hs-identifier">rhs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1111"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821261"><a href="#local-6989586621679821261"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-6989586621679821259"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-1112"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821262"><a href="#local-6989586621679821262"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821263"><a href="#local-6989586621679821263"><span class="hs-identifier">fv_rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621679821260"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1113"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVect"><span class="hs-identifier hs-var">HsVect</span></a><span> </span><a href="#local-6989586621679821258"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679821261"><span class="hs-identifier hs-var">var'</span></a><span> </span><a href="#local-6989586621679821262"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821263"><span class="hs-identifier hs-var">fv_rhs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#addOneFV"><span class="hs-identifier hs-var">addOneFV</span></a><span class="hs-special">`</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821261"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1114"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1115"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVect"><span class="hs-identifier hs-var">HsVect</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821264"><a href="#local-6989586621679821264"><span class="hs-identifier">_var</span></a></a><span> </span><a name="local-6989586621679821265"><a href="#local-6989586621679821265"><span class="hs-identifier">_rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1116"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-1117"></a><span>               </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;IMPLEMENTATION RESTRICTION: right-hand side of a VECTORISE pragma&quot;</span><span>
</span><a name="line-1118"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;must be an identifier&quot;</span><span>
</span><a name="line-1119"></a><span>               </span><span class="hs-special">]</span><span>
</span><a name="line-1120"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsNoVect"><span class="hs-identifier hs-var">HsNoVect</span></a><span> </span><a name="local-6989586621679821266"><a href="#local-6989586621679821266"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679821267"><a href="#local-6989586621679821267"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1121"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821268"><a href="#local-6989586621679821268"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-6989586621679821267"><span class="hs-identifier hs-var">var</span></a><span>           </span><span class="hs-comment">-- only applies to local (not imported) names</span><span>
</span><a name="line-1122"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsNoVect"><span class="hs-identifier hs-var">HsNoVect</span></a><span> </span><a href="#local-6989586621679821266"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679821268"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821268"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1123"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1124"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectTypeIn"><span class="hs-identifier hs-var">HsVectTypeIn</span></a><span> </span><a name="local-6989586621679821269"><a href="#local-6989586621679821269"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679821270"><a href="#local-6989586621679821270"><span class="hs-identifier">isScalar</span></a></a><span> </span><a name="local-6989586621679821271"><a href="#local-6989586621679821271"><span class="hs-identifier">tycon</span></a></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1125"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821272"><a href="#local-6989586621679821272"><span class="hs-identifier">tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-6989586621679821271"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1126"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectTypeIn"><span class="hs-identifier hs-var">HsVectTypeIn</span></a><span> </span><a href="#local-6989586621679821269"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679821270"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="#local-6989586621679821272"><span class="hs-identifier hs-var">tycon'</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821272"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1127"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1128"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectTypeIn"><span class="hs-identifier hs-var">HsVectTypeIn</span></a><span> </span><a name="local-6989586621679821273"><a href="#local-6989586621679821273"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679821274"><a href="#local-6989586621679821274"><span class="hs-identifier">isScalar</span></a></a><span> </span><a name="local-6989586621679821275"><a href="#local-6989586621679821275"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679821276"><a href="#local-6989586621679821276"><span class="hs-identifier">rhs_tycon</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1129"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821277"><a href="#local-6989586621679821277"><span class="hs-identifier">tycon'</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-6989586621679821275"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1130"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821278"><a href="#local-6989586621679821278"><span class="hs-identifier">rhs_tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-6989586621679821276"><span class="hs-identifier hs-var">rhs_tycon</span></a><span>
</span><a name="line-1131"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="HsDecls.html#HsVectTypeIn"><span class="hs-identifier hs-var">HsVectTypeIn</span></a><span> </span><a href="#local-6989586621679821273"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679821274"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="#local-6989586621679821277"><span class="hs-identifier hs-var">tycon'</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679821278"><span class="hs-identifier hs-var">rhs_tycon'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1132"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="NameSet.html#mkFVs"><span class="hs-identifier hs-var">mkFVs</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821277"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821278"><span class="hs-identifier hs-var">rhs_tycon'</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1133"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1134"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectTypeOut"><span class="hs-identifier hs-var">HsVectTypeOut</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1135"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;RnSource.rnHsVectDecl: Unexpected 'HsVectTypeOut'&quot;</span><span>
</span><a name="line-1136"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectClassIn"><span class="hs-identifier hs-var">HsVectClassIn</span></a><span> </span><a name="local-6989586621679821279"><a href="#local-6989586621679821279"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679821280"><a href="#local-6989586621679821280"><span class="hs-identifier">cls</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1137"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821281"><a href="#local-6989586621679821281"><span class="hs-identifier">cls'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-6989586621679821280"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-1138"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectClassIn"><span class="hs-identifier hs-var">HsVectClassIn</span></a><span> </span><a href="#local-6989586621679821279"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679821281"><span class="hs-identifier hs-var">cls'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821281"><span class="hs-identifier hs-var">cls'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1139"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1140"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectClassOut"><span class="hs-identifier hs-var">HsVectClassOut</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1141"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;RnSource.rnHsVectDecl: Unexpected 'HsVectClassOut'&quot;</span><span>
</span><a name="line-1142"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectInstIn"><span class="hs-identifier hs-var">HsVectInstIn</span></a><span> </span><a name="local-6989586621679821282"><a href="#local-6989586621679821282"><span class="hs-identifier">instTy</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1143"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821283"><a href="#local-6989586621679821283"><span class="hs-identifier">instTy'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821284"><a href="#local-6989586621679821284"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsInstType"><span class="hs-identifier hs-var">rnLHsInstType</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a VECTORISE pragma&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821282"><span class="hs-identifier hs-var">instTy</span></a><span>
</span><a name="line-1144"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectInstIn"><span class="hs-identifier hs-var">HsVectInstIn</span></a><span> </span><a href="#local-6989586621679821283"><span class="hs-identifier hs-var">instTy'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821284"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1145"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-1146"></a><span class="hs-identifier">rnHsVectDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsVectInstOut"><span class="hs-identifier hs-var">HsVectInstOut</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1147"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;RnSource.rnHsVectDecl: Unexpected 'HsVectInstOut'&quot;</span><span>
</span><a name="line-1148"></a><span>
</span><a name="line-1149"></a><span class="hs-comment">{- **************************************************************
         *                                                      *
      Renaming type, class, instance and role declarations
*                                                               *
*****************************************************************

@rnTyDecl@ uses the `global name function' to create a new type
declaration in which local names have been replaced by their original
names, reporting any unknown names.

Renaming type variables is a pain. Because they now contain uniques,
it is necessary to pass in an association list which maps a parsed
tyvar to its @Name@ representation.
In some cases (type signatures of values),
it is even necessary to go over the type first
in order to get the set of tyvars used by it, make an assoc list,
and then go over it again to rename the tyvars!
However, we can also do some scoping checks at the same time.

Note [Dependency analysis of type, class, and instance decls]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A TyClGroup represents a strongly connected components of
type/class/instance decls, together with the role annotations for the
type/class declarations.  The renamer uses strongly connected
comoponent analysis to build these groups.  We do this for a number of
reasons:

* Improve kind error messages. Consider

     data T f a = MkT f a
     data S f a = MkS f (T f a)

  This has a kind error, but the error message is better if you
  check T first, (fixing its kind) and *then* S.  If you do kind
  inference together, you might get an error reported in S, which
  is jolly confusing.  See Trac #4875


* Increase kind polymorphism.  See TcTyClsDecls
  Note [Grouping of type and class declarations]

Why do the instance declarations participate?  At least two reasons

* Consider (Trac #11348)

     type family F a
     type instance F Int = Bool

     data R = MkR (F Int)

     type Foo = 'MkR 'True

  For Foo to kind-check we need to know that (F Int) ~ Bool.  But we won't
  know that unless we've looked at the type instance declaration for F
  before kind-checking Foo.

* Another example is this (Trac #3990).

     data family Complex a
     data instance Complex Double = CD {-# UNPACK #-} !Double
                                       {-# UNPACK #-} !Double

     data T = T {-# UNPACK #-} !(Complex Double)

  Here, to generate the right kind of unpacked implementation for T,
  we must have access to the 'data instance' declaration.

* Things become more complicated when we introduce transitive
  dependencies through imported definitions, like in this scenario:

      A.hs
        type family Closed (t :: Type) :: Type where
          Closed t = Open t

        type family Open (t :: Type) :: Type

      B.hs
        data Q where
          Q :: Closed Bool -&gt; Q

        type instance Open Int = Bool

        type S = 'Q 'True

  Somehow, we must ensure that the instance Open Int = Bool is checked before
  the type synonym S. While we know that S depends upon 'Q depends upon Closed,
  we have no idea that Closed depends upon Open!

  To accomodate for these situations, we ensure that an instance is checked
  before every @TyClDecl@ on which it does not depend. That's to say, instances
  are checked as early as possible in @tcTyAndClassDecls@.

------------------------------------
So much for WHY.  What about HOW?  It's pretty easy:

(1) Rename the type/class, instance, and role declarations
    individually

(2) Do strongly-connected component analysis of the type/class decls,
    We'll make a TyClGroup for each SCC

    In this step we treat a reference to a (promoted) data constructor
    K as a dependency on its parent type.  Thus
        data T = K1 | K2
        data S = MkS (Proxy 'K1)
    Here S depends on 'K1 and hence on its parent T.

    In this step we ignore instances; see
    Note [No dependencies on data instances]

(3) Attach roles to the appropriate SCC

(4) Attach instances to the appropriate SCC.
    We add an instance decl to SCC when:
      all its free types/classes are bound in this SCC or earlier ones

(5) We make an initial TyClGroup, with empty group_tyclds, for any
    (orphan) instances that affect only imported types/classes

Steps (3) and (4) are done by the (mapAccumL mk_group) call.

Note [No dependencies on data instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this
   data family D a
   data instance D Int = D1
   data S = MkS (Proxy 'D1)

Here the declaration of S depends on the /data instance/ declaration
for 'D Int'.  That makes things a lot more complicated, especially
if the data instance is an associated type of an enclosing class instance.
(And the class instance might have several associated type instances
with different dependency structure!)

Ugh.  For now we simply don't allow promotion of data constructors for
data instances.  See Note [AFamDataCon: not promoting data family
constructors] in TcEnv
-}</span><span>
</span><a name="line-1287"></a><span>
</span><a name="line-1288"></a><span>
</span><a name="line-1289"></a><span class="hs-identifier">rnTyClDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-1290"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1291"></a><span class="hs-comment">-- Rename the declarations and do dependency analysis on them</span><span>
</span><a name="line-1292"></a><a name="rnTyClDecls"><a href="RnSource.html#rnTyClDecls"><span class="hs-identifier">rnTyClDecls</span></a></a><span> </span><a name="local-6989586621679821285"><a href="#local-6989586621679821285"><span class="hs-identifier">tycl_ds</span></a></a><span>
</span><a name="line-1293"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Rename the type/class, instance, and role declaraations</span><span>
</span><a name="line-1294"></a><span>         </span><a name="local-6989586621679821297"><a href="#local-6989586621679821297"><span class="hs-identifier">tycls_w_fvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><a href="RnSource.html#rnTyClDecl"><span class="hs-identifier hs-var">rnTyClDecl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1295"></a><span>                             </span><span class="hs-special">(</span><a href="HsDecls.html#tyClGroupTyClDecls"><span class="hs-identifier hs-var">tyClGroupTyClDecls</span></a><span> </span><a href="#local-6989586621679821285"><span class="hs-identifier hs-var">tycl_ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1296"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821298"><a href="#local-6989586621679821298"><span class="hs-identifier">tc_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821297"><span class="hs-identifier hs-var">tycls_w_fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1297"></a><span>
</span><a name="line-1298"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821299"><a href="#local-6989586621679821299"><span class="hs-identifier">instds_w_fvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><a href="RnSource.html#rnSrcInstDecl"><span class="hs-identifier hs-var">rnSrcInstDecl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#tyClGroupInstDecls"><span class="hs-identifier hs-var">tyClGroupInstDecls</span></a><span> </span><a href="#local-6989586621679821285"><span class="hs-identifier hs-var">tycl_ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1299"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821300"><a href="#local-6989586621679821300"><span class="hs-identifier">role_annots</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnRoleAnnots"><span class="hs-identifier hs-var">rnRoleAnnots</span></a><span> </span><a href="#local-6989586621679821298"><span class="hs-identifier hs-var">tc_names</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#tyClGroupRoleDecls"><span class="hs-identifier hs-var">tyClGroupRoleDecls</span></a><span> </span><a href="#local-6989586621679821285"><span class="hs-identifier hs-var">tycl_ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1300"></a><span>
</span><a name="line-1301"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821301"><a href="#local-6989586621679821301"><span class="hs-identifier">tycls_w_fvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#addBootDeps"><span class="hs-identifier hs-var">addBootDeps</span></a><span> </span><a href="#local-6989586621679821297"><span class="hs-identifier hs-var">tycls_w_fvs</span></a><span>
</span><a name="line-1302"></a><span>                      </span><span class="hs-comment">-- TBD must add_boot_deps to instds_w_fvs?</span><span>
</span><a name="line-1303"></a><span>
</span><a name="line-1304"></a><span>       </span><span class="hs-comment">-- Do SCC analysis on the type/class decls</span><span>
</span><a name="line-1305"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821302"><a href="#local-6989586621679821302"><span class="hs-identifier">rdr_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a><span>
</span><a name="line-1306"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821303"><a href="#local-6989586621679821303"><span class="hs-identifier">tycl_sccs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#depAnalTyClDecls"><span class="hs-identifier hs-var">depAnalTyClDecls</span></a><span> </span><a href="#local-6989586621679821302"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621679821301"><span class="hs-identifier hs-var">tycls_w_fvs</span></a><span>
</span><a name="line-1307"></a><span>             </span><a name="local-6989586621679821304"><a href="#local-6989586621679821304"><span class="hs-identifier">role_annot_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#mkRoleAnnotEnv"><span class="hs-identifier hs-var">mkRoleAnnotEnv</span></a><span> </span><a href="#local-6989586621679821300"><span class="hs-identifier hs-var">role_annots</span></a><span>
</span><a name="line-1308"></a><span>
</span><a name="line-1309"></a><span>             </span><a name="local-6989586621679821305"><a href="#local-6989586621679821305"><span class="hs-identifier">inst_ds_map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#mkInstDeclFreeVarsMap"><span class="hs-identifier hs-var">mkInstDeclFreeVarsMap</span></a><span> </span><a href="#local-6989586621679821302"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621679821298"><span class="hs-identifier hs-var">tc_names</span></a><span> </span><a href="#local-6989586621679821299"><span class="hs-identifier hs-var">instds_w_fvs</span></a><span>
</span><a name="line-1310"></a><span>             </span><span class="hs-special">(</span><a name="local-6989586621679821306"><a href="#local-6989586621679821306"><span class="hs-identifier">init_inst_ds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821307"><a href="#local-6989586621679821307"><span class="hs-identifier">rest_inst_ds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#getInsts"><span class="hs-identifier hs-var">getInsts</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679821305"><span class="hs-identifier hs-var">inst_ds_map</span></a><span>
</span><a name="line-1311"></a><span>
</span><a name="line-1312"></a><span>             </span><a name="local-6989586621679821308"><a href="#local-6989586621679821308"><span class="hs-identifier">first_group</span></a></a><span>
</span><a name="line-1313"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679821306"><span class="hs-identifier hs-var">init_inst_ds</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1314"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1315"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_roles</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1316"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821306"><span class="hs-identifier hs-var">init_inst_ds</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span>             </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679821309"><a href="#local-6989586621679821309"><span class="hs-identifier">final_inst_ds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821310"><a href="#local-6989586621679821310"><span class="hs-identifier">orphan_roles</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821311"><a href="#local-6989586621679821311"><span class="hs-identifier">groups</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1319"></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a><span> </span><a href="#local-6989586621679821286"><span class="hs-identifier hs-var">mk_group</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821307"><span class="hs-identifier hs-var">rest_inst_ds</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821304"><span class="hs-identifier hs-var">role_annot_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821303"><span class="hs-identifier hs-var">tycl_sccs</span></a><span>
</span><a name="line-1320"></a><span>
</span><a name="line-1321"></a><span>
</span><a name="line-1322"></a><span>             </span><a name="local-6989586621679821312"><a href="#local-6989586621679821312"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span class="hs-special">)</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span> </span><a href="#local-6989586621679821301"><span class="hs-identifier hs-var">tycls_w_fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1323"></a><span>                              </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span class="hs-special">)</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span> </span><a href="#local-6989586621679821299"><span class="hs-identifier hs-var">instds_w_fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1324"></a><span>
</span><a name="line-1325"></a><span>             </span><a name="local-6989586621679821313"><a href="#local-6989586621679821313"><span class="hs-identifier">all_groups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821308"><span class="hs-identifier hs-var">first_group</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679821311"><span class="hs-identifier hs-var">groups</span></a><span>
</span><a name="line-1326"></a><span>
</span><a name="line-1327"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">final_inst_ds</span><span class="hs-special">,</span><span>  </span><a href="#local-6989586621679821309"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">instds_w_fvs</span><span> </span><span class="hs-operator">$$</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">inst_ds_map</span><span>
</span><a name="line-1328"></a><span>                                       </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">flattenSCCs</span><span> </span><span class="hs-identifier">tycl_sccs</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">final_inst_ds</span><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-1329"></a><span>         </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="RnSource.html#orphanRoleAnnotErr"><span class="hs-identifier hs-var">orphanRoleAnnotErr</span></a><span> </span><span class="hs-special">(</span><a href="NameEnv.html#nameEnvElts"><span class="hs-identifier hs-var">nameEnvElts</span></a><span> </span><a href="#local-6989586621679821310"><span class="hs-identifier hs-var">orphan_roles</span></a><span class="hs-special">)</span><span>
</span><a name="line-1330"></a><span>
</span><a name="line-1331"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;rnTycl dependency analysis made groups&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821313"><span class="hs-identifier hs-var">all_groups</span></a><span class="hs-special">)</span><span>
</span><a name="line-1332"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821313"><span class="hs-identifier hs-var">all_groups</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821312"><span class="hs-identifier hs-var">all_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1333"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1334"></a><span>    </span><span class="hs-identifier">mk_group</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="RnSource.html#InstDeclFreeVarsMap"><span class="hs-identifier hs-type">InstDeclFreeVarsMap</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#RoleAnnotEnv"><span class="hs-identifier hs-type">RoleAnnotEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1335"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1336"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><a href="RnSource.html#InstDeclFreeVarsMap"><span class="hs-identifier hs-type">InstDeclFreeVarsMap</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#RoleAnnotEnv"><span class="hs-identifier hs-type">RoleAnnotEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1337"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1338"></a><span>    </span><a name="local-6989586621679821286"><a href="#local-6989586621679821286"><span class="hs-identifier">mk_group</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679821287"><a href="#local-6989586621679821287"><span class="hs-identifier">inst_map</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821288"><a href="#local-6989586621679821288"><span class="hs-identifier">role_env</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821289"><a href="#local-6989586621679821289"><span class="hs-identifier">scc</span></a></a><span>
</span><a name="line-1339"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679821293"><span class="hs-identifier hs-var">inst_map'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821295"><span class="hs-identifier hs-var">role_env'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821296"><span class="hs-identifier hs-var">group</span></a><span class="hs-special">)</span><span>
</span><a name="line-1340"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1341"></a><span>        </span><a name="local-6989586621679821290"><a href="#local-6989586621679821290"><span class="hs-identifier">tycl_ds</span></a></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#flattenSCC"><span class="hs-identifier hs-var">flattenSCC</span></a><span> </span><a href="#local-6989586621679821289"><span class="hs-identifier hs-var">scc</span></a><span>
</span><a name="line-1342"></a><span>        </span><a name="local-6989586621679821291"><a href="#local-6989586621679821291"><span class="hs-identifier">bndrs</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821290"><span class="hs-identifier hs-var">tycl_ds</span></a><span>
</span><a name="line-1343"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679821292"><a href="#local-6989586621679821292"><span class="hs-identifier">inst_ds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821293"><a href="#local-6989586621679821293"><span class="hs-identifier">inst_map'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#getInsts"><span class="hs-identifier hs-var">getInsts</span></a><span>      </span><a href="#local-6989586621679821291"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-6989586621679821287"><span class="hs-identifier hs-var">inst_map</span></a><span>
</span><a name="line-1344"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679821294"><a href="#local-6989586621679821294"><span class="hs-identifier">roles</span></a></a><span class="hs-special">,</span><span>   </span><a name="local-6989586621679821295"><a href="#local-6989586621679821295"><span class="hs-identifier">role_env'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#getRoleAnnots"><span class="hs-identifier hs-var">getRoleAnnots</span></a><span> </span><a href="#local-6989586621679821291"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-6989586621679821288"><span class="hs-identifier hs-var">role_env</span></a><span>
</span><a name="line-1345"></a><span>        </span><a name="local-6989586621679821296"><a href="#local-6989586621679821296"><span class="hs-identifier">group</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821290"><span class="hs-identifier hs-var">tycl_ds</span></a><span>
</span><a name="line-1346"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_roles</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821294"><span class="hs-identifier hs-var">roles</span></a><span>
</span><a name="line-1347"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821292"><span class="hs-identifier hs-var">inst_ds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1348"></a><span>
</span><a name="line-1349"></a><span>
</span><a name="line-1350"></a><span class="hs-identifier">depAnalTyClDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-1351"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1352"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1353"></a><span class="hs-comment">-- See Note [Dependency analysis of type, class, and instance decls]</span><span>
</span><a name="line-1354"></a><a name="depAnalTyClDecls"><a href="RnSource.html#depAnalTyClDecls"><span class="hs-identifier">depAnalTyClDecls</span></a></a><span> </span><a name="local-6989586621679821314"><a href="#local-6989586621679821314"><span class="hs-identifier">rdr_env</span></a></a><span> </span><a name="local-6989586621679821315"><a href="#local-6989586621679821315"><span class="hs-identifier">ds_w_fvs</span></a></a><span>
</span><a name="line-1355"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#stronglyConnCompFromEdgedVerticesUniq"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesUniq</span></a><span> </span><a href="#local-6989586621679821316"><span class="hs-identifier hs-var">edges</span></a><span>
</span><a name="line-1356"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1357"></a><span>    </span><span class="hs-identifier">edges</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span> </span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1358"></a><span>    </span><a name="local-6989586621679821316"><a href="#local-6989586621679821316"><span class="hs-identifier">edges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="Digraph.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a><span> </span><a href="#local-6989586621679821317"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821317"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#getParent"><span class="hs-identifier hs-var">getParent</span></a><span> </span><a href="#local-6989586621679821314"><span class="hs-identifier hs-var">rdr_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="UniqSet.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a><span> </span><a href="#local-6989586621679821318"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1359"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821317"><a href="#local-6989586621679821317"><span class="hs-identifier">d</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821318"><a href="#local-6989586621679821318"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821315"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1360"></a><span>            </span><span class="hs-comment">-- It's OK to use nonDetEltsUFM here as</span><span>
</span><a name="line-1361"></a><span>            </span><span class="hs-comment">-- stronglyConnCompFromEdgedVertices is still deterministic</span><span>
</span><a name="line-1362"></a><span>            </span><span class="hs-comment">-- even if the edges are in nondeterministic order as explained</span><span>
</span><a name="line-1363"></a><span>            </span><span class="hs-comment">-- in Note [Deterministic SCC] in Digraph.</span><span>
</span><a name="line-1364"></a><span>
</span><a name="line-1365"></a><span class="hs-identifier">toParents</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-1366"></a><a name="toParents"><a href="RnSource.html#toParents"><span class="hs-identifier">toParents</span></a></a><span> </span><a name="local-6989586621679821319"><a href="#local-6989586621679821319"><span class="hs-identifier">rdr_env</span></a></a><span> </span><a name="local-6989586621679821320"><a href="#local-6989586621679821320"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-1367"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#nonDetFoldUniqSet"><span class="hs-identifier hs-var">nonDetFoldUniqSet</span></a><span> </span><a href="#local-6989586621679821321"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span> </span><a href="#local-6989586621679821320"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-1368"></a><span>  </span><span class="hs-comment">-- It's OK to use nonDetFoldUFM because we immediately forget the</span><span>
</span><a name="line-1369"></a><span>  </span><span class="hs-comment">-- ordering by creating a set</span><span>
</span><a name="line-1370"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1371"></a><span>    </span><a name="local-6989586621679821321"><a href="#local-6989586621679821321"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621679821322"><a href="#local-6989586621679821322"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679821323"><a href="#local-6989586621679821323"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a><span> </span><a href="#local-6989586621679821323"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#getParent"><span class="hs-identifier hs-var">getParent</span></a><span> </span><a href="#local-6989586621679821319"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621679821322"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1372"></a><span>
</span><a name="line-1373"></a><span class="hs-identifier">getParent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-1374"></a><a name="getParent"><a href="RnSource.html#getParent"><span class="hs-identifier">getParent</span></a></a><span> </span><a name="local-6989586621679821324"><a href="#local-6989586621679821324"><span class="hs-identifier">rdr_env</span></a></a><span> </span><a name="local-6989586621679821325"><a href="#local-6989586621679821325"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-1375"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="RdrName.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a><span> </span><a href="#local-6989586621679821324"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621679821325"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1376"></a><span>      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679821326"><a href="#local-6989586621679821326"><span class="hs-identifier">gre</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">gre_par</span><span> </span><a href="#local-6989586621679821326"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1377"></a><span>                    </span><a href="RdrName.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">par_is</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821327"><a href="#local-6989586621679821327"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821327"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1378"></a><span>                    </span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">par_is</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821328"><a href="#local-6989586621679821328"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821328"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1379"></a><span>                    </span><span class="hs-identifier">_</span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821325"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1380"></a><span>      </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821325"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1381"></a><span>
</span><a name="line-1382"></a><span>
</span><a name="line-1383"></a><span class="hs-comment">{- Note [Extra dependencies from .hs-boot files]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This is a long story, so buckle in.

**Dependencies via hs-boot files are not obvious.** Consider the following case:

A.hs-boot
  module A where
    data A1

B.hs
  module B where
    import {-# SOURCE #-} A
    type B1 = A1

A.hs
  module A where
    import B
    data A2 = MkA2 B1
    data A1 = MkA1 A2

Here A2 is really recursive (via B1), but we won't see that easily when
doing dependency analysis when compiling A.hs.  When we look at A2,
we see that its free variables are simply B1, but without (recursively) digging
into the definition of B1 will we see that it actually refers to A1 via an
hs-boot file.

**Recursive declarations, even those broken by an hs-boot file, need to
be type-checked together.**  Whenever we refer to a declaration via
an hs-boot file, we must be careful not to force the TyThing too early:
ala Note [Tying the knot] if we force the TyThing before we have
defined it ourselves in the local type environment, GHC will error.

Conservatively, then, it would make sense that we to typecheck A1
and A2 from the previous example together, because the two types are
truly mutually recursive through B1.

If we are being clever, we might observe that while kind-checking
A2, we don't actually need to force the TyThing for A1: B1
independently records its kind, so there is no need to go &quot;deeper&quot;.
But then we are in an uncomfortable situation where we have
constructed a TyThing for A2 before we have checked A1, and we
have to be absolutely certain we don't force it too deeply until
we get around to kind checking A1, which could be for a very long
time.

Indeed, with datatype promotion, we may very well need to look
at the type of MkA2 before we have kind-checked A1: consider,

    data T = MkT (Proxy 'MkA2)

To promote MkA2, we need to lift its type to the kind level.
We never tested this, but it seems likely A1 would get poked
at this point.

**Here's what we do instead.**  So it is expedient for us to
make sure A1 and A2 are kind checked together in a loop.
To ensure that our dependency analysis can catch this,
we add a dependency:

  - from every local declaration
  - to everything that comes from this module's .hs-boot file
    (this is gotten from sb_tcs in the SelfBootInfo).

In this case, we'll add an edges

  - from A1 to A2 (but that edge is there already)
  - from A2 to A1 (which is new)

Well, not quite *every* declaration. Imagine module A
above had another datatype declaration:

  data A3 = A3 Int

Even though A3 has a dependency (on Int), all its dependencies are from things
that live on other packages. Since we don't have mutual dependencies across
packages, it is safe not to add the dependencies on the .hs-boot stuff to A2.

Hence function nameIsHomePackageImport.

Note that this is fairly conservative: it essentially implies that
EVERY type declaration in this modules hs-boot file will be kind-checked
together in one giant loop (and furthermore makes every other type
in the module depend on this loop).  This is perhaps less than ideal, because
the larger a recursive group, the less polymorphism available (we
cannot infer a type to be polymorphically instantiated while we
are inferring its kind), but no one has hollered about this (yet!)
-}</span><span>
</span><a name="line-1471"></a><span>
</span><a name="line-1472"></a><span class="hs-identifier">addBootDeps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1473"></a><span class="hs-comment">-- See Note [Extra dependencies from .hs-boot files]</span><span>
</span><a name="line-1474"></a><a name="addBootDeps"><a href="RnSource.html#addBootDeps"><span class="hs-identifier">addBootDeps</span></a></a><span> </span><a name="local-6989586621679821329"><a href="#local-6989586621679821329"><span class="hs-identifier">ds_w_fvs</span></a></a><span>
</span><a name="line-1475"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821330"><a href="#local-6989586621679821330"><span class="hs-identifier">tcg_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-1476"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821331"><a href="#local-6989586621679821331"><span class="hs-identifier">this_mod</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_mod</span><span> </span><a href="#local-6989586621679821330"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-1477"></a><span>             </span><a name="local-6989586621679821332"><a href="#local-6989586621679821332"><span class="hs-identifier">boot_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_self_boot</span><span> </span><a href="#local-6989586621679821330"><span class="hs-identifier hs-var">tcg_env</span></a><span>
</span><a name="line-1478"></a><span>
</span><a name="line-1479"></a><span>             </span><span class="hs-identifier">add_boot_deps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1480"></a><span>             </span><a name="local-6989586621679821333"><a href="#local-6989586621679821333"><span class="hs-identifier">add_boot_deps</span></a></a><span> </span><a name="local-6989586621679821336"><a href="#local-6989586621679821336"><span class="hs-identifier">ds_w_fvs</span></a></a><span>
</span><a name="line-1481"></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821332"><span class="hs-identifier hs-var">boot_info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1482"></a><span>                     </span><a href="TcRnTypes.html#SelfBoot"><span class="hs-identifier hs-var">SelfBoot</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sb_tcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821337"><a href="#local-6989586621679821337"><span class="hs-identifier">tcs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="NameSet.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a><span> </span><a href="#local-6989586621679821337"><span class="hs-identifier hs-var">tcs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1483"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821334"><span class="hs-identifier hs-var">add_one</span></a><span> </span><a href="#local-6989586621679821337"><span class="hs-identifier hs-var">tcs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821336"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span>
</span><a name="line-1484"></a><span>                     </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821336"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span>
</span><a name="line-1485"></a><span>
</span><a name="line-1486"></a><span>             </span><span class="hs-identifier">add_one</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1487"></a><span>             </span><a name="local-6989586621679821334"><a href="#local-6989586621679821334"><span class="hs-identifier">add_one</span></a></a><span> </span><a name="local-6989586621679821338"><a href="#local-6989586621679821338"><span class="hs-identifier">tcs</span></a></a><span> </span><a name="local-6989586621679821339"><a href="#local-6989586621679821339"><span class="hs-identifier">pr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679821340"><a href="#local-6989586621679821340"><span class="hs-identifier">decl</span></a></a><span class="hs-special">,</span><a name="local-6989586621679821341"><a href="#local-6989586621679821341"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1488"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821335"><span class="hs-identifier hs-var">has_local_imports</span></a><span> </span><a href="#local-6989586621679821341"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821340"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821341"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821338"><span class="hs-identifier hs-var">tcs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1489"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821339"><span class="hs-identifier hs-var">pr</span></a><span>
</span><a name="line-1490"></a><span>
</span><a name="line-1491"></a><span>             </span><a name="local-6989586621679821335"><a href="#local-6989586621679821335"><span class="hs-identifier">has_local_imports</span></a></a><span> </span><a name="local-6989586621679821342"><a href="#local-6989586621679821342"><span class="hs-identifier">fvs</span></a></a><span>
</span><a name="line-1492"></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#nameSetAny"><span class="hs-identifier hs-var">nameSetAny</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameIsHomePackageImport"><span class="hs-identifier hs-var">nameIsHomePackageImport</span></a><span> </span><a href="#local-6989586621679821331"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821342"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-1493"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821333"><span class="hs-identifier hs-var">add_boot_deps</span></a><span> </span><a href="#local-6989586621679821329"><span class="hs-identifier hs-var">ds_w_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1494"></a><span>
</span><a name="line-1495"></a><span>
</span><a name="line-1496"></a><span>
</span><a name="line-1497"></a><span class="hs-comment">{- ******************************************************
*                                                       *
       Role annotations
*                                                       *
****************************************************** -}</span><span>
</span><a name="line-1502"></a><span>
</span><a name="line-1503"></a><span class="hs-comment">-- | Renames role annotations, returning them as the values in a NameEnv</span><span>
</span><a name="line-1504"></a><span class="hs-comment">-- and checks for duplicate role annotations.</span><span>
</span><a name="line-1505"></a><span class="hs-comment">-- It is quite convenient to do both of these in the same place.</span><span>
</span><a name="line-1506"></a><span class="hs-comment">-- See also Note [Role annotations in the renamer]</span><span>
</span><a name="line-1507"></a><span class="hs-identifier">rnRoleAnnots</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-1508"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-1509"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1510"></a><a name="rnRoleAnnots"><a href="RnSource.html#rnRoleAnnots"><span class="hs-identifier">rnRoleAnnots</span></a></a><span> </span><a name="local-6989586621679821343"><a href="#local-6989586621679821343"><span class="hs-identifier">tc_names</span></a></a><span> </span><a name="local-6989586621679821344"><a href="#local-6989586621679821344"><span class="hs-identifier">role_annots</span></a></a><span>
</span><a name="line-1511"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- Check for duplicates *before* renaming, to avoid</span><span>
</span><a name="line-1512"></a><span>          </span><span class="hs-comment">-- lumping together all the unboundNames</span><span>
</span><a name="line-1513"></a><span>         </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821349"><a href="#local-6989586621679821349"><span class="hs-identifier">no_dups</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821350"><a href="#local-6989586621679821350"><span class="hs-identifier">dup_annots</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ListSetOps.html#removeDups"><span class="hs-identifier hs-var">removeDups</span></a><span> </span><a href="#local-6989586621679821351"><span class="hs-identifier hs-var">role_annots_cmp</span></a><span> </span><a href="#local-6989586621679821344"><span class="hs-identifier hs-var">role_annots</span></a><span>
</span><a name="line-1514"></a><span>             </span><a name="local-6989586621679821351"><a href="#local-6989586621679821351"><span class="hs-identifier">role_annots_cmp</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821352"><a href="#local-6989586621679821352"><span class="hs-identifier">annot1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821353"><a href="#local-6989586621679821353"><span class="hs-identifier">annot2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1515"></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#roleAnnotDeclName"><span class="hs-identifier hs-var">roleAnnotDeclName</span></a><span> </span><a href="#local-6989586621679821352"><span class="hs-identifier hs-var">annot1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="HsDecls.html#roleAnnotDeclName"><span class="hs-identifier hs-var">roleAnnotDeclName</span></a><span> </span><a href="#local-6989586621679821353"><span class="hs-identifier hs-var">annot2</span></a><span>
</span><a name="line-1516"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><a href="RnSource.html#dupRoleAnnotErr"><span class="hs-identifier hs-var">dupRoleAnnotErr</span></a><span> </span><a href="#local-6989586621679821350"><span class="hs-identifier hs-var">dup_annots</span></a><span>
</span><a name="line-1517"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="#local-6989586621679821345"><span class="hs-identifier hs-var">rn_role_annot1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821349"><span class="hs-identifier hs-var">no_dups</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1518"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1519"></a><span>    </span><a name="local-6989586621679821345"><a href="#local-6989586621679821345"><span class="hs-identifier">rn_role_annot1</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RoleAnnotDecl"><span class="hs-identifier hs-var">RoleAnnotDecl</span></a><span> </span><a name="local-6989586621679821346"><a href="#local-6989586621679821346"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-6989586621679821347"><a href="#local-6989586621679821347"><span class="hs-identifier">roles</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1520"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- the name is an *occurrence*, but look it up only in the</span><span>
</span><a name="line-1521"></a><span>              </span><span class="hs-comment">-- decls defined in this group (see #10263)</span><span>
</span><a name="line-1522"></a><span>             </span><a name="local-6989586621679821348"><a href="#local-6989586621679821348"><span class="hs-identifier">tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupSigCtxtOccRn"><span class="hs-identifier hs-var">lookupSigCtxtOccRn</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#RoleAnnotCtxt"><span class="hs-identifier hs-var">RoleAnnotCtxt</span></a><span> </span><a href="#local-6989586621679821343"><span class="hs-identifier hs-var">tc_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-1523"></a><span>                                          </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;role annotation&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1524"></a><span>                                          </span><a href="#local-6989586621679821346"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1525"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#RoleAnnotDecl"><span class="hs-identifier hs-var">RoleAnnotDecl</span></a><span> </span><a href="#local-6989586621679821348"><span class="hs-identifier hs-var">tycon'</span></a><span> </span><a href="#local-6989586621679821347"><span class="hs-identifier hs-var">roles</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1526"></a><span>
</span><a name="line-1527"></a><span class="hs-identifier">dupRoleAnnotErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1528"></a><a name="dupRoleAnnotErr"><a href="RnSource.html#dupRoleAnnotErr"><span class="hs-identifier">dupRoleAnnotErr</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;dupRoleAnnotErr&quot;</span><span>
</span><a name="line-1529"></a><span class="hs-identifier">dupRoleAnnotErr</span><span> </span><a name="local-6989586621679821354"><a href="#local-6989586621679821354"><span class="hs-identifier">list</span></a></a><span>
</span><a name="line-1530"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-6989586621679821356"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1531"></a><span>    </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Duplicate role annotations for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1532"></a><span>          </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#roleAnnotDeclName"><span class="hs-identifier hs-var">roleAnnotDeclName</span></a><span> </span><a href="#local-6989586621679821357"><span class="hs-identifier hs-var">first_decl</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">)</span><span>
</span><a name="line-1533"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679821358"><span class="hs-identifier hs-var">pp_role_annot</span></a><span> </span><a href="#local-6989586621679821355"><span class="hs-identifier hs-var">sorted_list</span></a><span class="hs-special">)</span><span>
</span><a name="line-1534"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1535"></a><span>      </span><a name="local-6989586621679821355"><a href="#local-6989586621679821355"><span class="hs-identifier">sorted_list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="#local-6989586621679821359"><span class="hs-identifier hs-var">cmp_annot</span></a><span> </span><a href="#local-6989586621679821354"><span class="hs-identifier hs-var">list</span></a><span>
</span><a name="line-1536"></a><span>      </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821356"><a href="#local-6989586621679821356"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821357"><a href="#local-6989586621679821357"><span class="hs-identifier">first_decl</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821355"><span class="hs-identifier hs-var">sorted_list</span></a><span>
</span><a name="line-1537"></a><span>
</span><a name="line-1538"></a><span>      </span><a name="local-6989586621679821358"><a href="#local-6989586621679821358"><span class="hs-identifier">pp_role_annot</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821360"><a href="#local-6989586621679821360"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821361"><a href="#local-6989586621679821361"><span class="hs-identifier">decl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821361"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1539"></a><span>                                      </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;-- written at&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821360"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1540"></a><span>
</span><a name="line-1541"></a><span>      </span><a name="local-6989586621679821359"><a href="#local-6989586621679821359"><span class="hs-identifier">cmp_annot</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821362"><a href="#local-6989586621679821362"><span class="hs-identifier">loc1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821363"><a href="#local-6989586621679821363"><span class="hs-identifier">loc2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821362"><span class="hs-identifier hs-var">loc1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821363"><span class="hs-identifier hs-var">loc2</span></a><span>
</span><a name="line-1542"></a><span>
</span><a name="line-1543"></a><span class="hs-identifier">orphanRoleAnnotErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1544"></a><a name="orphanRoleAnnotErr"><a href="RnSource.html#orphanRoleAnnotErr"><span class="hs-identifier">orphanRoleAnnotErr</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821364"><a href="#local-6989586621679821364"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821365"><a href="#local-6989586621679821365"><span class="hs-identifier">decl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1545"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-6989586621679821364"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1546"></a><span>    </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Role annotation for a type previously declared:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1547"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821365"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1548"></a><span>    </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The role annotation must be given where&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1549"></a><span>            </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsDecls.html#roleAnnotDeclName"><span class="hs-identifier hs-var">roleAnnotDeclName</span></a><span> </span><a href="#local-6989586621679821365"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1550"></a><span>            </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is declared.&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1551"></a><span>
</span><a name="line-1552"></a><span>
</span><a name="line-1553"></a><span class="hs-comment">{- Note [Role annotations in the renamer]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We must ensure that a type's role annotation is put in the same group as the
proper type declaration. This is because role annotations are needed during
type-checking when creating the type's TyCon. So, rnRoleAnnots builds a
NameEnv (LRoleAnnotDecl Name) that maps a name to a role annotation for that
type, if any. Then, this map can be used to add the role annotations to the
groups after dependency analysis.

This process checks for duplicate role annotations, where we must be careful
to do the check *before* renaming to avoid calling all unbound names duplicates
of one another.

The renaming process, as usual, might identify and report errors for unbound
names. We exclude the annotations for unbound names in the annotation
environment to avoid spurious errors for orphaned annotations.

We then (in rnTyClDecls) do a check for orphan role annotations (role
annotations without an accompanying type decl). The check works by folding
over components (of type [[Either (TyClDecl Name) (InstDecl Name)]]), selecting
out the relevant role declarations for each group, as well as diminishing the
annotation environment. After the fold is complete, anything left over in the
name environment must be an orphan, and errors are generated.

An earlier version of this algorithm short-cut the orphan check by renaming
only with names declared in this module. But, this check is insufficient in
the case of staged module compilation (Template Haskell, GHCi).
See #8485. With the new lookup process (which includes types declared in other
modules), we get better error messages, too.
-}</span><span>
</span><a name="line-1583"></a><span>
</span><a name="line-1584"></a><span>
</span><a name="line-1585"></a><span class="hs-comment">{- ******************************************************
*                                                       *
       Dependency info for instances
*                                                       *
****************************************************** -}</span><span>
</span><a name="line-1590"></a><span>
</span><a name="line-1591"></a><span class="hs-comment">----------------------------------------------------------</span><span>
</span><a name="line-1592"></a><span class="hs-comment">-- | 'InstDeclFreeVarsMap is an association of an</span><span>
</span><a name="line-1593"></a><span class="hs-comment">--   @InstDecl@ with @FreeVars@. The @FreeVars@ are</span><span>
</span><a name="line-1594"></a><span class="hs-comment">--   the tycon names that are both</span><span>
</span><a name="line-1595"></a><span class="hs-comment">--     a) free in the instance declaration</span><span>
</span><a name="line-1596"></a><span class="hs-comment">--     b) bound by this group of type/class/instance decls</span><span>
</span><a name="line-1597"></a><span class="hs-keyword">type</span><span> </span><a name="InstDeclFreeVarsMap"><a href="RnSource.html#InstDeclFreeVarsMap"><span class="hs-identifier">InstDeclFreeVarsMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsDecls.html#LInstDecl"><span class="hs-identifier hs-type">LInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1598"></a><span>
</span><a name="line-1599"></a><span class="hs-comment">-- | Construct an @InstDeclFreeVarsMap@ by eliminating any @Name@s from the</span><span>
</span><a name="line-1600"></a><span class="hs-comment">--   @FreeVars@ which are *not* the binders of a @TyClDecl@.</span><span>
</span><a name="line-1601"></a><span class="hs-identifier">mkInstDeclFreeVarsMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-1602"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-1603"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="HsDecls.html#LInstDecl"><span class="hs-identifier hs-type">LInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1604"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnSource.html#InstDeclFreeVarsMap"><span class="hs-identifier hs-type">InstDeclFreeVarsMap</span></a><span>
</span><a name="line-1605"></a><a name="mkInstDeclFreeVarsMap"><a href="RnSource.html#mkInstDeclFreeVarsMap"><span class="hs-identifier">mkInstDeclFreeVarsMap</span></a></a><span> </span><a name="local-6989586621679821366"><a href="#local-6989586621679821366"><span class="hs-identifier">rdr_env</span></a></a><span> </span><a name="local-6989586621679821367"><a href="#local-6989586621679821367"><span class="hs-identifier">tycl_bndrs</span></a></a><span> </span><a name="local-6989586621679821368"><a href="#local-6989586621679821368"><span class="hs-identifier">inst_ds_fvs</span></a></a><span>
</span><a name="line-1606"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821369"><span class="hs-identifier hs-var">inst_decl</span></a><span class="hs-special">,</span><span> </span><a href="RnSource.html#toParents"><span class="hs-identifier hs-var">toParents</span></a><span> </span><a href="#local-6989586621679821366"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621679821370"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#intersectFVs"><span class="hs-identifier hs-var">intersectFVs</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821367"><span class="hs-identifier hs-var">tycl_bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1607"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821369"><a href="#local-6989586621679821369"><span class="hs-identifier">inst_decl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821370"><a href="#local-6989586621679821370"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821368"><span class="hs-identifier hs-var">inst_ds_fvs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1608"></a><span>
</span><a name="line-1609"></a><span class="hs-comment">-- | Get the @LInstDecl@s which have empty @FreeVars@ sets, and the</span><span>
</span><a name="line-1610"></a><span class="hs-comment">--   @InstDeclFreeVarsMap@ with these entries removed.</span><span>
</span><a name="line-1611"></a><span class="hs-comment">-- We call (getInsts tcs instd_map) when we've completed the declarations</span><span>
</span><a name="line-1612"></a><span class="hs-comment">-- for 'tcs'.  The call returns (inst_decls, instd_map'), where</span><span>
</span><a name="line-1613"></a><span class="hs-comment">--   inst_decls are the instance declarations all of</span><span>
</span><a name="line-1614"></a><span class="hs-comment">--              whose free vars are now defined</span><span>
</span><a name="line-1615"></a><span class="hs-comment">--   instd_map' is the inst-decl map with 'tcs' removed from</span><span>
</span><a name="line-1616"></a><span class="hs-comment">--               the free-var set</span><span>
</span><a name="line-1617"></a><span class="hs-identifier">getInsts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnSource.html#InstDeclFreeVarsMap"><span class="hs-identifier hs-type">InstDeclFreeVarsMap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#LInstDecl"><span class="hs-identifier hs-type">LInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="RnSource.html#InstDeclFreeVarsMap"><span class="hs-identifier hs-type">InstDeclFreeVarsMap</span></a><span class="hs-special">)</span><span>
</span><a name="line-1618"></a><a name="getInsts"><a href="RnSource.html#getInsts"><span class="hs-identifier">getInsts</span></a></a><span> </span><a name="local-6989586621679821371"><a href="#local-6989586621679821371"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-6989586621679821372"><a href="#local-6989586621679821372"><span class="hs-identifier">inst_decl_map</span></a></a><span>
</span><a name="line-1619"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a><span> </span><a href="#local-6989586621679821373"><span class="hs-identifier hs-var">pick_me</span></a><span> </span><a href="#local-6989586621679821372"><span class="hs-identifier hs-var">inst_decl_map</span></a><span>
</span><a name="line-1620"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1621"></a><span>    </span><span class="hs-identifier">pick_me</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LInstDecl"><span class="hs-identifier hs-type">LInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1622"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LInstDecl"><span class="hs-identifier hs-type">LInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LInstDecl"><span class="hs-identifier hs-type">LInstDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1623"></a><span>    </span><a name="local-6989586621679821373"><a href="#local-6989586621679821373"><span class="hs-identifier">pick_me</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679821374"><a href="#local-6989586621679821374"><span class="hs-identifier">decl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821375"><a href="#local-6989586621679821375"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1624"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="NameSet.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a><span> </span><a href="#local-6989586621679821376"><span class="hs-identifier hs-var">depleted_fvs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a href="#local-6989586621679821374"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-1625"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821374"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821376"><span class="hs-identifier hs-var">depleted_fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1626"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1627"></a><span>        </span><a name="local-6989586621679821376"><a href="#local-6989586621679821376"><span class="hs-identifier">depleted_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#delFVs"><span class="hs-identifier hs-var">delFVs</span></a><span> </span><a href="#local-6989586621679821371"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-6989586621679821375"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-1628"></a><span>
</span><a name="line-1629"></a><span class="hs-comment">{- ******************************************************
*                                                       *
         Renaming a type or class declaration
*                                                       *
****************************************************** -}</span><span>
</span><a name="line-1634"></a><span>
</span><a name="line-1635"></a><span class="hs-identifier">rnTyClDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1636"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1637"></a><span>
</span><a name="line-1638"></a><span class="hs-comment">-- All flavours of type family declarations (&quot;type family&quot;, &quot;newtype family&quot;,</span><span>
</span><a name="line-1639"></a><span class="hs-comment">-- and &quot;data family&quot;), both top level and (for an associated type)</span><span>
</span><a name="line-1640"></a><span class="hs-comment">-- in a class decl</span><span>
</span><a name="line-1641"></a><a name="rnTyClDecl"><a href="RnSource.html#rnTyClDecl"><span class="hs-identifier">rnTyClDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamDecl"><span class="hs-identifier hs-var">FamDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdFam</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821377"><a href="#local-6989586621679821377"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1642"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821378"><a href="#local-6989586621679821378"><span class="hs-identifier">decl'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821379"><a href="#local-6989586621679821379"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnFamDecl"><span class="hs-identifier hs-var">rnFamDecl</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679821377"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-1643"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamDecl"><span class="hs-identifier hs-var">FamDecl</span></a><span> </span><a href="#local-6989586621679821378"><span class="hs-identifier hs-var">decl'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821379"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1644"></a><span>
</span><a name="line-1645"></a><span class="hs-identifier">rnTyClDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SynDecl"><span class="hs-identifier hs-var">SynDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821380"><a href="#local-6989586621679821380"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821381"><a href="#local-6989586621679821381"><span class="hs-identifier">tyvars</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1646"></a><span>                      </span><span class="hs-identifier">tcdFixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821382"><a href="#local-6989586621679821382"><span class="hs-identifier">fixity</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdRhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821383"><a href="#local-6989586621679821383"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1647"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821384"><a href="#local-6989586621679821384"><span class="hs-identifier">tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-6989586621679821380"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1648"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821385"><a href="#local-6989586621679821385"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#freeKiTyVarsKindVars"><span class="hs-identifier hs-var">freeKiTyVarsKindVars</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="RnTypes.html#extractHsTyRdrTyVars"><span class="hs-identifier hs-var">extractHsTyRdrTyVars</span></a><span> </span><a href="#local-6989586621679821383"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1649"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821386"><a href="#local-6989586621679821386"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#TySynCtx"><span class="hs-identifier hs-var">TySynCtx</span></a><span> </span><a href="#local-6989586621679821380"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1650"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;rntycl-ty&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821380"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821385"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1651"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679821390"><a href="#local-6989586621679821390"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821391"><a href="#local-6989586621679821391"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821392"><a href="#local-6989586621679821392"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-6989586621679821386"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679821385"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-6989586621679821381"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1652"></a><span>                                    </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821387"><a href="#local-6989586621679821387"><span class="hs-identifier">tyvars'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1653"></a><span>                                    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821388"><a href="#local-6989586621679821388"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821389"><a href="#local-6989586621679821389"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnTySyn"><span class="hs-identifier hs-var">rnTySyn</span></a><span> </span><a href="#local-6989586621679821386"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821383"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1654"></a><span>                                       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679821387"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821388"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821389"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1655"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SynDecl"><span class="hs-identifier hs-var">SynDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821384"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821390"><span class="hs-identifier hs-var">tyvars'</span></a><span>
</span><a name="line-1656"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821382"><span class="hs-identifier hs-var">fixity</span></a><span>
</span><a name="line-1657"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdRhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821391"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFVs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821392"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821392"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1658"></a><span>
</span><a name="line-1659"></a><span class="hs-comment">-- &quot;data&quot;, &quot;newtype&quot; declarations</span><span>
</span><a name="line-1660"></a><span class="hs-comment">-- both top level and (for an associated type) in an instance decl</span><span>
</span><a name="line-1661"></a><span class="hs-identifier">rnTyClDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataDecl"><span class="hs-identifier hs-var">DataDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821393"><a href="#local-6989586621679821393"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821394"><a href="#local-6989586621679821394"><span class="hs-identifier">tyvars</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1662"></a><span>                       </span><span class="hs-identifier">tcdFixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821395"><a href="#local-6989586621679821395"><span class="hs-identifier">fixity</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdDataDefn</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821396"><a href="#local-6989586621679821396"><span class="hs-identifier">defn</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1663"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821397"><a href="#local-6989586621679821397"><span class="hs-identifier">tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-6989586621679821393"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1664"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821398"><a href="#local-6989586621679821398"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#extractDataDefnKindVars"><span class="hs-identifier hs-var">extractDataDefnKindVars</span></a><span> </span><a href="#local-6989586621679821396"><span class="hs-identifier hs-var">defn</span></a><span>
</span><a name="line-1665"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821399"><a href="#local-6989586621679821399"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#TyDataCtx"><span class="hs-identifier hs-var">TyDataCtx</span></a><span> </span><a href="#local-6989586621679821393"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1666"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;rntycl-data&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821393"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821398"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1667"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679821407"><a href="#local-6989586621679821407"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821408"><a href="#local-6989586621679821408"><span class="hs-identifier">defn'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821409"><a href="#local-6989586621679821409"><span class="hs-identifier">no_kvs</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821410"><a href="#local-6989586621679821410"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1668"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-6989586621679821399"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679821398"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-6989586621679821394"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821400"><a href="#local-6989586621679821400"><span class="hs-identifier">tyvars'</span></a></a><span> </span><a name="local-6989586621679821401"><a href="#local-6989586621679821401"><span class="hs-identifier">dep_vars</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1669"></a><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679821402"><a href="#local-6989586621679821402"><span class="hs-identifier">defn'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821403"><a href="#local-6989586621679821403"><span class="hs-identifier">kind_sig_fvs</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821404"><a href="#local-6989586621679821404"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnDataDefn"><span class="hs-identifier hs-var">rnDataDefn</span></a><span> </span><a href="#local-6989586621679821399"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821396"><span class="hs-identifier hs-var">defn</span></a><span>
</span><a name="line-1670"></a><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821405"><a href="#local-6989586621679821405"><span class="hs-identifier">sig_tvs</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#filterNameSet"><span class="hs-identifier hs-var">filterNameSet</span></a><span> </span><a href="Name.html#isTyVarName"><span class="hs-identifier hs-var">isTyVarName</span></a><span> </span><a href="#local-6989586621679821403"><span class="hs-identifier hs-var">kind_sig_fvs</span></a><span>
</span><a name="line-1671"></a><span>                       </span><a name="local-6989586621679821406"><a href="#local-6989586621679821406"><span class="hs-identifier">unbound_sig_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821405"><span class="hs-identifier hs-var">sig_tvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#minusNameSet"><span class="hs-identifier hs-var">minusNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821401"><span class="hs-identifier hs-var">dep_vars</span></a><span>
</span><a name="line-1672"></a><span>                 </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679821400"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821402"><span class="hs-identifier hs-var">defn'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a><span> </span><a href="#local-6989586621679821406"><span class="hs-identifier hs-var">unbound_sig_tvs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821404"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1673"></a><span>          </span><span class="hs-comment">-- See Note [Complete user-supplied kind signatures] in HsDecls</span><span>
</span><a name="line-1674"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821411"><a href="#local-6989586621679821411"><span class="hs-identifier">typeintype</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#TypeInType"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TypeInType</span></a><span>
</span><a name="line-1675"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821412"><a href="#local-6989586621679821412"><span class="hs-identifier">cusk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#hsTvbAllKinded"><span class="hs-identifier hs-var">hsTvbAllKinded</span></a><span> </span><a href="#local-6989586621679821407"><span class="hs-identifier hs-var">tyvars'</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1676"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679821411"><span class="hs-identifier hs-var">typeintype</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679821409"><span class="hs-identifier hs-var">no_kvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1677"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataDecl"><span class="hs-identifier hs-var">DataDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821397"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821407"><span class="hs-identifier hs-var">tyvars'</span></a><span>
</span><a name="line-1678"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821395"><span class="hs-identifier hs-var">fixity</span></a><span>
</span><a name="line-1679"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdDataDefn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821408"><span class="hs-identifier hs-var">defn'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdDataCusk</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821412"><span class="hs-identifier hs-var">cusk</span></a><span>
</span><a name="line-1680"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFVs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821410"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821410"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1681"></a><span>
</span><a name="line-1682"></a><span class="hs-identifier">rnTyClDecl</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClassDecl"><span class="hs-identifier hs-var">ClassDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdCtxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821413"><a href="#local-6989586621679821413"><span class="hs-identifier">context</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821414"><a href="#local-6989586621679821414"><span class="hs-identifier">lcls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1683"></a><span>                        </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821415"><a href="#local-6989586621679821415"><span class="hs-identifier">tyvars</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821416"><a href="#local-6989586621679821416"><span class="hs-identifier">fixity</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1684"></a><span>                        </span><span class="hs-identifier">tcdFDs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821417"><a href="#local-6989586621679821417"><span class="hs-identifier">fds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdSigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821418"><a href="#local-6989586621679821418"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1685"></a><span>                        </span><span class="hs-identifier">tcdMeths</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821419"><a href="#local-6989586621679821419"><span class="hs-identifier">mbinds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdATs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821420"><a href="#local-6989586621679821420"><span class="hs-identifier">ats</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdATDefs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821421"><a href="#local-6989586621679821421"><span class="hs-identifier">at_defs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1686"></a><span>                        </span><span class="hs-identifier">tcdDocs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821422"><a href="#local-6989586621679821422"><span class="hs-identifier">docs</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1687"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821424"><a href="#local-6989586621679821424"><span class="hs-identifier">lcls'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-6989586621679821414"><span class="hs-identifier hs-var">lcls</span></a><span>
</span><a name="line-1688"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821425"><a href="#local-6989586621679821425"><span class="hs-identifier">cls'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821424"><span class="hs-identifier hs-var">lcls'</span></a><span>
</span><a name="line-1689"></a><span>              </span><a name="local-6989586621679821426"><a href="#local-6989586621679821426"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- No scoped kind vars except those in</span><span>
</span><a name="line-1690"></a><span>                        </span><span class="hs-comment">-- kind signatures on the tyvars</span><span>
</span><a name="line-1691"></a><span>
</span><a name="line-1692"></a><span>        </span><span class="hs-comment">-- Tyvars scope over superclass context and method signatures</span><span>
</span><a name="line-1693"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679821434"><a href="#local-6989586621679821434"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821435"><a href="#local-6989586621679821435"><span class="hs-identifier">context'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821436"><a href="#local-6989586621679821436"><span class="hs-identifier">fds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821437"><a href="#local-6989586621679821437"><span class="hs-identifier">ats'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821438"><a href="#local-6989586621679821438"><span class="hs-identifier">stuff_fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1694"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-6989586621679821423"><span class="hs-identifier hs-var">cls_doc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679821426"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-6989586621679821415"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821427"><a href="#local-6989586621679821427"><span class="hs-identifier">tyvars'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1695"></a><span>                  </span><span class="hs-comment">-- Checks for distinct tyvars</span><span>
</span><a name="line-1696"></a><span>             </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821428"><a href="#local-6989586621679821428"><span class="hs-identifier">context'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821429"><a href="#local-6989586621679821429"><span class="hs-identifier">cxt_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnContext"><span class="hs-identifier hs-var">rnContext</span></a><span> </span><a href="#local-6989586621679821423"><span class="hs-identifier hs-var">cls_doc</span></a><span> </span><a href="#local-6989586621679821413"><span class="hs-identifier hs-var">context</span></a><span>
</span><a name="line-1697"></a><span>             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821430"><a href="#local-6989586621679821430"><span class="hs-identifier">fds'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnFds"><span class="hs-identifier hs-var">rnFds</span></a><span> </span><a href="#local-6989586621679821417"><span class="hs-identifier hs-var">fds</span></a><span>
</span><a name="line-1698"></a><span>                         </span><span class="hs-comment">-- The fundeps have no free variables</span><span>
</span><a name="line-1699"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821431"><a href="#local-6989586621679821431"><span class="hs-identifier">ats'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821432"><a href="#local-6989586621679821432"><span class="hs-identifier">fv_ats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnATDecls"><span class="hs-identifier hs-var">rnATDecls</span></a><span> </span><a href="#local-6989586621679821425"><span class="hs-identifier hs-var">cls'</span></a><span> </span><a href="#local-6989586621679821420"><span class="hs-identifier hs-var">ats</span></a><span>
</span><a name="line-1700"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821433"><a href="#local-6989586621679821433"><span class="hs-identifier">fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821429"><span class="hs-identifier hs-var">cxt_fvs</span></a><span>     </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span>
</span><a name="line-1701"></a><span>                         </span><a href="#local-6989586621679821432"><span class="hs-identifier hs-var">fv_ats</span></a><span>
</span><a name="line-1702"></a><span>             </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679821427"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821428"><span class="hs-identifier hs-var">context'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821430"><span class="hs-identifier hs-var">fds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821431"><span class="hs-identifier hs-var">ats'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821433"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1703"></a><span>
</span><a name="line-1704"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821439"><a href="#local-6989586621679821439"><span class="hs-identifier">at_defs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821440"><a href="#local-6989586621679821440"><span class="hs-identifier">fv_at_defs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#rnTyFamDefltEqn"><span class="hs-identifier hs-var">rnTyFamDefltEqn</span></a><span> </span><a href="#local-6989586621679821425"><span class="hs-identifier hs-var">cls'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821421"><span class="hs-identifier hs-var">at_defs</span></a><span>
</span><a name="line-1705"></a><span>
</span><a name="line-1706"></a><span>        </span><span class="hs-comment">-- No need to check for duplicate associated type decls</span><span>
</span><a name="line-1707"></a><span>        </span><span class="hs-comment">-- since that is done by RnNames.extendGlobalRdrEnvRn</span><span>
</span><a name="line-1708"></a><span>
</span><a name="line-1709"></a><span>        </span><span class="hs-comment">-- Check the signatures</span><span>
</span><a name="line-1710"></a><span>        </span><span class="hs-comment">-- First process the class op sigs (op_sigs), then the fixity sigs (non_op_sigs).</span><span>
</span><a name="line-1711"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821441"><a href="#local-6989586621679821441"><span class="hs-identifier">sig_rdr_names_w_locs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679821443"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ClassOpSig"><span class="hs-identifier hs-var">ClassOpSig</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-6989586621679821442"><a href="#local-6989586621679821442"><span class="hs-identifier">ops</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821418"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-1712"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821443"><a href="#local-6989586621679821443"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821442"><span class="hs-identifier hs-var">ops</span></a><span class="hs-special">]</span><span>
</span><a name="line-1713"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span> </span><a href="#local-6989586621679821441"><span class="hs-identifier hs-var">sig_rdr_names_w_locs</span></a><span>
</span><a name="line-1714"></a><span>                </span><span class="hs-comment">-- Typechecker is responsible for checking that we only</span><span>
</span><a name="line-1715"></a><span>                </span><span class="hs-comment">-- give default-method bindings for things in this class.</span><span>
</span><a name="line-1716"></a><span>                </span><span class="hs-comment">-- The renamer *could* check this for class decls, but can't</span><span>
</span><a name="line-1717"></a><span>                </span><span class="hs-comment">-- for instance decls.</span><span>
</span><a name="line-1718"></a><span>
</span><a name="line-1719"></a><span>        </span><span class="hs-comment">-- The newLocals call is tiresome: given a generic class decl</span><span>
</span><a name="line-1720"></a><span>        </span><span class="hs-comment">--      class C a where</span><span>
</span><a name="line-1721"></a><span>        </span><span class="hs-comment">--        op :: a -&gt; a</span><span>
</span><a name="line-1722"></a><span>        </span><span class="hs-comment">--        op {| x+y |} (Inl a) = ...</span><span>
</span><a name="line-1723"></a><span>        </span><span class="hs-comment">--        op {| x+y |} (Inr b) = ...</span><span>
</span><a name="line-1724"></a><span>        </span><span class="hs-comment">--        op {| a*b |} (a*b)   = ...</span><span>
</span><a name="line-1725"></a><span>        </span><span class="hs-comment">-- we want to name both &quot;x&quot; tyvars with the same unique, so that they are</span><span>
</span><a name="line-1726"></a><span>        </span><span class="hs-comment">-- easy to group together in the typechecker.</span><span>
</span><a name="line-1727"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821444"><a href="#local-6989586621679821444"><span class="hs-identifier">mbinds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821445"><a href="#local-6989586621679821445"><span class="hs-identifier">sigs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821446"><a href="#local-6989586621679821446"><span class="hs-identifier">meth_fvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1728"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnMethodBinds"><span class="hs-identifier hs-var">rnMethodBinds</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679821425"><span class="hs-identifier hs-var">cls'</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsAllLTyVarNames"><span class="hs-identifier hs-var">hsAllLTyVarNames</span></a><span> </span><a href="#local-6989586621679821434"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821419"><span class="hs-identifier hs-var">mbinds</span></a><span> </span><a href="#local-6989586621679821418"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-1729"></a><span>                </span><span class="hs-comment">-- No need to check for duplicate method signatures</span><span>
</span><a name="line-1730"></a><span>                </span><span class="hs-comment">-- since that is done by RnNames.extendGlobalRdrEnvRn</span><span>
</span><a name="line-1731"></a><span>                </span><span class="hs-comment">-- and the methods are already in scope</span><span>
</span><a name="line-1732"></a><span>
</span><a name="line-1733"></a><span>  </span><span class="hs-comment">-- Haddock docs</span><span>
</span><a name="line-1734"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821447"><a href="#local-6989586621679821447"><span class="hs-identifier">docs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="RnSource.html#rnDocDecl"><span class="hs-identifier hs-var">rnDocDecl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821422"><span class="hs-identifier hs-var">docs</span></a><span>
</span><a name="line-1735"></a><span>
</span><a name="line-1736"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821448"><a href="#local-6989586621679821448"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821446"><span class="hs-identifier hs-var">meth_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821438"><span class="hs-identifier hs-var">stuff_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821440"><span class="hs-identifier hs-var">fv_at_defs</span></a><span>
</span><a name="line-1737"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClassDecl"><span class="hs-identifier hs-var">ClassDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcdCtxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821435"><span class="hs-identifier hs-var">context'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821424"><span class="hs-identifier hs-var">lcls'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1738"></a><span>                              </span><span class="hs-identifier">tcdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821434"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821416"><span class="hs-identifier hs-var">fixity</span></a><span class="hs-special">,</span><span>
</span><a name="line-1739"></a><span>                              </span><span class="hs-identifier">tcdFDs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821436"><span class="hs-identifier hs-var">fds'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdSigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821445"><span class="hs-identifier hs-var">sigs'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1740"></a><span>                              </span><span class="hs-identifier">tcdMeths</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821444"><span class="hs-identifier hs-var">mbinds'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdATs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821437"><span class="hs-identifier hs-var">ats'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdATDefs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821439"><span class="hs-identifier hs-var">at_defs'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1741"></a><span>                              </span><span class="hs-identifier">tcdDocs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821447"><span class="hs-identifier hs-var">docs'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcdFVs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821448"><span class="hs-identifier hs-var">all_fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-1742"></a><span>                  </span><a href="#local-6989586621679821448"><span class="hs-identifier hs-var">all_fvs</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1743"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1744"></a><span>    </span><a name="local-6989586621679821423"><a href="#local-6989586621679821423"><span class="hs-identifier">cls_doc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#ClassDeclCtx"><span class="hs-identifier hs-var">ClassDeclCtx</span></a><span> </span><a href="#local-6989586621679821414"><span class="hs-identifier hs-var">lcls</span></a><span>
</span><a name="line-1745"></a><span>
</span><a name="line-1746"></a><span class="hs-comment">-- &quot;type&quot; and &quot;type instance&quot; declarations</span><span>
</span><a name="line-1747"></a><span class="hs-identifier">rnTySyn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1748"></a><a name="rnTySyn"><a href="RnSource.html#rnTySyn"><span class="hs-identifier">rnTySyn</span></a></a><span> </span><a name="local-6989586621679821449"><a href="#local-6989586621679821449"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621679821450"><a href="#local-6989586621679821450"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-6989586621679821449"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821450"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1749"></a><span>
</span><a name="line-1750"></a><span class="hs-identifier">rnDataDefn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1751"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="HsDecls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1752"></a><span>                </span><span class="hs-comment">-- the NameSet includes all Names free in the kind signature</span><span>
</span><a name="line-1753"></a><span>                </span><span class="hs-comment">-- See Note [Complete user-supplied kind signatures]</span><span>
</span><a name="line-1754"></a><a name="rnDataDefn"><a href="RnSource.html#rnDataDefn"><span class="hs-identifier">rnDataDefn</span></a></a><span> </span><a name="local-6989586621679821451"><a href="#local-6989586621679821451"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsDataDefn"><span class="hs-identifier hs-var">HsDataDefn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dd_ND</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821452"><a href="#local-6989586621679821452"><span class="hs-identifier">new_or_data</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_cType</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821453"><a href="#local-6989586621679821453"><span class="hs-identifier">cType</span></a></a><span>
</span><a name="line-1755"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821454"><a href="#local-6989586621679821454"><span class="hs-identifier">context</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821455"><a href="#local-6989586621679821455"><span class="hs-identifier">condecls</span></a></a><span>
</span><a name="line-1756"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_kindSig</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821456"><a href="#local-6989586621679821456"><span class="hs-identifier">m_sig</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_derivs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821457"><a href="#local-6989586621679821457"><span class="hs-identifier">derivs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1757"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821458"><span class="hs-identifier hs-var">h98_style</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821454"><span class="hs-identifier hs-var">context</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1758"></a><span>                  </span><span class="hs-special">(</span><a href="RnSource.html#badGadtStupidTheta"><span class="hs-identifier hs-var">badGadtStupidTheta</span></a><span> </span><a href="#local-6989586621679821451"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1759"></a><span>
</span><a name="line-1760"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821466"><a href="#local-6989586621679821466"><span class="hs-identifier">m_sig'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821467"><a href="#local-6989586621679821467"><span class="hs-identifier">sig_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821456"><span class="hs-identifier hs-var">m_sig</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1761"></a><span>             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679821465"><a href="#local-6989586621679821465"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Arrow.html#first"><span class="hs-identifier hs-var">first</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="RnTypes.html#rnLHsKind"><span class="hs-identifier hs-var">rnLHsKind</span></a><span> </span><a href="#local-6989586621679821451"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821465"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1762"></a><span>             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1763"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821468"><a href="#local-6989586621679821468"><span class="hs-identifier">context'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821469"><a href="#local-6989586621679821469"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnContext"><span class="hs-identifier hs-var">rnContext</span></a><span> </span><a href="#local-6989586621679821451"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821454"><span class="hs-identifier hs-var">context</span></a><span>
</span><a name="line-1764"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821470"><a href="#local-6989586621679821470"><span class="hs-identifier">derivs'</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621679821471"><a href="#local-6989586621679821471"><span class="hs-identifier">fvs3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821459"><span class="hs-identifier hs-var">rn_derivs</span></a><span> </span><a href="#local-6989586621679821457"><span class="hs-identifier hs-var">derivs</span></a><span>
</span><a name="line-1765"></a><span>
</span><a name="line-1766"></a><span>        </span><span class="hs-comment">-- For the constructor declarations, drop the LocalRdrEnv</span><span>
</span><a name="line-1767"></a><span>        </span><span class="hs-comment">-- in the GADT case, where the type variables in the declaration</span><span>
</span><a name="line-1768"></a><span>        </span><span class="hs-comment">-- do not scope over the constructor signatures</span><span>
</span><a name="line-1769"></a><span>        </span><span class="hs-comment">-- data T a where { T1 :: forall b. b-&gt; b }</span><span>
</span><a name="line-1770"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821472"><a href="#local-6989586621679821472"><span class="hs-identifier">zap_lcl_env</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679821458"><span class="hs-identifier hs-var">h98_style</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821473"><a href="#local-6989586621679821473"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679821473"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1771"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setLocalRdrEnv"><span class="hs-identifier hs-var">setLocalRdrEnv</span></a><span> </span><a href="RdrName.html#emptyLocalRdrEnv"><span class="hs-identifier hs-var">emptyLocalRdrEnv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1772"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821474"><a href="#local-6989586621679821474"><span class="hs-identifier">condecls'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821475"><a href="#local-6989586621679821475"><span class="hs-identifier">con_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821472"><span class="hs-identifier hs-var">zap_lcl_env</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="RnSource.html#rnConDecls"><span class="hs-identifier hs-var">rnConDecls</span></a><span> </span><a href="#local-6989586621679821455"><span class="hs-identifier hs-var">condecls</span></a><span>
</span><a name="line-1773"></a><span>           </span><span class="hs-comment">-- No need to check for duplicate constructor decls</span><span>
</span><a name="line-1774"></a><span>           </span><span class="hs-comment">-- since that is done by RnNames.extendGlobalRdrEnvRn</span><span>
</span><a name="line-1775"></a><span>
</span><a name="line-1776"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821476"><a href="#local-6989586621679821476"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821469"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821471"><span class="hs-identifier hs-var">fvs3</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span>
</span><a name="line-1777"></a><span>                        </span><a href="#local-6989586621679821475"><span class="hs-identifier hs-var">con_fvs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821467"><span class="hs-identifier hs-var">sig_fvs</span></a><span>
</span><a name="line-1778"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span> </span><a href="HsDecls.html#HsDataDefn"><span class="hs-identifier hs-var">HsDataDefn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dd_ND</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821452"><span class="hs-identifier hs-var">new_or_data</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_cType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821453"><span class="hs-identifier hs-var">cType</span></a><span>
</span><a name="line-1779"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821468"><span class="hs-identifier hs-var">context'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_kindSig</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821466"><span class="hs-identifier hs-var">m_sig'</span></a><span>
</span><a name="line-1780"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821474"><span class="hs-identifier hs-var">condecls'</span></a><span>
</span><a name="line-1781"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_derivs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821470"><span class="hs-identifier hs-var">derivs'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1782"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821467"><span class="hs-identifier hs-var">sig_fvs</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1783"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821476"><span class="hs-identifier hs-var">all_fvs</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1784"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-1785"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1786"></a><span>    </span><a name="local-6989586621679821458"><a href="#local-6989586621679821458"><span class="hs-identifier">h98_style</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821455"><span class="hs-identifier hs-var">condecls</span></a><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- Note [Stupid theta]</span><span>
</span><a name="line-1787"></a><span>                     </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ConDeclGADT"><span class="hs-identifier hs-var">ConDeclGADT</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1788"></a><span>                     </span><span class="hs-identifier">_</span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1789"></a><span>
</span><a name="line-1790"></a><span>    </span><a name="local-6989586621679821459"><a href="#local-6989586621679821459"><span class="hs-identifier">rn_derivs</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821460"><a href="#local-6989586621679821460"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621679821461"><a href="#local-6989586621679821461"><span class="hs-identifier">ds</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1791"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821462"><a href="#local-6989586621679821462"><span class="hs-identifier">deriv_strats_ok</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#DerivingStrategies"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">DerivingStrategies</span></a><span>
</span><a name="line-1792"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#failIfTc"><span class="hs-identifier hs-var">failIfTc</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">lengthExceeds</span></a><span> </span><a href="#local-6989586621679821461"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679821462"><span class="hs-identifier hs-var">deriv_strats_ok</span></a><span class="hs-special">)</span><span>
</span><a name="line-1793"></a><span>               </span><a href="RnSource.html#multipleDerivClausesErr"><span class="hs-identifier hs-var">multipleDerivClausesErr</span></a><span>
</span><a name="line-1794"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821463"><a href="#local-6989586621679821463"><span class="hs-identifier">ds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821464"><a href="#local-6989586621679821464"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#rnLHsDerivingClause"><span class="hs-identifier hs-var">rnLHsDerivingClause</span></a><span> </span><a href="#local-6989586621679821462"><span class="hs-identifier hs-var">deriv_strats_ok</span></a><span> </span><a href="#local-6989586621679821451"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821461"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1795"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821460"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679821463"><span class="hs-identifier hs-var">ds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821464"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1796"></a><span>
</span><a name="line-1797"></a><span class="hs-identifier">rnLHsDerivingClause</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#LHsDerivingClause"><span class="hs-identifier hs-type">LHsDerivingClause</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1798"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LHsDerivingClause"><span class="hs-identifier hs-type">LHsDerivingClause</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1799"></a><a name="rnLHsDerivingClause"><a href="RnSource.html#rnLHsDerivingClause"><span class="hs-identifier">rnLHsDerivingClause</span></a></a><span> </span><a name="local-6989586621679821477"><a href="#local-6989586621679821477"><span class="hs-identifier">deriv_strats_ok</span></a></a><span> </span><a name="local-6989586621679821478"><a href="#local-6989586621679821478"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-1800"></a><span>                </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821479"><a href="#local-6989586621679821479"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsDerivingClause"><span class="hs-identifier hs-var">HsDerivingClause</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">deriv_clause_strategy</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821480"><a href="#local-6989586621679821480"><span class="hs-identifier">dcs</span></a></a><span>
</span><a name="line-1801"></a><span>                                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">deriv_clause_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821481"><a href="#local-6989586621679821481"><span class="hs-identifier">loc'</span></a></a><span> </span><a name="local-6989586621679821482"><a href="#local-6989586621679821482"><span class="hs-identifier">dct</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1802"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#failIfTc"><span class="hs-identifier hs-var">failIfTc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><a href="#local-6989586621679821480"><span class="hs-identifier hs-var">dcs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679821477"><span class="hs-identifier hs-var">deriv_strats_ok</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1803"></a><span>           </span><a href="RnSource.html#illegalDerivStrategyErr"><span class="hs-identifier hs-var">illegalDerivStrategyErr</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821480"><span class="hs-identifier hs-var">dcs</span></a><span>
</span><a name="line-1804"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821483"><a href="#local-6989586621679821483"><span class="hs-identifier">dct'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821484"><a href="#local-6989586621679821484"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><a href="#local-6989586621679821478"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821482"><span class="hs-identifier hs-var">dct</span></a><span>
</span><a name="line-1805"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821479"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsDerivingClause"><span class="hs-identifier hs-var">HsDerivingClause</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">deriv_clause_strategy</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821480"><span class="hs-identifier hs-var">dcs</span></a><span>
</span><a name="line-1806"></a><span>                                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">deriv_clause_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821481"><span class="hs-identifier hs-var">loc'</span></a><span> </span><a href="#local-6989586621679821483"><span class="hs-identifier hs-var">dct'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1807"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821484"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1808"></a><span>
</span><a name="line-1809"></a><span class="hs-identifier">badGadtStupidTheta</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1810"></a><a name="badGadtStupidTheta"><a href="RnSource.html#badGadtStupidTheta"><span class="hs-identifier">badGadtStupidTheta</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1811"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;No context is allowed on a GADT-style data declaration&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1812"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(You can put a context on each constructor, though.)&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1813"></a><span>
</span><a name="line-1814"></a><span class="hs-identifier">illegalDerivStrategyErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1815"></a><a name="illegalDerivStrategyErr"><a href="RnSource.html#illegalDerivStrategyErr"><span class="hs-identifier">illegalDerivStrategyErr</span></a></a><span> </span><a name="local-6989586621679821485"><a href="#local-6989586621679821485"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-1816"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal deriving strategy&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821485"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1817"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Use DerivingStrategies to enable this extension&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1818"></a><span>
</span><a name="line-1819"></a><span class="hs-identifier">multipleDerivClausesErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1820"></a><a name="multipleDerivClausesErr"><a href="RnSource.html#multipleDerivClausesErr"><span class="hs-identifier">multipleDerivClausesErr</span></a></a><span>
</span><a name="line-1821"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Illegal use of multiple, consecutive deriving clauses&quot;</span><span>
</span><a name="line-1822"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Use DerivingStrategies to allow this&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1823"></a><span>
</span><a name="line-1824"></a><span class="hs-identifier">rnFamDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-comment">-- Just cls =&gt; this FamilyDecl is nested</span><span>
</span><a name="line-1825"></a><span>                        </span><span class="hs-comment">--             inside an *class decl* for cls</span><span>
</span><a name="line-1826"></a><span>                        </span><span class="hs-comment">--             used for associated types</span><span>
</span><a name="line-1827"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1828"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1829"></a><a name="rnFamDecl"><a href="RnSource.html#rnFamDecl"><span class="hs-identifier">rnFamDecl</span></a></a><span> </span><a name="local-6989586621679821486"><a href="#local-6989586621679821486"><span class="hs-identifier">mb_cls</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamilyDecl"><span class="hs-identifier hs-var">FamilyDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821487"><a href="#local-6989586621679821487"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821488"><a href="#local-6989586621679821488"><span class="hs-identifier">tyvars</span></a></a><span>
</span><a name="line-1830"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdFixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821489"><a href="#local-6989586621679821489"><span class="hs-identifier">fixity</span></a></a><span>
</span><a name="line-1831"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821490"><a href="#local-6989586621679821490"><span class="hs-identifier">info</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdResultSig</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821491"><a href="#local-6989586621679821491"><span class="hs-identifier">res_sig</span></a></a><span>
</span><a name="line-1832"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdInjectivityAnn</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821492"><a href="#local-6989586621679821492"><span class="hs-identifier">injectivity</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1833"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821498"><a href="#local-6989586621679821498"><span class="hs-identifier">tycon'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-6989586621679821487"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1834"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821499"><a href="#local-6989586621679821499"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#extractRdrKindSigVars"><span class="hs-identifier hs-var">extractRdrKindSigVars</span></a><span> </span><a href="#local-6989586621679821491"><span class="hs-identifier hs-var">res_sig</span></a><span>
</span><a name="line-1835"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679821506"><a href="#local-6989586621679821506"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821507"><a href="#local-6989586621679821507"><span class="hs-identifier">res_sig'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821508"><a href="#local-6989586621679821508"><span class="hs-identifier">injectivity'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821509"><a href="#local-6989586621679821509"><span class="hs-identifier">fv1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-1836"></a><span>            </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-6989586621679821493"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679821486"><span class="hs-identifier hs-var">mb_cls</span></a><span> </span><a href="#local-6989586621679821499"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-6989586621679821488"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1837"></a><span>            </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679821500"><a href="#local-6989586621679821500"><span class="hs-identifier">tyvars'</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsTypes.html#HsQTvs"><span class="hs-identifier hs-var">HsQTvs</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsq_implicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821501"><a href="#local-6989586621679821501"><span class="hs-identifier">rn_kvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1838"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821502"><a href="#local-6989586621679821502"><span class="hs-identifier">rn_sig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#rnFamResultSig"><span class="hs-identifier hs-var">rnFamResultSig</span></a><span> </span><a href="#local-6989586621679821493"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821501"><span class="hs-identifier hs-var">rn_kvs</span></a><span>
</span><a name="line-1839"></a><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821503"><a href="#local-6989586621679821503"><span class="hs-identifier">res_sig'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821504"><a href="#local-6989586621679821504"><span class="hs-identifier">fv_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><a href="#local-6989586621679821502"><span class="hs-identifier hs-var">rn_sig</span></a><span> </span><a href="#local-6989586621679821491"><span class="hs-identifier hs-var">res_sig</span></a><span>
</span><a name="line-1840"></a><span>               </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821505"><a href="#local-6989586621679821505"><span class="hs-identifier">injectivity'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#rnInjectivityAnn"><span class="hs-identifier hs-var">rnInjectivityAnn</span></a><span> </span><a href="#local-6989586621679821500"><span class="hs-identifier hs-var">tyvars'</span></a><span> </span><a href="#local-6989586621679821503"><span class="hs-identifier hs-var">res_sig'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1841"></a><span>                                          </span><a href="#local-6989586621679821492"><span class="hs-identifier hs-var">injectivity</span></a><span>
</span><a name="line-1842"></a><span>               </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821500"><span class="hs-identifier hs-var">tyvars'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821503"><span class="hs-identifier hs-var">res_sig'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821505"><span class="hs-identifier hs-var">injectivity'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821504"><span class="hs-identifier hs-var">fv_kind</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1843"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821510"><a href="#local-6989586621679821510"><span class="hs-identifier">info'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821511"><a href="#local-6989586621679821511"><span class="hs-identifier">fv2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821494"><span class="hs-identifier hs-var">rn_info</span></a><span> </span><a href="#local-6989586621679821490"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1844"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamilyDecl"><span class="hs-identifier hs-var">FamilyDecl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fdLName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821498"><span class="hs-identifier hs-var">tycon'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821506"><span class="hs-identifier hs-var">tyvars'</span></a><span>
</span><a name="line-1845"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdFixity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821489"><span class="hs-identifier hs-var">fixity</span></a><span>
</span><a name="line-1846"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821510"><span class="hs-identifier hs-var">info'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdResultSig</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821507"><span class="hs-identifier hs-var">res_sig'</span></a><span>
</span><a name="line-1847"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fdInjectivityAnn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821508"><span class="hs-identifier hs-var">injectivity'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1848"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821509"><span class="hs-identifier hs-var">fv1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821511"><span class="hs-identifier hs-var">fv2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1849"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1850"></a><span>     </span><a name="local-6989586621679821493"><a href="#local-6989586621679821493"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#TyFamilyCtx"><span class="hs-identifier hs-var">TyFamilyCtx</span></a><span> </span><a href="#local-6989586621679821487"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1851"></a><span>
</span><a name="line-1852"></a><span>     </span><span class="hs-comment">----------------------</span><span>
</span><a name="line-1853"></a><span>     </span><a name="local-6989586621679821494"><a href="#local-6989586621679821494"><span class="hs-identifier">rn_info</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClosedTypeFamily"><span class="hs-identifier hs-var">ClosedTypeFamily</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679821495"><a href="#local-6989586621679821495"><span class="hs-identifier">eqns</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1854"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821496"><a href="#local-6989586621679821496"><span class="hs-identifier">eqns'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821497"><a href="#local-6989586621679821497"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnList"><span class="hs-identifier hs-var">rnList</span></a><span> </span><span class="hs-special">(</span><a href="RnSource.html#rnTyFamInstEqn"><span class="hs-identifier hs-var">rnTyFamInstEqn</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821495"><span class="hs-identifier hs-var">eqns</span></a><span>
</span><a name="line-1855"></a><span>                                                    </span><span class="hs-comment">-- no class context,</span><span>
</span><a name="line-1856"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClosedTypeFamily"><span class="hs-identifier hs-var">ClosedTypeFamily</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679821496"><span class="hs-identifier hs-var">eqns'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821497"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1857"></a><span>     </span><span class="hs-identifier">rn_info</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClosedTypeFamily"><span class="hs-identifier hs-var">ClosedTypeFamily</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1858"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ClosedTypeFamily"><span class="hs-identifier hs-var">ClosedTypeFamily</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1859"></a><span>     </span><span class="hs-identifier">rn_info</span><span> </span><a href="HsDecls.html#OpenTypeFamily"><span class="hs-identifier hs-var">OpenTypeFamily</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#OpenTypeFamily"><span class="hs-identifier hs-var">OpenTypeFamily</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1860"></a><span>     </span><span class="hs-identifier">rn_info</span><span> </span><a href="HsDecls.html#DataFamily"><span class="hs-identifier hs-var">DataFamily</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DataFamily"><span class="hs-identifier hs-var">DataFamily</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1861"></a><span>
</span><a name="line-1862"></a><span class="hs-identifier">rnFamResultSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span>
</span><a name="line-1863"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- kind variables already in scope</span><span>
</span><a name="line-1864"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#FamilyResultSig"><span class="hs-identifier hs-type">FamilyResultSig</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-1865"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#FamilyResultSig"><span class="hs-identifier hs-type">FamilyResultSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1866"></a><a name="rnFamResultSig"><a href="RnSource.html#rnFamResultSig"><span class="hs-identifier">rnFamResultSig</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="HsDecls.html#NoSig"><span class="hs-identifier hs-var">NoSig</span></a><span>
</span><a name="line-1867"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#NoSig"><span class="hs-identifier hs-var">NoSig</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1868"></a><span class="hs-identifier">rnFamResultSig</span><span> </span><a name="local-6989586621679821512"><a href="#local-6989586621679821512"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#KindSig"><span class="hs-identifier hs-var">KindSig</span></a><span> </span><a name="local-6989586621679821513"><a href="#local-6989586621679821513"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1869"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821514"><a href="#local-6989586621679821514"><span class="hs-identifier">rndKind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821515"><a href="#local-6989586621679821515"><span class="hs-identifier">ftvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsKind"><span class="hs-identifier hs-var">rnLHsKind</span></a><span> </span><a href="#local-6989586621679821512"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821513"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1870"></a><span>        </span><span class="hs-special">;</span><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#KindSig"><span class="hs-identifier hs-var">KindSig</span></a><span> </span><a href="#local-6989586621679821514"><span class="hs-identifier hs-var">rndKind</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821515"><span class="hs-identifier hs-var">ftvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1871"></a><span class="hs-identifier">rnFamResultSig</span><span> </span><a name="local-6989586621679821516"><a href="#local-6989586621679821516"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621679821517"><a href="#local-6989586621679821517"><span class="hs-identifier">kv_names</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyVarSig"><span class="hs-identifier hs-var">TyVarSig</span></a><span> </span><a name="local-6989586621679821518"><a href="#local-6989586621679821518"><span class="hs-identifier">tvbndr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1872"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- `TyVarSig` tells us that user named the result of a type family by</span><span>
</span><a name="line-1873"></a><span>          </span><span class="hs-comment">-- writing `= tyvar` or `= (tyvar :: kind)`. In such case we want to</span><span>
</span><a name="line-1874"></a><span>          </span><span class="hs-comment">-- be sure that the supplied result name is not identical to an</span><span>
</span><a name="line-1875"></a><span>          </span><span class="hs-comment">-- already in-scope type variable from an enclosing class.</span><span>
</span><a name="line-1876"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-1877"></a><span>          </span><span class="hs-comment">--  Example of disallowed declaration:</span><span>
</span><a name="line-1878"></a><span>          </span><span class="hs-comment">--         class C a b where</span><span>
</span><a name="line-1879"></a><span>          </span><span class="hs-comment">--            type F b = a | a -&gt; b</span><span>
</span><a name="line-1880"></a><span>          </span><a name="local-6989586621679821519"><a href="#local-6989586621679821519"><span class="hs-identifier">rdr_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a><span>
</span><a name="line-1881"></a><span>       </span><span class="hs-special">;</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821520"><a href="#local-6989586621679821520"><span class="hs-identifier">resName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a><span> </span><a href="#local-6989586621679821518"><span class="hs-identifier hs-var">tvbndr</span></a><span>
</span><a name="line-1882"></a><span>       </span><span class="hs-special">;</span><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821520"><span class="hs-identifier hs-var">resName</span></a><span> </span><span class="hs-special">`</span><a href="RdrName.html#elemLocalRdrEnv"><span class="hs-identifier hs-var">elemLocalRdrEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821519"><span class="hs-identifier hs-var">rdr_env</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1883"></a><span>          </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><a href="#local-6989586621679821518"><span class="hs-identifier hs-var">tvbndr</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1884"></a><span>                     </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type variable&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821520"><span class="hs-identifier hs-var">resName</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-1885"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;naming a type family result,&quot;</span><span>
</span><a name="line-1886"></a><span>                           </span><span class="hs-special">]</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1887"></a><span>                      </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;shadows an already bound type variable&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1888"></a><span>
</span><a name="line-1889"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#bindLHsTyVarBndr"><span class="hs-identifier hs-var">bindLHsTyVarBndr</span></a><span> </span><a href="#local-6989586621679821516"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-comment">-- this might be a lie, but it's used for</span><span>
</span><a name="line-1890"></a><span>                                      </span><span class="hs-comment">-- scoping checks that are irrelevant here</span><span>
</span><a name="line-1891"></a><span>                          </span><span class="hs-special">(</span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-6989586621679821517"><span class="hs-identifier hs-var">kv_names</span></a><span class="hs-special">)</span><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span>
</span><a name="line-1892"></a><span>                                       </span><span class="hs-comment">-- use of emptyNameSet here avoids</span><span>
</span><a name="line-1893"></a><span>                                       </span><span class="hs-comment">-- redundant duplicate errors</span><span>
</span><a name="line-1894"></a><span>                          </span><a href="#local-6989586621679821518"><span class="hs-identifier hs-var">tvbndr</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821521"><a href="#local-6989586621679821521"><span class="hs-identifier">tvbndr'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1895"></a><span>         </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyVarSig"><span class="hs-identifier hs-var">TyVarSig</span></a><span> </span><a href="#local-6989586621679821521"><span class="hs-identifier hs-var">tvbndr'</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a><span> </span><a href="#local-6989586621679821521"><span class="hs-identifier hs-var">tvbndr'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1896"></a><span>
</span><a name="line-1897"></a><span class="hs-comment">-- Note [Renaming injectivity annotation]</span><span>
</span><a name="line-1898"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-1899"></a><span class="hs-comment">--</span><span>
</span><a name="line-1900"></a><span class="hs-comment">-- During renaming of injectivity annotation we have to make several checks to</span><span>
</span><a name="line-1901"></a><span class="hs-comment">-- make sure that it is well-formed.  At the moment injectivity annotation</span><span>
</span><a name="line-1902"></a><span class="hs-comment">-- consists of a single injectivity condition, so the terms &quot;injectivity</span><span>
</span><a name="line-1903"></a><span class="hs-comment">-- annotation&quot; and &quot;injectivity condition&quot; might be used interchangeably.  See</span><span>
</span><a name="line-1904"></a><span class="hs-comment">-- Note [Injectivity annotation] for a detailed discussion of currently allowed</span><span>
</span><a name="line-1905"></a><span class="hs-comment">-- injectivity annotations.</span><span>
</span><a name="line-1906"></a><span class="hs-comment">--</span><span>
</span><a name="line-1907"></a><span class="hs-comment">-- Checking LHS is simple because the only type variable allowed on the LHS of</span><span>
</span><a name="line-1908"></a><span class="hs-comment">-- injectivity condition is the variable naming the result in type family head.</span><span>
</span><a name="line-1909"></a><span class="hs-comment">-- Example of disallowed annotation:</span><span>
</span><a name="line-1910"></a><span class="hs-comment">--</span><span>
</span><a name="line-1911"></a><span class="hs-comment">--     type family Foo a b = r | b -&gt; a</span><span>
</span><a name="line-1912"></a><span class="hs-comment">--</span><span>
</span><a name="line-1913"></a><span class="hs-comment">-- Verifying RHS of injectivity consists of checking that:</span><span>
</span><a name="line-1914"></a><span class="hs-comment">--</span><span>
</span><a name="line-1915"></a><span class="hs-comment">--  1. only variables defined in type family head appear on the RHS (kind</span><span>
</span><a name="line-1916"></a><span class="hs-comment">--     variables are also allowed).  Example of disallowed annotation:</span><span>
</span><a name="line-1917"></a><span class="hs-comment">--</span><span>
</span><a name="line-1918"></a><span class="hs-comment">--        type family Foo a = r | r -&gt; b</span><span>
</span><a name="line-1919"></a><span class="hs-comment">--</span><span>
</span><a name="line-1920"></a><span class="hs-comment">--  2. for associated types the result variable does not shadow any of type</span><span>
</span><a name="line-1921"></a><span class="hs-comment">--     class variables. Example of disallowed annotation:</span><span>
</span><a name="line-1922"></a><span class="hs-comment">--</span><span>
</span><a name="line-1923"></a><span class="hs-comment">--        class Foo a b where</span><span>
</span><a name="line-1924"></a><span class="hs-comment">--           type F a = b | b -&gt; a</span><span>
</span><a name="line-1925"></a><span class="hs-comment">--</span><span>
</span><a name="line-1926"></a><span class="hs-comment">-- Breaking any of these assumptions results in an error.</span><span>
</span><a name="line-1927"></a><span>
</span><a name="line-1928"></a><span class="hs-comment">-- | Rename injectivity annotation. Note that injectivity annotation is just the</span><span>
</span><a name="line-1929"></a><span class="hs-comment">-- part after the &quot;|&quot;.  Everything that appears before it is renamed in</span><span>
</span><a name="line-1930"></a><span class="hs-comment">-- rnFamDecl.</span><span>
</span><a name="line-1931"></a><span class="hs-identifier">rnInjectivityAnn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>            </span><span class="hs-comment">-- ^ Type variables declared in</span><span>
</span><a name="line-1932"></a><span>                                               </span><span class="hs-comment">--   type family head</span><span>
</span><a name="line-1933"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#LFamilyResultSig"><span class="hs-identifier hs-type">LFamilyResultSig</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>      </span><span class="hs-comment">-- ^ Result signature</span><span>
</span><a name="line-1934"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#LInjectivityAnn"><span class="hs-identifier hs-type">LInjectivityAnn</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>    </span><span class="hs-comment">-- ^ Injectivity annotation</span><span>
</span><a name="line-1935"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LInjectivityAnn"><span class="hs-identifier hs-type">LInjectivityAnn</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1936"></a><a name="rnInjectivityAnn"><a href="RnSource.html#rnInjectivityAnn"><span class="hs-identifier">rnInjectivityAnn</span></a></a><span> </span><a name="local-6989586621679821522"><a href="#local-6989586621679821522"><span class="hs-identifier">tvBndrs</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyVarSig"><span class="hs-identifier hs-var">TyVarSig</span></a><span> </span><a name="local-6989586621679821523"><a href="#local-6989586621679821523"><span class="hs-identifier">resTv</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1937"></a><span>                 </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821524"><a href="#local-6989586621679821524"><span class="hs-identifier">srcSpan</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InjectivityAnn"><span class="hs-identifier hs-var">InjectivityAnn</span></a><span> </span><a name="local-6989586621679821525"><a href="#local-6989586621679821525"><span class="hs-identifier">injFrom</span></a></a><span> </span><a name="local-6989586621679821526"><a href="#local-6989586621679821526"><span class="hs-identifier">injTo</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1938"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1939"></a><span>   </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821529"><a href="#local-6989586621679821529"><span class="hs-identifier">injDecl'</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InjectivityAnn"><span class="hs-identifier hs-var">InjectivityAnn</span></a><span> </span><a name="local-6989586621679821530"><a href="#local-6989586621679821530"><span class="hs-identifier">injFrom'</span></a></a><span> </span><a name="local-6989586621679821531"><a href="#local-6989586621679821531"><span class="hs-identifier">injTo'</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679821532"><a href="#local-6989586621679821532"><span class="hs-identifier">noRnErrors</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1940"></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#askNoErrs"><span class="hs-identifier hs-var">askNoErrs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1941"></a><span>             </span><a href="RnUtils.html#bindLocalNames"><span class="hs-identifier hs-var">bindLocalNames</span></a><span> </span><span class="hs-special">[</span><a href="HsTypes.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a><span> </span><a href="#local-6989586621679821523"><span class="hs-identifier hs-var">resTv</span></a><span class="hs-special">]</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1942"></a><span>             </span><span class="hs-comment">-- The return type variable scopes over the injectivity annotation</span><span>
</span><a name="line-1943"></a><span>             </span><span class="hs-comment">-- e.g.   type family F a = (r::*) | r -&gt; a</span><span>
</span><a name="line-1944"></a><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821527"><a href="#local-6989586621679821527"><span class="hs-identifier">injFrom'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLTyVar"><span class="hs-identifier hs-var">rnLTyVar</span></a><span> </span><a href="#local-6989586621679821525"><span class="hs-identifier hs-var">injFrom</span></a><span>
</span><a name="line-1945"></a><span>                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821528"><a href="#local-6989586621679821528"><span class="hs-identifier">injTo'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="RnTypes.html#rnLTyVar"><span class="hs-identifier hs-var">rnLTyVar</span></a><span> </span><a href="#local-6989586621679821526"><span class="hs-identifier hs-var">injTo</span></a><span>
</span><a name="line-1946"></a><span>                </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821524"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InjectivityAnn"><span class="hs-identifier hs-var">InjectivityAnn</span></a><span> </span><a href="#local-6989586621679821527"><span class="hs-identifier hs-var">injFrom'</span></a><span> </span><a href="#local-6989586621679821528"><span class="hs-identifier hs-var">injTo'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1947"></a><span>
</span><a name="line-1948"></a><span>   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821533"><a href="#local-6989586621679821533"><span class="hs-identifier">tvNames</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HsTypes.html#hsAllLTyVarNames"><span class="hs-identifier hs-var">hsAllLTyVarNames</span></a><span> </span><a href="#local-6989586621679821522"><span class="hs-identifier hs-var">tvBndrs</span></a><span>
</span><a name="line-1949"></a><span>         </span><a name="local-6989586621679821534"><a href="#local-6989586621679821534"><span class="hs-identifier">resName</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HsTypes.html#hsLTyVarName"><span class="hs-identifier hs-var">hsLTyVarName</span></a><span> </span><a href="#local-6989586621679821523"><span class="hs-identifier hs-var">resTv</span></a><span>
</span><a name="line-1950"></a><span>         </span><span class="hs-comment">-- See Note [Renaming injectivity annotation]</span><span>
</span><a name="line-1951"></a><span>         </span><a name="local-6989586621679821535"><a href="#local-6989586621679821535"><span class="hs-identifier">lhsValid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">(</span><a href="Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a><span> </span><a href="#local-6989586621679821534"><span class="hs-identifier hs-var">resName</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821530"><span class="hs-identifier hs-var">injFrom'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1952"></a><span>         </span><a name="local-6989586621679821536"><a href="#local-6989586621679821536"><span class="hs-identifier">rhsValid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821531"><span class="hs-identifier hs-var">injTo'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#difference"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">difference</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821533"><span class="hs-identifier hs-var">tvNames</span></a><span>
</span><a name="line-1953"></a><span>
</span><a name="line-1954"></a><span>   </span><span class="hs-comment">-- if renaming of type variables ended with errors (eg. there were</span><span>
</span><a name="line-1955"></a><span>   </span><span class="hs-comment">-- not-in-scope variables) don't check the validity of injectivity</span><span>
</span><a name="line-1956"></a><span>   </span><span class="hs-comment">-- annotation. This gives better error messages.</span><span>
</span><a name="line-1957"></a><span>   </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821532"><span class="hs-identifier hs-var">noRnErrors</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679821535"><span class="hs-identifier hs-var">lhsValid</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1958"></a><span>        </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span> </span><a href="#local-6989586621679821525"><span class="hs-identifier hs-var">injFrom</span></a><span class="hs-special">)</span><span>
</span><a name="line-1959"></a><span>              </span><span class="hs-special">(</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-string">&quot;Incorrect type variable on the LHS of &quot;</span><span>
</span><a name="line-1960"></a><span>                           </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;injectivity condition&quot;</span><span>
</span><a name="line-1961"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-1962"></a><span>              </span><span class="hs-special">(</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Expected :&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821534"><span class="hs-identifier hs-var">resName</span></a><span>
</span><a name="line-1963"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Actual   :&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821525"><span class="hs-identifier hs-var">injFrom</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1964"></a><span>
</span><a name="line-1965"></a><span>   </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821532"><span class="hs-identifier hs-var">noRnErrors</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-6989586621679821536"><span class="hs-identifier hs-var">rhsValid</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1966"></a><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821537"><a href="#local-6989586621679821537"><span class="hs-identifier">errorVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.10.2/src/%{MODULE/./-}.html#%{NAME}/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span></a><span> </span><a href="#local-6989586621679821536"><span class="hs-identifier hs-var">rhsValid</span></a><span>
</span><a name="line-1967"></a><span>         </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-6989586621679821524"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span>
</span><a name="line-1968"></a><span>                        </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Unknown type variable&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a><span> </span><a href="#local-6989586621679821537"><span class="hs-identifier hs-var">errorVars</span></a><span>
</span><a name="line-1969"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;on the RHS of injectivity condition:&quot;</span><span>
</span><a name="line-1970"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#interpp%27SP"><span class="hs-identifier hs-var">interpp'SP</span></a><span> </span><a href="#local-6989586621679821537"><span class="hs-identifier hs-var">errorVars</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1971"></a><span>
</span><a name="line-1972"></a><span>   </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679821529"><span class="hs-identifier hs-var">injDecl'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1973"></a><span>
</span><a name="line-1974"></a><span class="hs-comment">-- We can only hit this case when the user writes injectivity annotation without</span><span>
</span><a name="line-1975"></a><span class="hs-comment">-- naming the result:</span><span>
</span><a name="line-1976"></a><span class="hs-comment">--</span><span>
</span><a name="line-1977"></a><span class="hs-comment">--   type family F a | result -&gt; a</span><span>
</span><a name="line-1978"></a><span class="hs-comment">--   type family F a :: * | result -&gt; a</span><span>
</span><a name="line-1979"></a><span class="hs-comment">--</span><span>
</span><a name="line-1980"></a><span class="hs-comment">-- So we rename injectivity annotation like we normally would except that</span><span>
</span><a name="line-1981"></a><span class="hs-comment">-- this time we expect &quot;result&quot; to be reported not in scope by rnLTyVar.</span><span>
</span><a name="line-1982"></a><span class="hs-identifier">rnInjectivityAnn</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821538"><a href="#local-6989586621679821538"><span class="hs-identifier">srcSpan</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InjectivityAnn"><span class="hs-identifier hs-var">InjectivityAnn</span></a><span> </span><a name="local-6989586621679821539"><a href="#local-6989586621679821539"><span class="hs-identifier">injFrom</span></a></a><span> </span><a name="local-6989586621679821540"><a href="#local-6989586621679821540"><span class="hs-identifier">injTo</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1983"></a><span>   </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621679821538"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1984"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679821543"><a href="#local-6989586621679821543"><span class="hs-identifier">injDecl'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#askNoErrs"><span class="hs-identifier hs-var">askNoErrs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1985"></a><span>     </span><a name="local-6989586621679821541"><a href="#local-6989586621679821541"><span class="hs-identifier">injFrom'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLTyVar"><span class="hs-identifier hs-var">rnLTyVar</span></a><span> </span><a href="#local-6989586621679821539"><span class="hs-identifier hs-var">injFrom</span></a><span>
</span><a name="line-1986"></a><span>     </span><a name="local-6989586621679821542"><a href="#local-6989586621679821542"><span class="hs-identifier">injTo'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="RnTypes.html#rnLTyVar"><span class="hs-identifier hs-var">rnLTyVar</span></a><span> </span><a href="#local-6989586621679821540"><span class="hs-identifier hs-var">injTo</span></a><span>
</span><a name="line-1987"></a><span>     </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821538"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InjectivityAnn"><span class="hs-identifier hs-var">InjectivityAnn</span></a><span> </span><a href="#local-6989586621679821541"><span class="hs-identifier hs-var">injFrom'</span></a><span> </span><a href="#local-6989586621679821542"><span class="hs-identifier hs-var">injTo'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1988"></a><span>   </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679821543"><span class="hs-identifier hs-var">injDecl'</span></a><span>
</span><a name="line-1989"></a><span>
</span><a name="line-1990"></a><span class="hs-comment">{-
Note [Stupid theta]
~~~~~~~~~~~~~~~~~~~
Trac #3850 complains about a regression wrt 6.10 for
     data Show a =&gt; T a
There is no reason not to allow the stupid theta if there are no data
constructors.  It's still stupid, but does no harm, and I don't want
to cause programs to break unnecessarily (notably HList).  So if there
are no data constructors we allow h98_style = True
-}</span><span>
</span><a name="line-2000"></a><span>
</span><a name="line-2001"></a><span>
</span><a name="line-2002"></a><span class="hs-comment">{- *****************************************************
*                                                      *
     Support code for type/data declarations
*                                                      *
***************************************************** -}</span><span>
</span><a name="line-2007"></a><span>
</span><a name="line-2008"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-2009"></a><span class="hs-identifier">badAssocRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2010"></a><a name="badAssocRhs"><a href="RnSource.html#badAssocRhs"><span class="hs-identifier">badAssocRhs</span></a></a><span> </span><a name="local-6989586621679821544"><a href="#local-6989586621679821544"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-2011"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;The RHS of an associated type declaration mentions&quot;</span><span>
</span><a name="line-2012"></a><span>                  </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821544"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-2013"></a><span>               </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;All such variables must be bound on the LHS&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2014"></a><span>
</span><a name="line-2015"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-2016"></a><span class="hs-identifier">rnConDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LConDecl"><span class="hs-identifier hs-type">LConDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#LConDecl"><span class="hs-identifier hs-type">LConDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-2017"></a><a name="rnConDecls"><a href="RnSource.html#rnConDecls"><span class="hs-identifier">rnConDecls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><a href="RnSource.html#rnConDecl"><span class="hs-identifier hs-var">rnConDecl</span></a><span class="hs-special">)</span><span>
</span><a name="line-2018"></a><span>
</span><a name="line-2019"></a><span class="hs-identifier">rnConDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#ConDecl"><span class="hs-identifier hs-type">ConDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ConDecl"><span class="hs-identifier hs-type">ConDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-2020"></a><a name="rnConDecl"><a href="RnSource.html#rnConDecl"><span class="hs-identifier">rnConDecl</span></a></a><span> </span><a name="local-6989586621679821545"><a href="#local-6989586621679821545"><span class="hs-identifier">decl</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#ConDeclH98"><span class="hs-identifier hs-var">ConDeclH98</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">con_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821546"><a href="#local-6989586621679821546"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_qvars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821547"><a href="#local-6989586621679821547"><span class="hs-identifier">qtvs</span></a></a><span>
</span><a name="line-2021"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_cxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821548"><a href="#local-6989586621679821548"><span class="hs-identifier">mcxt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821549"><a href="#local-6989586621679821549"><span class="hs-identifier">details</span></a></a><span>
</span><a name="line-2022"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_doc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821550"><a href="#local-6989586621679821550"><span class="hs-identifier">mb_doc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2023"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a><span> </span><a href="RnNames.html#checkConName"><span class="hs-identifier hs-var">checkConName</span></a><span> </span><a href="#local-6989586621679821546"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-2024"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821558"><a href="#local-6989586621679821558"><span class="hs-identifier">new_name</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-6989586621679821546"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-2025"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821559"><a href="#local-6989586621679821559"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#ConDeclCtx"><span class="hs-identifier hs-var">ConDeclCtx</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679821558"><span class="hs-identifier hs-var">new_name</span></a><span class="hs-special">]</span><span>
</span><a name="line-2026"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821560"><a href="#local-6989586621679821560"><span class="hs-identifier">mb_doc'</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnMbLHsDoc"><span class="hs-identifier hs-var">rnMbLHsDoc</span></a><span> </span><a href="#local-6989586621679821550"><span class="hs-identifier hs-var">mb_doc</span></a><span>
</span><a name="line-2027"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821561"><a href="#local-6989586621679821561"><span class="hs-identifier">kvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821562"><a href="#local-6989586621679821562"><span class="hs-identifier">qtvs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821553"><span class="hs-identifier hs-var">get_con_qtvs</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#hsConDeclArgTys"><span class="hs-identifier hs-var">hsConDeclArgTys</span></a><span> </span><a href="#local-6989586621679821549"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span>
</span><a name="line-2028"></a><span>
</span><a name="line-2029"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span> </span><a href="#local-6989586621679821559"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="RnUtils.html#inHsDocContext"><span class="hs-identifier hs-var">inHsDocContext</span></a><span> </span><a href="#local-6989586621679821559"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679821561"><span class="hs-identifier hs-var">kvs</span></a><span> </span><a href="#local-6989586621679821562"><span class="hs-identifier hs-var">qtvs'</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2030"></a><span>          </span><span class="hs-glyph">\</span><a name="local-6989586621679821563"><a href="#local-6989586621679821563"><span class="hs-identifier">new_tyvars</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2031"></a><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821567"><a href="#local-6989586621679821567"><span class="hs-identifier">new_context</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821568"><a href="#local-6989586621679821568"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821548"><span class="hs-identifier hs-var">mcxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2032"></a><span>                             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2033"></a><span>                             </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679821564"><a href="#local-6989586621679821564"><span class="hs-identifier">lcxt</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821565"><a href="#local-6989586621679821565"><span class="hs-identifier">lctx'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679821566"><a href="#local-6989586621679821566"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnContext"><span class="hs-identifier hs-var">rnContext</span></a><span> </span><a href="#local-6989586621679821559"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821564"><span class="hs-identifier hs-var">lcxt</span></a><span>
</span><a name="line-2034"></a><span>                                             </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679821565"><span class="hs-identifier hs-var">lctx'</span></a><span class="hs-special">,</span><a href="#local-6989586621679821566"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2035"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821569"><a href="#local-6989586621679821569"><span class="hs-identifier">new_details</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821570"><a href="#local-6989586621679821570"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnConDeclDetails"><span class="hs-identifier hs-var">rnConDeclDetails</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821558"><span class="hs-identifier hs-var">new_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821559"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821549"><span class="hs-identifier hs-var">details</span></a><span>
</span><a name="line-2036"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821571"><a href="#local-6989586621679821571"><span class="hs-identifier">new_details'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679821572"><a href="#local-6989586621679821572"><span class="hs-identifier">fvs3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821569"><span class="hs-identifier hs-var">new_details</span></a><span class="hs-special">,</span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2037"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;rnConDecl&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821546"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-2038"></a><span>             </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;free_kvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821561"><span class="hs-identifier hs-var">kvs</span></a><span>
</span><a name="line-2039"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;qtvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821547"><span class="hs-identifier hs-var">qtvs</span></a><span>
</span><a name="line-2040"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;qtvs':&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821562"><span class="hs-identifier hs-var">qtvs'</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2041"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821573"><a href="#local-6989586621679821573"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821568"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821570"><span class="hs-identifier hs-var">fvs2</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821572"><span class="hs-identifier hs-var">fvs3</span></a><span>
</span><a name="line-2042"></a><span>              </span><a name="local-6989586621679821574"><a href="#local-6989586621679821574"><span class="hs-identifier">new_tyvars'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821547"><span class="hs-identifier hs-var">qtvs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2043"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-2044"></a><span>                </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679821563"><span class="hs-identifier hs-var">new_tyvars</span></a><span>
</span><a name="line-2045"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821545"><span class="hs-identifier hs-var">decl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">con_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821558"><span class="hs-identifier hs-var">new_name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_qvars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821574"><span class="hs-identifier hs-var">new_tyvars'</span></a><span>
</span><a name="line-2046"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_cxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821567"><span class="hs-identifier hs-var">new_context</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_details</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821571"><span class="hs-identifier hs-var">new_details'</span></a><span>
</span><a name="line-2047"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_doc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821560"><span class="hs-identifier hs-var">mb_doc'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-2048"></a><span>                  </span><a href="#local-6989586621679821573"><span class="hs-identifier hs-var">all_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-2049"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2050"></a><span>    </span><a name="local-6989586621679821551"><a href="#local-6989586621679821551"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621679821548"><span class="hs-identifier hs-var">mcxt</span></a><span>
</span><a name="line-2051"></a><span>    </span><a name="local-6989586621679821552"><a href="#local-6989586621679821552"><span class="hs-identifier">get_rdr_tvs</span></a></a><span> </span><a name="local-6989586621679821554"><a href="#local-6989586621679821554"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extractHsTysRdrTyVars"><span class="hs-identifier hs-var">extractHsTysRdrTyVars</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821551"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679821554"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2052"></a><span>
</span><a name="line-2053"></a><span>    </span><span class="hs-identifier">get_con_qtvs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-2054"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="HsTypes.html#LHsQTyVars"><span class="hs-identifier hs-type">LHsQTyVars</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">)</span><span>
</span><a name="line-2055"></a><span>    </span><a name="local-6989586621679821553"><a href="#local-6989586621679821553"><span class="hs-identifier">get_con_qtvs</span></a></a><span> </span><a name="local-6989586621679821555"><a href="#local-6989586621679821555"><span class="hs-identifier">arg_tys</span></a></a><span>
</span><a name="line-2056"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679821556"><a href="#local-6989586621679821556"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821547"><span class="hs-identifier hs-var">qtvs</span></a><span>   </span><span class="hs-comment">-- data T = forall a. MkT (a -&gt; a)</span><span>
</span><a name="line-2057"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821557"><a href="#local-6989586621679821557"><span class="hs-identifier">free_vars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821552"><span class="hs-identifier hs-var">get_rdr_tvs</span></a><span> </span><a href="#local-6989586621679821555"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-2058"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#freeKiTyVarsKindVars"><span class="hs-identifier hs-var">freeKiTyVarsKindVars</span></a><span> </span><a href="#local-6989586621679821557"><span class="hs-identifier hs-var">free_vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821556"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2059"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>  </span><span class="hs-comment">-- data T = MkT (a -&gt; a)</span><span>
</span><a name="line-2060"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="HsTypes.html#mkHsQTvs"><span class="hs-identifier hs-var">mkHsQTvs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2061"></a><span>
</span><a name="line-2062"></a><span class="hs-identifier">rnConDecl</span><span> </span><a name="local-6989586621679821575"><a href="#local-6989586621679821575"><span class="hs-identifier">decl</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#ConDeclGADT"><span class="hs-identifier hs-var">ConDeclGADT</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">con_names</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821576"><a href="#local-6989586621679821576"><span class="hs-identifier">names</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_type</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821577"><a href="#local-6989586621679821577"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2063"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_doc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821578"><a href="#local-6989586621679821578"><span class="hs-identifier">mb_doc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2064"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a><span> </span><a href="RnNames.html#checkConName"><span class="hs-identifier hs-var">checkConName</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821576"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-2065"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821579"><a href="#local-6989586621679821579"><span class="hs-identifier">new_names</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-6989586621679821576"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-2066"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821580"><a href="#local-6989586621679821580"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#ConDeclCtx"><span class="hs-identifier hs-var">ConDeclCtx</span></a><span> </span><a href="#local-6989586621679821579"><span class="hs-identifier hs-var">new_names</span></a><span>
</span><a name="line-2067"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821581"><a href="#local-6989586621679821581"><span class="hs-identifier">mb_doc'</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnMbLHsDoc"><span class="hs-identifier hs-var">rnMbLHsDoc</span></a><span> </span><a href="#local-6989586621679821578"><span class="hs-identifier hs-var">mb_doc</span></a><span>
</span><a name="line-2068"></a><span>
</span><a name="line-2069"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821582"><a href="#local-6989586621679821582"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821583"><a href="#local-6989586621679821583"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><a href="#local-6989586621679821580"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821577"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2070"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;rnConDecl&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821576"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-2071"></a><span>             </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;fvs:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621679821583"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2072"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821575"><span class="hs-identifier hs-var">decl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">con_names</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821579"><span class="hs-identifier hs-var">new_names</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_type</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821582"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-2073"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_doc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821581"><span class="hs-identifier hs-var">mb_doc'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-2074"></a><span>                  </span><a href="#local-6989586621679821583"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2075"></a><span>
</span><a name="line-2076"></a><span class="hs-identifier">rnConDeclDetails</span><span>
</span><a name="line-2077"></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-2078"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span>
</span><a name="line-2079"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#HsConDetails"><span class="hs-identifier hs-type">HsConDetails</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LConDeclField"><span class="hs-identifier hs-type">LConDeclField</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2080"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#HsConDetails"><span class="hs-identifier hs-type">HsConDetails</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">[</span><a href="HsTypes.html#LConDeclField"><span class="hs-identifier hs-type">LConDeclField</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">)</span><span>
</span><a name="line-2081"></a><a name="rnConDeclDetails"><a href="RnSource.html#rnConDeclDetails"><span class="hs-identifier">rnConDeclDetails</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821584"><a href="#local-6989586621679821584"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#PrefixCon"><span class="hs-identifier hs-var">PrefixCon</span></a><span> </span><a name="local-6989586621679821585"><a href="#local-6989586621679821585"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2082"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821586"><a href="#local-6989586621679821586"><span class="hs-identifier">new_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821587"><a href="#local-6989586621679821587"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTypes"><span class="hs-identifier hs-var">rnLHsTypes</span></a><span> </span><a href="#local-6989586621679821584"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821585"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2083"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#PrefixCon"><span class="hs-identifier hs-var">PrefixCon</span></a><span> </span><a href="#local-6989586621679821586"><span class="hs-identifier hs-var">new_tys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821587"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2084"></a><span>
</span><a name="line-2085"></a><span class="hs-identifier">rnConDeclDetails</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821588"><a href="#local-6989586621679821588"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#InfixCon"><span class="hs-identifier hs-var">InfixCon</span></a><span> </span><a name="local-6989586621679821589"><a href="#local-6989586621679821589"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679821590"><a href="#local-6989586621679821590"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2086"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821591"><a href="#local-6989586621679821591"><span class="hs-identifier">new_ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821592"><a href="#local-6989586621679821592"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-6989586621679821588"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821589"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-2087"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821593"><a href="#local-6989586621679821593"><span class="hs-identifier">new_ty2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821594"><a href="#local-6989586621679821594"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-6989586621679821588"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821590"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2088"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#InfixCon"><span class="hs-identifier hs-var">InfixCon</span></a><span> </span><a href="#local-6989586621679821591"><span class="hs-identifier hs-var">new_ty1</span></a><span> </span><a href="#local-6989586621679821593"><span class="hs-identifier hs-var">new_ty2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821592"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821594"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2089"></a><span>
</span><a name="line-2090"></a><span class="hs-identifier">rnConDeclDetails</span><span> </span><a name="local-6989586621679821595"><a href="#local-6989586621679821595"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679821596"><a href="#local-6989586621679821596"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#RecCon"><span class="hs-identifier hs-var">RecCon</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821597"><a href="#local-6989586621679821597"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679821598"><a href="#local-6989586621679821598"><span class="hs-identifier">fields</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2091"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821599"><a href="#local-6989586621679821599"><span class="hs-identifier">fls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupConstructorFields"><span class="hs-identifier hs-var">lookupConstructorFields</span></a><span> </span><a href="#local-6989586621679821595"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-2092"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821600"><a href="#local-6989586621679821600"><span class="hs-identifier">new_fields</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821601"><a href="#local-6989586621679821601"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnConDeclFields"><span class="hs-identifier hs-var">rnConDeclFields</span></a><span> </span><a href="#local-6989586621679821596"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621679821599"><span class="hs-identifier hs-var">fls</span></a><span> </span><a href="#local-6989586621679821598"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-2093"></a><span>                </span><span class="hs-comment">-- No need to check for duplicate fields</span><span>
</span><a name="line-2094"></a><span>                </span><span class="hs-comment">-- since that is done by RnNames.extendGlobalRdrEnvRn</span><span>
</span><a name="line-2095"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#RecCon"><span class="hs-identifier hs-var">RecCon</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821597"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821600"><span class="hs-identifier hs-var">new_fields</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821601"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2096"></a><span>
</span><a name="line-2097"></a><span class="hs-comment">-------------------------------------------------</span><span>
</span><a name="line-2098"></a><span>
</span><a name="line-2099"></a><span class="hs-comment">-- | Brings pattern synonym names and also pattern synonym selectors</span><span>
</span><a name="line-2100"></a><span class="hs-comment">-- from record pattern synonyms into scope.</span><span>
</span><a name="line-2101"></a><span class="hs-identifier">extendPatSynEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnFixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a><span>
</span><a name="line-2102"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span> </span><a href="#local-6989586621679820865"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621679820865"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2103"></a><a name="extendPatSynEnv"><a href="RnSource.html#extendPatSynEnv"><span class="hs-identifier">extendPatSynEnv</span></a></a><span> </span><a name="local-6989586621679821602"><a href="#local-6989586621679821602"><span class="hs-identifier">val_decls</span></a></a><span> </span><a name="local-6989586621679821603"><a href="#local-6989586621679821603"><span class="hs-identifier">local_fix_env</span></a></a><span> </span><a name="local-6989586621679821604"><a href="#local-6989586621679821604"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2104"></a><span>     </span><a name="local-6989586621679821623"><a href="#local-6989586621679821623"><span class="hs-identifier">names_with_fls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821605"><span class="hs-identifier hs-var">new_ps</span></a><span> </span><a href="#local-6989586621679821602"><span class="hs-identifier hs-var">val_decls</span></a><span>
</span><a name="line-2105"></a><span>   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821624"><a href="#local-6989586621679821624"><span class="hs-identifier">pat_syn_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679821625"><span class="hs-identifier hs-var">name</span></a><span class="hs-glyph">:</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">flSelector</span><span> </span><a href="#local-6989586621679821626"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-2106"></a><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821625"><a href="#local-6989586621679821625"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821626"><a href="#local-6989586621679821626"><span class="hs-identifier">fields</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821623"><span class="hs-identifier hs-var">names_with_fls</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2107"></a><span>   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821627"><a href="#local-6989586621679821627"><span class="hs-identifier">avails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Avail.html#avail"><span class="hs-identifier hs-var">avail</span></a><span> </span><a href="#local-6989586621679821624"><span class="hs-identifier hs-var">pat_syn_bndrs</span></a><span>
</span><a name="line-2108"></a><span>   </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821628"><a href="#local-6989586621679821628"><span class="hs-identifier">gbl_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821629"><a href="#local-6989586621679821629"><span class="hs-identifier">lcl_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnNames.html#extendGlobalRdrEnvRn"><span class="hs-identifier hs-var">extendGlobalRdrEnvRn</span></a><span> </span><a href="#local-6989586621679821627"><span class="hs-identifier hs-var">avails</span></a><span> </span><a href="#local-6989586621679821603"><span class="hs-identifier hs-var">local_fix_env</span></a><span>
</span><a name="line-2109"></a><span>
</span><a name="line-2110"></a><span>   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821630"><a href="#local-6989586621679821630"><span class="hs-identifier">field_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#extendNameEnvList"><span class="hs-identifier hs-var">extendNameEnvList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_field_env</span><span> </span><a href="#local-6989586621679821628"><span class="hs-identifier hs-var">gbl_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821623"><span class="hs-identifier hs-var">names_with_fls</span></a><span>
</span><a name="line-2111"></a><span>         </span><a name="local-6989586621679821631"><a href="#local-6989586621679821631"><span class="hs-identifier">final_gbl_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821628"><span class="hs-identifier hs-var">gbl_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_field_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821630"><span class="hs-identifier hs-var">field_env'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2112"></a><span>   </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821631"><span class="hs-identifier hs-var">final_gbl_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821629"><span class="hs-identifier hs-var">lcl_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821604"><span class="hs-identifier hs-var">thing</span></a><span> </span><a href="#local-6989586621679821624"><span class="hs-identifier hs-var">pat_syn_bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2113"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2114"></a><span>    </span><span class="hs-identifier">new_ps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2115"></a><span>    </span><a name="local-6989586621679821605"><a href="#local-6989586621679821605"><span class="hs-identifier">new_ps</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><a name="local-6989586621679821607"><a href="#local-6989586621679821607"><span class="hs-identifier">binds</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#foldrBagM"><span class="hs-identifier hs-var">foldrBagM</span></a><span> </span><a href="#local-6989586621679821606"><span class="hs-identifier hs-var">new_ps'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679821607"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-2116"></a><span>    </span><span class="hs-identifier">new_ps</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;new_ps&quot;</span><span>
</span><a name="line-2117"></a><span>
</span><a name="line-2118"></a><span>    </span><span class="hs-identifier">new_ps'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LHsBindLR"><span class="hs-identifier hs-type">LHsBindLR</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-2119"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2120"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2121"></a><span>    </span><a name="local-6989586621679821606"><a href="#local-6989586621679821606"><span class="hs-identifier">new_ps'</span></a></a><span> </span><a name="local-6989586621679821608"><a href="#local-6989586621679821608"><span class="hs-identifier">bind</span></a></a><span> </span><a name="local-6989586621679821609"><a href="#local-6989586621679821609"><span class="hs-identifier">names</span></a></a><span>
</span><a name="line-2122"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821610"><a href="#local-6989586621679821610"><span class="hs-identifier">bind_loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PatSynBind"><span class="hs-identifier hs-var">PatSynBind</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PSB"><span class="hs-identifier hs-var">PSB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821611"><a href="#local-6989586621679821611"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-2123"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsBinds.html#RecordPatSyn"><span class="hs-identifier hs-var">RecordPatSyn</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821608"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-2124"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2125"></a><span>          </span><a name="local-6989586621679821613"><a href="#local-6989586621679821613"><span class="hs-identifier">bnd_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#newTopSrcBinder"><span class="hs-identifier hs-var">newTopSrcBinder</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821610"><span class="hs-identifier hs-var">bind_loc</span></a><span> </span><a href="#local-6989586621679821611"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-2126"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821614"><a href="#local-6989586621679821614"><span class="hs-identifier">rnames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">recordPatSynSelectorId</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-2127"></a><span>              </span><span class="hs-identifier">mkFieldOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsTypes.html#LFieldOcc"><span class="hs-identifier hs-type">LFieldOcc</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-2128"></a><span>              </span><a name="local-6989586621679821615"><a href="#local-6989586621679821615"><span class="hs-identifier">mkFieldOcc</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821617"><a href="#local-6989586621679821617"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679821618"><a href="#local-6989586621679821618"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821617"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#FieldOcc"><span class="hs-identifier hs-var">FieldOcc</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821617"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821618"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="PlaceHolder.html#PlaceHolder"><span class="hs-identifier hs-var">PlaceHolder</span></a><span class="hs-special">)</span><span>
</span><a name="line-2129"></a><span>              </span><a name="local-6989586621679821616"><a href="#local-6989586621679821616"><span class="hs-identifier">field_occs</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-6989586621679821615"><span class="hs-identifier hs-var">mkFieldOcc</span></a><span> </span><a href="#local-6989586621679821614"><span class="hs-identifier hs-var">rnames</span></a><span>
</span><a name="line-2130"></a><span>          </span><a name="local-6989586621679821619"><a href="#local-6989586621679821619"><span class="hs-identifier">flds</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="RnNames.html#newRecordSelector"><span class="hs-identifier hs-var">newRecordSelector</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679821613"><span class="hs-identifier hs-var">bnd_name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821616"><span class="hs-identifier hs-var">field_occs</span></a><span>
</span><a name="line-2131"></a><span>          </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679821613"><span class="hs-identifier hs-var">bnd_name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821619"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821609"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span>
</span><a name="line-2132"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821620"><a href="#local-6989586621679821620"><span class="hs-identifier">bind_loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PatSynBind"><span class="hs-identifier hs-var">PatSynBind</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#PSB"><span class="hs-identifier hs-var">PSB</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821621"><a href="#local-6989586621679821621"><span class="hs-identifier">n</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679821608"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-2133"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2134"></a><span>        </span><a name="local-6989586621679821622"><a href="#local-6989586621679821622"><span class="hs-identifier">bnd_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#newTopSrcBinder"><span class="hs-identifier hs-var">newTopSrcBinder</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821620"><span class="hs-identifier hs-var">bind_loc</span></a><span> </span><a href="#local-6989586621679821621"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-2135"></a><span>        </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679821622"><span class="hs-identifier hs-var">bnd_name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821609"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span>
</span><a name="line-2136"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2137"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679821609"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-2138"></a><span>
</span><a name="line-2139"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
\subsection{Support code to rename types}
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-2146"></a><span>
</span><a name="line-2147"></a><span class="hs-identifier">rnFds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2148"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="Class.html#FunDep"><span class="hs-identifier hs-type">FunDep</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2149"></a><a name="rnFds"><a href="RnSource.html#rnFds"><span class="hs-identifier">rnFds</span></a></a><span> </span><a name="local-6989586621679821632"><a href="#local-6989586621679821632"><span class="hs-identifier">fds</span></a></a><span>
</span><a name="line-2150"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="#local-6989586621679821633"><span class="hs-identifier hs-var">rn_fds</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821632"><span class="hs-identifier hs-var">fds</span></a><span>
</span><a name="line-2151"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2152"></a><span>    </span><a name="local-6989586621679821633"><a href="#local-6989586621679821633"><span class="hs-identifier">rn_fds</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679821634"><a href="#local-6989586621679821634"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679821635"><a href="#local-6989586621679821635"><span class="hs-identifier">tys2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2153"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821636"><a href="#local-6989586621679821636"><span class="hs-identifier">tys1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnHsTyVars"><span class="hs-identifier hs-var">rnHsTyVars</span></a><span> </span><a href="#local-6989586621679821634"><span class="hs-identifier hs-var">tys1</span></a><span>
</span><a name="line-2154"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679821637"><a href="#local-6989586621679821637"><span class="hs-identifier">tys2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSource.html#rnHsTyVars"><span class="hs-identifier hs-var">rnHsTyVars</span></a><span> </span><a href="#local-6989586621679821635"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-2155"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821636"><span class="hs-identifier hs-var">tys1'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821637"><span class="hs-identifier hs-var">tys2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2156"></a><span>
</span><a name="line-2157"></a><span class="hs-identifier">rnHsTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-2158"></a><a name="rnHsTyVars"><a href="RnSource.html#rnHsTyVars"><span class="hs-identifier">rnHsTyVars</span></a></a><span> </span><a name="local-6989586621679821638"><a href="#local-6989586621679821638"><span class="hs-identifier">tvs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><a href="RnSource.html#rnHsTyVar"><span class="hs-identifier hs-var">rnHsTyVar</span></a><span> </span><a href="#local-6989586621679821638"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-2159"></a><span>
</span><a name="line-2160"></a><span class="hs-identifier">rnHsTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-2161"></a><a name="rnHsTyVar"><a href="RnSource.html#rnHsTyVar"><span class="hs-identifier">rnHsTyVar</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821639"><a href="#local-6989586621679821639"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679821640"><a href="#local-6989586621679821640"><span class="hs-identifier">tyvar</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2162"></a><span>  </span><a name="local-6989586621679821641"><a href="#local-6989586621679821641"><span class="hs-identifier">tyvar'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupOccRn"><span class="hs-identifier hs-var">lookupOccRn</span></a><span> </span><a href="#local-6989586621679821640"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-2163"></a><span>  </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821639"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821641"><span class="hs-identifier hs-var">tyvar'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2164"></a><span>
</span><a name="line-2165"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
        findSplice
*                                                      *
*********************************************************

This code marches down the declarations, looking for the first
Template Haskell splice.  As it does so it
        a) groups the declarations into a HsGroup
        b) runs any top-level quasi-quotes
-}</span><span>
</span><a name="line-2177"></a><span>
</span><a name="line-2178"></a><span class="hs-identifier">findSplice</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2179"></a><a name="findSplice"><a href="RnSource.html#findSplice"><span class="hs-identifier">findSplice</span></a></a><span> </span><a name="local-6989586621679821642"><a href="#local-6989586621679821642"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><a href="HsDecls.html#emptyRdrGroup"><span class="hs-identifier hs-var">emptyRdrGroup</span></a><span> </span><a href="#local-6989586621679821642"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2180"></a><span>
</span><a name="line-2181"></a><span class="hs-identifier">addl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-2182"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2183"></a><span class="hs-comment">-- This stuff reverses the declarations (again) but it doesn't matter</span><span>
</span><a name="line-2184"></a><a name="addl"><a href="RnSource.html#addl"><span class="hs-identifier">addl</span></a></a><span> </span><a name="local-6989586621679821643"><a href="#local-6989586621679821643"><span class="hs-identifier">gp</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821643"><span class="hs-identifier hs-var">gp</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-2185"></a><span class="hs-identifier">addl</span><span> </span><a name="local-6989586621679821644"><a href="#local-6989586621679821644"><span class="hs-identifier">gp</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821645"><a href="#local-6989586621679821645"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679821646"><a href="#local-6989586621679821646"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679821647"><a href="#local-6989586621679821647"><span class="hs-identifier">ds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="#local-6989586621679821644"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-6989586621679821645"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821646"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="#local-6989586621679821647"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2186"></a><span>
</span><a name="line-2187"></a><span>
</span><a name="line-2188"></a><span class="hs-identifier">add</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsDecls.html#HsDecl"><span class="hs-identifier hs-type">HsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-2189"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2190"></a><span>
</span><a name="line-2191"></a><span class="hs-comment">-- #10047: Declaration QuasiQuoters are expanded immediately, without</span><span>
</span><a name="line-2192"></a><span class="hs-comment">--         causing a group split</span><span>
</span><a name="line-2193"></a><a name="add"><a href="RnSource.html#add"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621679821648"><a href="#local-6989586621679821648"><span class="hs-identifier">gp</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceD"><span class="hs-identifier hs-var">SpliceD</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-var">SpliceDecl</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821649"><a href="#local-6989586621679821649"><span class="hs-identifier">qq</span></a></a><span class="hs-glyph">@</span><a href="HsExpr.html#HsQuasiQuote"><span class="hs-identifier hs-var">HsQuasiQuote</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821650"><a href="#local-6989586621679821650"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2194"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679821651"><a href="#local-6989586621679821651"><span class="hs-identifier">ds'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnSplice.html#rnTopSpliceDecls"><span class="hs-identifier hs-var">rnTopSpliceDecls</span></a><span> </span><a href="#local-6989586621679821649"><span class="hs-identifier hs-var">qq</span></a><span>
</span><a name="line-2195"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><a href="#local-6989586621679821648"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821651"><span class="hs-identifier hs-var">ds'</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679821650"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-2196"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-2197"></a><span>
</span><a name="line-2198"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821652"><a href="#local-6989586621679821652"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-6989586621679821653"><a href="#local-6989586621679821653"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SpliceD"><span class="hs-identifier hs-var">SpliceD</span></a><span> </span><a name="local-6989586621679821654"><a href="#local-6989586621679821654"><span class="hs-identifier">splice</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#SpliceDecl"><span class="hs-identifier hs-var">SpliceDecl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679821655"><a href="#local-6989586621679821655"><span class="hs-identifier">flag</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821656"><a href="#local-6989586621679821656"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2199"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- We've found a top-level splice.  If it is an *implicit* one</span><span>
</span><a name="line-2200"></a><span>         </span><span class="hs-comment">-- (i.e. a naked top level expression)</span><span>
</span><a name="line-2201"></a><span>         </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679821655"><span class="hs-identifier hs-var">flag</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2202"></a><span>           </span><a href="BasicTypes.html#ExplicitSplice"><span class="hs-identifier hs-var">ExplicitSplice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2203"></a><span>           </span><a href="BasicTypes.html#ImplicitSplice"><span class="hs-identifier hs-var">ImplicitSplice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679821658"><a href="#local-6989586621679821658"><span class="hs-identifier">th_on</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><a href="../ghc-boot-th-8.3/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.Type.html#TemplateHaskell"><span class="hs-identifier hs-var">LangExt</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TemplateHaskell</span></a><span>
</span><a name="line-2204"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a><span> </span><a href="#local-6989586621679821658"><span class="hs-identifier hs-var">th_on</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621679821653"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-2205"></a><span>                                  </span><a href="TcRnMonad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a><span> </span><a href="#local-6989586621679821657"><span class="hs-identifier hs-var">badImplicitSplice</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2206"></a><span>
</span><a name="line-2207"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821652"><span class="hs-identifier hs-var">gp</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821654"><span class="hs-identifier hs-var">splice</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679821656"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2208"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2209"></a><span>    </span><a name="local-6989586621679821657"><a href="#local-6989586621679821657"><span class="hs-identifier">badImplicitSplice</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Parse error: module header, import declaration&quot;</span><span>
</span><a name="line-2210"></a><span>                     </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;or top-level declaration expected.&quot;</span><span>
</span><a name="line-2211"></a><span>
</span><a name="line-2212"></a><span class="hs-comment">-- Class declarations: pull out the fixity signatures to the top</span><span>
</span><a name="line-2213"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821659"><a href="#local-6989586621679821659"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821660"><a href="#local-6989586621679821660"><span class="hs-identifier">ts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_fixds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821661"><a href="#local-6989586621679821661"><span class="hs-identifier">fs</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821662"><a href="#local-6989586621679821662"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#TyClD"><span class="hs-identifier hs-var">TyClD</span></a><span> </span><a name="local-6989586621679821663"><a href="#local-6989586621679821663"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821664"><a href="#local-6989586621679821664"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2214"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="HsDecls.html#isClassDecl"><span class="hs-identifier hs-var">isClassDecl</span></a><span> </span><a href="#local-6989586621679821663"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-2215"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679821665"><a href="#local-6989586621679821665"><span class="hs-identifier">fsigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821666"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821667"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621679821666"><a href="#local-6989586621679821666"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FixSig"><span class="hs-identifier hs-var">FixSig</span></a><span> </span><a name="local-6989586621679821667"><a href="#local-6989586621679821667"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">tcdSigs</span><span> </span><a href="#local-6989586621679821663"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-2216"></a><span>    </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821659"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_tycld"><span class="hs-identifier hs-var">add_tycld</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821662"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821663"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821660"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hs_fixds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821665"><span class="hs-identifier hs-var">fsigs</span></a><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-6989586621679821661"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821664"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2217"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.10.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-2218"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821659"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_tycld"><span class="hs-identifier hs-var">add_tycld</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821662"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821663"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821660"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821664"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2219"></a><span>
</span><a name="line-2220"></a><span class="hs-comment">-- Signatures: fixity sigs go a different place than all others</span><span>
</span><a name="line-2221"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821668"><a href="#local-6989586621679821668"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_fixds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821669"><a href="#local-6989586621679821669"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821670"><a href="#local-6989586621679821670"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SigD"><span class="hs-identifier hs-var">SigD</span></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#FixSig"><span class="hs-identifier hs-var">FixSig</span></a><span> </span><a name="local-6989586621679821671"><a href="#local-6989586621679821671"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821672"><a href="#local-6989586621679821672"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2222"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821668"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_fixds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821670"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821671"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821669"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821672"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2223"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821673"><a href="#local-6989586621679821673"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_valds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821674"><a href="#local-6989586621679821674"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821675"><a href="#local-6989586621679821675"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#SigD"><span class="hs-identifier hs-var">SigD</span></a><span> </span><a name="local-6989586621679821676"><a href="#local-6989586621679821676"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821677"><a href="#local-6989586621679821677"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2224"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821673"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_valds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_sig"><span class="hs-identifier hs-var">add_sig</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821675"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821676"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821674"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821677"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2225"></a><span>
</span><a name="line-2226"></a><span class="hs-comment">-- Value declarations: use add_bind</span><span>
</span><a name="line-2227"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821678"><a href="#local-6989586621679821678"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_valds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821679"><a href="#local-6989586621679821679"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821680"><a href="#local-6989586621679821680"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ValD"><span class="hs-identifier hs-var">ValD</span></a><span> </span><a name="local-6989586621679821681"><a href="#local-6989586621679821681"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821682"><a href="#local-6989586621679821682"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2228"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821678"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_valds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_bind"><span class="hs-identifier hs-var">add_bind</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821680"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821681"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821679"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821682"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2229"></a><span>
</span><a name="line-2230"></a><span class="hs-comment">-- Role annotations: added to the TyClGroup</span><span>
</span><a name="line-2231"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821683"><a href="#local-6989586621679821683"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821684"><a href="#local-6989586621679821684"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821685"><a href="#local-6989586621679821685"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RoleAnnotD"><span class="hs-identifier hs-var">RoleAnnotD</span></a><span> </span><a name="local-6989586621679821686"><a href="#local-6989586621679821686"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821687"><a href="#local-6989586621679821687"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2232"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821683"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_role_annot"><span class="hs-identifier hs-var">add_role_annot</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821685"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821686"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821684"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821687"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2233"></a><span>
</span><a name="line-2234"></a><span class="hs-comment">-- NB instance declarations go into TyClGroups. We throw them into the first</span><span>
</span><a name="line-2235"></a><span class="hs-comment">-- group, just as we do for the TyClD case. The renamer will go on to group</span><span>
</span><a name="line-2236"></a><span class="hs-comment">-- and order them later.</span><span>
</span><a name="line-2237"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821688"><a href="#local-6989586621679821688"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821689"><a href="#local-6989586621679821689"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-6989586621679821690"><a href="#local-6989586621679821690"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#InstD"><span class="hs-identifier hs-var">InstD</span></a><span> </span><a name="local-6989586621679821691"><a href="#local-6989586621679821691"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821692"><a href="#local-6989586621679821692"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2238"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821688"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#add_instd"><span class="hs-identifier hs-var">add_instd</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821690"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821691"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821689"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821692"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2239"></a><span>
</span><a name="line-2240"></a><span class="hs-comment">-- The rest are routine</span><span>
</span><a name="line-2241"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821693"><a href="#local-6989586621679821693"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_derivds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821694"><a href="#local-6989586621679821694"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-6989586621679821695"><a href="#local-6989586621679821695"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DerivD"><span class="hs-identifier hs-var">DerivD</span></a><span> </span><a name="local-6989586621679821696"><a href="#local-6989586621679821696"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821697"><a href="#local-6989586621679821697"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2242"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821693"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_derivds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821695"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821696"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821694"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821697"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2243"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821698"><a href="#local-6989586621679821698"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_defds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821699"><a href="#local-6989586621679821699"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-6989586621679821700"><a href="#local-6989586621679821700"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DefD"><span class="hs-identifier hs-var">DefD</span></a><span> </span><a name="local-6989586621679821701"><a href="#local-6989586621679821701"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821702"><a href="#local-6989586621679821702"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2244"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821698"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_defds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821700"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821701"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821699"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821702"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2245"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821703"><a href="#local-6989586621679821703"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_fords</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821704"><a href="#local-6989586621679821704"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821705"><a href="#local-6989586621679821705"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#ForD"><span class="hs-identifier hs-var">ForD</span></a><span> </span><a name="local-6989586621679821706"><a href="#local-6989586621679821706"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821707"><a href="#local-6989586621679821707"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2246"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821703"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_fords</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821705"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821706"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821704"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821707"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2247"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821708"><a href="#local-6989586621679821708"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_warnds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821709"><a href="#local-6989586621679821709"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-6989586621679821710"><a href="#local-6989586621679821710"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#WarningD"><span class="hs-identifier hs-var">WarningD</span></a><span> </span><a name="local-6989586621679821711"><a href="#local-6989586621679821711"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821712"><a href="#local-6989586621679821712"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2248"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821708"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_warnds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821710"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821711"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821709"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821712"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2249"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821713"><a href="#local-6989586621679821713"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_annds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821714"><a href="#local-6989586621679821714"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821715"><a href="#local-6989586621679821715"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#AnnD"><span class="hs-identifier hs-var">AnnD</span></a><span> </span><a name="local-6989586621679821716"><a href="#local-6989586621679821716"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821717"><a href="#local-6989586621679821717"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2250"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821713"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_annds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821715"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821716"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821714"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821717"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2251"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821718"><a href="#local-6989586621679821718"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_ruleds</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821719"><a href="#local-6989586621679821719"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821720"><a href="#local-6989586621679821720"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#RuleD"><span class="hs-identifier hs-var">RuleD</span></a><span> </span><a name="local-6989586621679821721"><a href="#local-6989586621679821721"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821722"><a href="#local-6989586621679821722"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2252"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821718"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_ruleds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821720"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821721"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821719"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821722"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2253"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821723"><a href="#local-6989586621679821723"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-var">HsGroup</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">hs_vects</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821724"><a href="#local-6989586621679821724"><span class="hs-identifier">ts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679821725"><a href="#local-6989586621679821725"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#VectD"><span class="hs-identifier hs-var">VectD</span></a><span> </span><a name="local-6989586621679821726"><a href="#local-6989586621679821726"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821727"><a href="#local-6989586621679821727"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2254"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821723"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_vects</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821725"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821726"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821724"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821727"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2255"></a><span class="hs-identifier">add</span><span> </span><a name="local-6989586621679821728"><a href="#local-6989586621679821728"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-6989586621679821729"><a href="#local-6989586621679821729"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#DocD"><span class="hs-identifier hs-var">DocD</span></a><span> </span><a name="local-6989586621679821730"><a href="#local-6989586621679821730"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679821731"><a href="#local-6989586621679821731"><span class="hs-identifier">ds</span></a></a><span>
</span><a name="line-2256"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSource.html#addl"><span class="hs-identifier hs-var">addl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821728"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hs_docs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621679821729"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679821730"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hs_docs</span><span> </span><a href="#local-6989586621679821728"><span class="hs-identifier hs-var">gp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a href="#local-6989586621679821731"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-2257"></a><span>
</span><a name="line-2258"></a><span class="hs-identifier">add_tycld</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a><span> </span><a href="#local-6989586621679820864"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="#local-6989586621679820864"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="#local-6989586621679820864"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-2259"></a><a name="add_tycld"><a href="RnSource.html#add_tycld"><span class="hs-identifier">add_tycld</span></a></a><span> </span><a name="local-6989586621679821732"><a href="#local-6989586621679821732"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679821732"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">]</span><span>
</span><a name="line-2260"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2261"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2262"></a><span>                                  </span><span class="hs-special">}</span><span>
</span><a name="line-2263"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-2264"></a><span class="hs-identifier">add_tycld</span><span> </span><a name="local-6989586621679821733"><a href="#local-6989586621679821733"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679821734"><a href="#local-6989586621679821734"><span class="hs-identifier">ds</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821735"><a href="#local-6989586621679821735"><span class="hs-identifier">tyclds</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679821736"><a href="#local-6989586621679821736"><span class="hs-identifier">dss</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2265"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821734"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821733"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821735"><span class="hs-identifier hs-var">tyclds</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821736"><span class="hs-identifier hs-var">dss</span></a><span>
</span><a name="line-2266"></a><span>
</span><a name="line-2267"></a><span class="hs-identifier">add_instd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#LInstDecl"><span class="hs-identifier hs-type">LInstDecl</span></a><span> </span><a href="#local-6989586621679820863"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="#local-6989586621679820863"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="#local-6989586621679820863"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-2268"></a><a name="add_instd"><a href="RnSource.html#add_instd"><span class="hs-identifier">add_instd</span></a></a><span> </span><a name="local-6989586621679821737"><a href="#local-6989586621679821737"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2269"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2270"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679821737"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">]</span><span>
</span><a name="line-2271"></a><span>                                  </span><span class="hs-special">}</span><span>
</span><a name="line-2272"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-2273"></a><span class="hs-identifier">add_instd</span><span> </span><a name="local-6989586621679821738"><a href="#local-6989586621679821738"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679821739"><a href="#local-6989586621679821739"><span class="hs-identifier">ds</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821740"><a href="#local-6989586621679821740"><span class="hs-identifier">instds</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679821741"><a href="#local-6989586621679821741"><span class="hs-identifier">dss</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2274"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821739"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821738"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821740"><span class="hs-identifier hs-var">instds</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821741"><span class="hs-identifier hs-var">dss</span></a><span>
</span><a name="line-2275"></a><span>
</span><a name="line-2276"></a><span class="hs-identifier">add_role_annot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="#local-6989586621679820862"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="#local-6989586621679820862"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a><span> </span><a href="#local-6989586621679820862"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-2277"></a><a name="add_role_annot"><a href="RnSource.html#add_role_annot"><span class="hs-identifier">add_role_annot</span></a></a><span> </span><a name="local-6989586621679821742"><a href="#local-6989586621679821742"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_tyclds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2278"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679821742"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">]</span><span>
</span><a name="line-2279"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">group_instds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2280"></a><span>                                 </span><span class="hs-special">}</span><span>
</span><a name="line-2281"></a><span>                      </span><span class="hs-special">]</span><span>
</span><a name="line-2282"></a><span class="hs-identifier">add_role_annot</span><span> </span><a name="local-6989586621679821743"><a href="#local-6989586621679821743"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679821744"><a href="#local-6989586621679821744"><span class="hs-identifier">tycls</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HsDecls.html#TyClGroup"><span class="hs-identifier hs-var">TyClGroup</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679821745"><a href="#local-6989586621679821745"><span class="hs-identifier">roles</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679821746"><a href="#local-6989586621679821746"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2283"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821744"><span class="hs-identifier hs-var">tycls</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">group_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679821743"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821745"><span class="hs-identifier hs-var">roles</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679821746"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-2284"></a><span>
</span><a name="line-2285"></a><span class="hs-identifier">add_bind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LHsBind"><span class="hs-identifier hs-type">LHsBind</span></a><span> </span><a href="#local-6989586621679820861"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="#local-6989586621679820861"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="#local-6989586621679820861"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2286"></a><a name="add_bind"><a href="RnSource.html#add_bind"><span class="hs-identifier">add_bind</span></a></a><span> </span><a name="local-6989586621679821747"><a href="#local-6989586621679821747"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><a name="local-6989586621679821748"><a href="#local-6989586621679821748"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-6989586621679821749"><a href="#local-6989586621679821749"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821748"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#snocBag"><span class="hs-identifier hs-var">snocBag</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679821747"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679821749"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-2287"></a><span class="hs-identifier">add_bind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;RdrHsSyn:add_bind&quot;</span><span>
</span><a name="line-2288"></a><span>
</span><a name="line-2289"></a><span class="hs-identifier">add_sig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a><span> </span><a href="#local-6989586621679820860"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="#local-6989586621679820860"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsBinds.html#HsValBinds"><span class="hs-identifier hs-type">HsValBinds</span></a><span> </span><a href="#local-6989586621679820860"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2290"></a><a name="add_sig"><a href="RnSource.html#add_sig"><span class="hs-identifier">add_sig</span></a></a><span> </span><a name="local-6989586621679821750"><a href="#local-6989586621679821750"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><a name="local-6989586621679821751"><a href="#local-6989586621679821751"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-6989586621679821752"><a href="#local-6989586621679821752"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsBinds.html#ValBindsIn"><span class="hs-identifier hs-var">ValBindsIn</span></a><span> </span><a href="#local-6989586621679821751"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679821750"><span class="hs-identifier hs-var">s</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679821752"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2291"></a><span class="hs-identifier">add_sig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsBinds.html#ValBindsOut"><span class="hs-identifier hs-var">ValBindsOut</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;RdrHsSyn:add_sig&quot;</span><span>
</span><a name="line-2292"></a></pre></body></html>